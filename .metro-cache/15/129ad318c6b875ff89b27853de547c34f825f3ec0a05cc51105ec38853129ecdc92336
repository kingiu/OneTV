{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":81,"column":0,"index":2657}}],"key":"7kvm5yrOpz4NYiDi6sn4qxa8DVQ="}},{"name":"@/utils/Logger","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":36,"index":36}}],"key":"dpbJvsqVW0VVfFOl8dlhEC6KfVk="}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _interopRequireDefault = require(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.getResolutionFromM3U8 = void 0;\n  var _Logger = _interopRequireDefault(require(_dependencyMap[1], \"@/utils/Logger\"));\n  const logger = _Logger.default.withTag('M3U8');\n  const resolutionCache = {};\n  const CACHE_DURATION = 5 * 60 * 1000; // 5 minutes\n\n  const getResolutionFromM3U8 = async (url, signal) => {\n    const perfStart = performance.now();\n    logger.info(`[PERF] M3U8 resolution detection START - url: ${url.substring(0, 100)}...`);\n\n    // 1. Check cache first\n    const cachedEntry = resolutionCache[url];\n    if (cachedEntry && Date.now() - cachedEntry.timestamp < CACHE_DURATION) {\n      const perfEnd = performance.now();\n      logger.info(`[PERF] M3U8 resolution detection CACHED - took ${(perfEnd - perfStart).toFixed(2)}ms, resolution: ${cachedEntry.resolution}`);\n      return cachedEntry.resolution;\n    }\n    if (!url.toLowerCase().endsWith(\".m3u8\")) {\n      logger.info(`[PERF] M3U8 resolution detection SKIPPED - not M3U8 file`);\n      return null;\n    }\n    try {\n      const fetchStart = performance.now();\n      const response = await fetch(url, {\n        signal\n      });\n      const fetchEnd = performance.now();\n      logger.info(`[PERF] M3U8 fetch took ${(fetchEnd - fetchStart).toFixed(2)}ms, status: ${response.status}`);\n      if (!response.ok) {\n        return null;\n      }\n      const parseStart = performance.now();\n      const playlist = await response.text();\n      const lines = playlist.split(\"\\n\");\n      let highestResolution = 0;\n      let resolutionString = null;\n      for (const line of lines) {\n        if (line.startsWith(\"#EXT-X-STREAM-INF\")) {\n          const resolutionMatch = line.match(/RESOLUTION=(\\d+)x(\\d+)/);\n          if (resolutionMatch) {\n            const height = parseInt(resolutionMatch[2], 10);\n            if (height > highestResolution) {\n              highestResolution = height;\n              resolutionString = `${height}p`;\n            }\n          }\n        }\n      }\n      const parseEnd = performance.now();\n      logger.info(`[PERF] M3U8 parsing took ${(parseEnd - parseStart).toFixed(2)}ms, lines: ${lines.length}`);\n\n      // 2. Store result in cache\n      resolutionCache[url] = {\n        resolution: resolutionString,\n        timestamp: Date.now()\n      };\n      const perfEnd = performance.now();\n      logger.info(`[PERF] M3U8 resolution detection COMPLETE - took ${(perfEnd - perfStart).toFixed(2)}ms, resolution: ${resolutionString}`);\n      return resolutionString;\n    } catch (error) {\n      const perfEnd = performance.now();\n      logger.info(`[PERF] M3U8 resolution detection ERROR - took ${(perfEnd - perfStart).toFixed(2)}ms, error: ${error}`);\n      return null;\n    }\n  };\n  exports.getResolutionFromM3U8 = getResolutionFromM3U8;\n});","lineCount":72,"map":[[7,2,1,0],[7,6,1,0,"_Logger"],[7,13,1,0],[7,16,1,0,"_interopRequireDefault"],[7,38,1,0],[7,39,1,0,"require"],[7,46,1,0],[7,47,1,0,"_dependencyMap"],[7,61,1,0],[8,2,3,0],[8,8,3,6,"logger"],[8,14,3,12],[8,17,3,15,"Logger"],[8,32,3,21],[8,33,3,22,"withTag"],[8,40,3,29],[8,41,3,30],[8,47,3,36],[8,48,3,37],[9,2,10,0],[9,8,10,6,"resolutionCache"],[9,23,10,52],[9,26,10,55],[9,27,10,56],[9,28,10,57],[10,2,11,0],[10,8,11,6,"CACHE_DURATION"],[10,22,11,20],[10,25,11,23],[10,26,11,24],[10,29,11,27],[10,31,11,29],[10,34,11,32],[10,38,11,36],[10,39,11,37],[10,40,11,38],[12,2,13,7],[12,8,13,13,"getResolutionFromM3U8"],[12,29,13,34],[12,32,13,37],[12,38,13,37,"getResolutionFromM3U8"],[12,39,14,2,"url"],[12,42,14,13],[12,44,15,2,"signal"],[12,50,15,22],[12,55,16,29],[13,4,17,2],[13,10,17,8,"perfStart"],[13,19,17,17],[13,22,17,20,"performance"],[13,33,17,31],[13,34,17,32,"now"],[13,37,17,35],[13,38,17,36],[13,39,17,37],[14,4,18,2,"logger"],[14,10,18,8],[14,11,18,9,"info"],[14,15,18,13],[14,16,18,14],[14,65,18,63,"url"],[14,68,18,66],[14,69,18,67,"substring"],[14,78,18,76],[14,79,18,77],[14,80,18,78],[14,82,18,80],[14,85,18,83],[14,86,18,84],[14,91,18,89],[14,92,18,90],[16,4,20,2],[17,4,21,2],[17,10,21,8,"cachedEntry"],[17,21,21,19],[17,24,21,22,"resolutionCache"],[17,39,21,37],[17,40,21,38,"url"],[17,43,21,41],[17,44,21,42],[18,4,22,2],[18,8,22,6,"cachedEntry"],[18,19,22,17],[18,23,22,21,"Date"],[18,27,22,25],[18,28,22,26,"now"],[18,31,22,29],[18,32,22,30],[18,33,22,31],[18,36,22,34,"cachedEntry"],[18,47,22,45],[18,48,22,46,"timestamp"],[18,57,22,55],[18,60,22,58,"CACHE_DURATION"],[18,74,22,72],[18,76,22,74],[19,6,23,4],[19,12,23,10,"perfEnd"],[19,19,23,17],[19,22,23,20,"performance"],[19,33,23,31],[19,34,23,32,"now"],[19,37,23,35],[19,38,23,36],[19,39,23,37],[20,6,24,4,"logger"],[20,12,24,10],[20,13,24,11,"info"],[20,17,24,15],[20,18,24,16],[20,68,24,66],[20,69,24,67,"perfEnd"],[20,76,24,74],[20,79,24,77,"perfStart"],[20,88,24,86],[20,90,24,88,"toFixed"],[20,97,24,95],[20,98,24,96],[20,99,24,97],[20,100,24,98],[20,119,24,117,"cachedEntry"],[20,130,24,128],[20,131,24,129,"resolution"],[20,141,24,139],[20,143,24,141],[20,144,24,142],[21,6,25,4],[21,13,25,11,"cachedEntry"],[21,24,25,22],[21,25,25,23,"resolution"],[21,35,25,33],[22,4,26,2],[23,4,28,2],[23,8,28,6],[23,9,28,7,"url"],[23,12,28,10],[23,13,28,11,"toLowerCase"],[23,24,28,22],[23,25,28,23],[23,26,28,24],[23,27,28,25,"endsWith"],[23,35,28,33],[23,36,28,34],[23,43,28,41],[23,44,28,42],[23,46,28,44],[24,6,29,4,"logger"],[24,12,29,10],[24,13,29,11,"info"],[24,17,29,15],[24,18,29,16],[24,76,29,74],[24,77,29,75],[25,6,30,4],[25,13,30,11],[25,17,30,15],[26,4,31,2],[27,4,33,2],[27,8,33,6],[28,6,34,4],[28,12,34,10,"fetchStart"],[28,22,34,20],[28,25,34,23,"performance"],[28,36,34,34],[28,37,34,35,"now"],[28,40,34,38],[28,41,34,39],[28,42,34,40],[29,6,35,4],[29,12,35,10,"response"],[29,20,35,18],[29,23,35,21],[29,29,35,27,"fetch"],[29,34,35,32],[29,35,35,33,"url"],[29,38,35,36],[29,40,35,38],[30,8,35,40,"signal"],[31,6,35,47],[31,7,35,48],[31,8,35,49],[32,6,36,4],[32,12,36,10,"fetchEnd"],[32,20,36,18],[32,23,36,21,"performance"],[32,34,36,32],[32,35,36,33,"now"],[32,38,36,36],[32,39,36,37],[32,40,36,38],[33,6,37,4,"logger"],[33,12,37,10],[33,13,37,11,"info"],[33,17,37,15],[33,18,37,16],[33,44,37,42],[33,45,37,43,"fetchEnd"],[33,53,37,51],[33,56,37,54,"fetchStart"],[33,66,37,64],[33,68,37,66,"toFixed"],[33,75,37,73],[33,76,37,74],[33,77,37,75],[33,78,37,76],[33,93,37,91,"response"],[33,101,37,99],[33,102,37,100,"status"],[33,108,37,106],[33,110,37,108],[33,111,37,109],[34,6,39,4],[34,10,39,8],[34,11,39,9,"response"],[34,19,39,17],[34,20,39,18,"ok"],[34,22,39,20],[34,24,39,22],[35,8,40,6],[35,15,40,13],[35,19,40,17],[36,6,41,4],[37,6,43,4],[37,12,43,10,"parseStart"],[37,22,43,20],[37,25,43,23,"performance"],[37,36,43,34],[37,37,43,35,"now"],[37,40,43,38],[37,41,43,39],[37,42,43,40],[38,6,44,4],[38,12,44,10,"playlist"],[38,20,44,18],[38,23,44,21],[38,29,44,27,"response"],[38,37,44,35],[38,38,44,36,"text"],[38,42,44,40],[38,43,44,41],[38,44,44,42],[39,6,45,4],[39,12,45,10,"lines"],[39,17,45,15],[39,20,45,18,"playlist"],[39,28,45,26],[39,29,45,27,"split"],[39,34,45,32],[39,35,45,33],[39,39,45,37],[39,40,45,38],[40,6,46,4],[40,10,46,8,"highestResolution"],[40,27,46,25],[40,30,46,28],[40,31,46,29],[41,6,47,4],[41,10,47,8,"resolutionString"],[41,26,47,39],[41,29,47,42],[41,33,47,46],[42,6,49,4],[42,11,49,9],[42,17,49,15,"line"],[42,21,49,19],[42,25,49,23,"lines"],[42,30,49,28],[42,32,49,30],[43,8,50,6],[43,12,50,10,"line"],[43,16,50,14],[43,17,50,15,"startsWith"],[43,27,50,25],[43,28,50,26],[43,47,50,45],[43,48,50,46],[43,50,50,48],[44,10,51,8],[44,16,51,14,"resolutionMatch"],[44,31,51,29],[44,34,51,32,"line"],[44,38,51,36],[44,39,51,37,"match"],[44,44,51,42],[44,45,51,43],[44,69,51,67],[44,70,51,68],[45,10,52,8],[45,14,52,12,"resolutionMatch"],[45,29,52,27],[45,31,52,29],[46,12,53,10],[46,18,53,16,"height"],[46,24,53,22],[46,27,53,25,"parseInt"],[46,35,53,33],[46,36,53,34,"resolutionMatch"],[46,51,53,49],[46,52,53,50],[46,53,53,51],[46,54,53,52],[46,56,53,54],[46,58,53,56],[46,59,53,57],[47,12,54,10],[47,16,54,14,"height"],[47,22,54,20],[47,25,54,23,"highestResolution"],[47,42,54,40],[47,44,54,42],[48,14,55,12,"highestResolution"],[48,31,55,29],[48,34,55,32,"height"],[48,40,55,38],[49,14,56,12,"resolutionString"],[49,30,56,28],[49,33,56,31],[49,36,56,34,"height"],[49,42,56,40],[49,45,56,43],[50,12,57,10],[51,10,58,8],[52,8,59,6],[53,6,60,4],[54,6,62,4],[54,12,62,10,"parseEnd"],[54,20,62,18],[54,23,62,21,"performance"],[54,34,62,32],[54,35,62,33,"now"],[54,38,62,36],[54,39,62,37],[54,40,62,38],[55,6,63,4,"logger"],[55,12,63,10],[55,13,63,11,"info"],[55,17,63,15],[55,18,63,16],[55,46,63,44],[55,47,63,45,"parseEnd"],[55,55,63,53],[55,58,63,56,"parseStart"],[55,68,63,66],[55,70,63,68,"toFixed"],[55,77,63,75],[55,78,63,76],[55,79,63,77],[55,80,63,78],[55,94,63,92,"lines"],[55,99,63,97],[55,100,63,98,"length"],[55,106,63,104],[55,108,63,106],[55,109,63,107],[57,6,65,4],[58,6,66,4,"resolutionCache"],[58,21,66,19],[58,22,66,20,"url"],[58,25,66,23],[58,26,66,24],[58,29,66,27],[59,8,67,6,"resolution"],[59,18,67,16],[59,20,67,18,"resolutionString"],[59,36,67,34],[60,8,68,6,"timestamp"],[60,17,68,15],[60,19,68,17,"Date"],[60,23,68,21],[60,24,68,22,"now"],[60,27,68,25],[60,28,68,26],[61,6,69,4],[61,7,69,5],[62,6,71,4],[62,12,71,10,"perfEnd"],[62,19,71,17],[62,22,71,20,"performance"],[62,33,71,31],[62,34,71,32,"now"],[62,37,71,35],[62,38,71,36],[62,39,71,37],[63,6,72,4,"logger"],[63,12,72,10],[63,13,72,11,"info"],[63,17,72,15],[63,18,72,16],[63,70,72,68],[63,71,72,69,"perfEnd"],[63,78,72,76],[63,81,72,79,"perfStart"],[63,90,72,88],[63,92,72,90,"toFixed"],[63,99,72,97],[63,100,72,98],[63,101,72,99],[63,102,72,100],[63,121,72,119,"resolutionString"],[63,137,72,135],[63,139,72,137],[63,140,72,138],[64,6,74,4],[64,13,74,11,"resolutionString"],[64,29,74,27],[65,4,75,2],[65,5,75,3],[65,6,75,4],[65,13,75,11,"error"],[65,18,75,16],[65,20,75,18],[66,6,76,4],[66,12,76,10,"perfEnd"],[66,19,76,17],[66,22,76,20,"performance"],[66,33,76,31],[66,34,76,32,"now"],[66,37,76,35],[66,38,76,36],[66,39,76,37],[67,6,77,4,"logger"],[67,12,77,10],[67,13,77,11,"info"],[67,17,77,15],[67,18,77,16],[67,67,77,65],[67,68,77,66,"perfEnd"],[67,75,77,73],[67,78,77,76,"perfStart"],[67,87,77,85],[67,89,77,87,"toFixed"],[67,96,77,94],[67,97,77,95],[67,98,77,96],[67,99,77,97],[67,113,77,111,"error"],[67,118,77,116],[67,120,77,118],[67,121,77,119],[68,6,78,4],[68,13,78,11],[68,17,78,15],[69,4,79,2],[70,2,80,0],[70,3,80,1],[71,2,80,2,"exports"],[71,9,80,2],[71,10,80,2,"getResolutionFromM3U8"],[71,31,80,2],[71,34,80,2,"getResolutionFromM3U8"],[71,55,80,2],[72,0,80,2]],"functionMap":{"names":["<global>","getResolutionFromM3U8"],"mappings":"AAA;qCCY;CDmE"}},"type":"js/module"}]}