{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":131,"column":2,"index":4333}}],"key":"7kvm5yrOpz4NYiDi6sn4qxa8DVQ="}},{"name":"react","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":56,"index":56}}],"key":"a4EMkKqamYWCMMPV7UeQlqGQ+ks="}},{"name":"expo-av","data":{"asyncType":null,"locs":[{"start":{"line":2,"column":0,"index":57},"end":{"line":2,"column":44,"index":101}}],"key":"NRThymhwYB6oVmZMWQGMPRPDfzs="}},{"name":"react-native-toast-message","data":{"asyncType":null,"locs":[{"start":{"line":3,"column":0,"index":102},"end":{"line":3,"column":47,"index":149}}],"key":"mvLfpRqMmyOUTnGhKaiVkXHegIo="}},{"name":"@/stores/playerStore","data":{"asyncType":null,"locs":[{"start":{"line":4,"column":0,"index":150},"end":{"line":4,"column":50,"index":200}}],"key":"jza9oGwrWwCRqRJcTBeVqZHqd+Y="}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _interopRequireDefault = require(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.useVideoHandlers = void 0;\n  var _react = require(_dependencyMap[1], \"react\");\n  var _expoAv = require(_dependencyMap[2], \"expo-av\");\n  var _reactNativeToastMessage = _interopRequireDefault(require(_dependencyMap[3], \"react-native-toast-message\"));\n  var _playerStore = _interopRequireDefault(require(_dependencyMap[4], \"@/stores/playerStore\"));\n  var _s = $RefreshSig$();\n  const useVideoHandlers = _ref => {\n    _s();\n    let {\n      videoRef,\n      currentEpisode,\n      initialPosition,\n      introEndTime,\n      playbackRate,\n      handlePlaybackStatusUpdate,\n      deviceType,\n      detail\n    } = _ref;\n    const onLoad = (0, _react.useCallback)(async () => {\n      console.info(`[PERF] Video onLoad - video ready to play`);\n      try {\n        // 1. 先设置位置（如果需要）\n        const jumpPosition = initialPosition || introEndTime || 0;\n        if (jumpPosition > 0) {\n          console.info(`[PERF] Setting initial position to ${jumpPosition}ms`);\n          await videoRef.current?.setPositionAsync(jumpPosition);\n        }\n\n        // 2. 显式调用播放以确保自动播放\n        console.info(`[AUTOPLAY] Attempting to start playback after onLoad`);\n        await videoRef.current?.playAsync();\n        console.info(`[AUTOPLAY] Auto-play successful after onLoad`);\n        _playerStore.default.setState({\n          isLoading: false\n        });\n        console.info(`[PERF] Video loading complete - isLoading set to false`);\n      } catch (error) {\n        console.warn(`[AUTOPLAY] Failed to auto-play after onLoad:`, error);\n        // 即使自动播放失败，也要设置加载完成状态\n        _playerStore.default.setState({\n          isLoading: false\n        });\n        // 不显示错误提示，因为自动播放失败是常见且预期的情况\n      }\n    }, [videoRef, initialPosition, introEndTime]);\n    const onLoadStart = (0, _react.useCallback)(() => {\n      if (!currentEpisode?.url) return;\n      console.info(`[PERF] Video onLoadStart - starting to load video: ${currentEpisode.url.substring(0, 100)}...`);\n      _playerStore.default.setState({\n        isLoading: true\n      });\n    }, [currentEpisode?.url]);\n    const onError = (0, _react.useCallback)(error => {\n      if (!currentEpisode?.url) return;\n      console.error(`[ERROR] Video playback error:`, error);\n\n      // 检测SSL证书错误和其他网络错误\n      const errorString = error?.error?.toString() || error?.toString() || '';\n      const isSSLError = errorString.includes('SSLHandshakeException') || errorString.includes('CertPathValidatorException') || errorString.includes('Trust anchor for certification path not found');\n      const isNetworkError = errorString.includes('HttpDataSourceException') || errorString.includes('IOException') || errorString.includes('SocketTimeoutException');\n      if (isSSLError) {\n        console.error(`[SSL_ERROR] SSL certificate validation failed for URL: ${currentEpisode.url}`);\n        _reactNativeToastMessage.default.show({\n          type: \"error\",\n          text1: \"SSL证书错误，正在尝试其他播放源...\",\n          text2: \"请稍候\"\n        });\n        _playerStore.default.getState().handleVideoError('ssl', currentEpisode.url);\n      } else if (isNetworkError) {\n        console.error(`[NETWORK_ERROR] Network connection failed for URL: ${currentEpisode.url}`);\n        _reactNativeToastMessage.default.show({\n          type: \"error\",\n          text1: \"网络连接失败，正在尝试其他播放源...\",\n          text2: \"请稍候\"\n        });\n        _playerStore.default.getState().handleVideoError('network', currentEpisode.url);\n      } else {\n        console.error(`[VIDEO_ERROR] Other video error for URL: ${currentEpisode.url}`);\n        _reactNativeToastMessage.default.show({\n          type: \"error\",\n          text1: \"视频播放失败，正在尝试其他播放源...\",\n          text2: \"请稍候\"\n        });\n        _playerStore.default.getState().handleVideoError('other', currentEpisode.url);\n      }\n    }, [currentEpisode?.url]);\n\n    // 优化的Video组件props\n    const videoProps = (0, _react.useMemo)(() => ({\n      source: {\n        uri: currentEpisode?.url || ''\n      },\n      posterSource: {\n        uri: detail?.poster ?? \"\"\n      },\n      resizeMode: _expoAv.ResizeMode.CONTAIN,\n      rate: playbackRate,\n      onPlaybackStatusUpdate: handlePlaybackStatusUpdate,\n      onLoad,\n      onLoadStart,\n      onError,\n      useNativeControls: deviceType !== 'tv',\n      shouldPlay: true\n    }), [currentEpisode?.url, detail?.poster, playbackRate, handlePlaybackStatusUpdate, onLoad, onLoadStart, onError, deviceType]);\n    return {\n      onLoad,\n      onLoadStart,\n      onError,\n      videoProps\n    };\n  };\n  exports.useVideoHandlers = useVideoHandlers;\n  _s(useVideoHandlers, \"llC59KM5FctwvBZWx7wUXkC8V5Q=\");\n});","lineCount":119,"map":[[7,2,1,0],[7,6,1,0,"_react"],[7,12,1,0],[7,15,1,0,"require"],[7,22,1,0],[7,23,1,0,"_dependencyMap"],[7,37,1,0],[8,2,2,0],[8,6,2,0,"_expoAv"],[8,13,2,0],[8,16,2,0,"require"],[8,23,2,0],[8,24,2,0,"_dependencyMap"],[8,38,2,0],[9,2,3,0],[9,6,3,0,"_reactNativeToastMessage"],[9,30,3,0],[9,33,3,0,"_interopRequireDefault"],[9,55,3,0],[9,56,3,0,"require"],[9,63,3,0],[9,64,3,0,"_dependencyMap"],[9,78,3,0],[10,2,4,0],[10,6,4,0,"_playerStore"],[10,18,4,0],[10,21,4,0,"_interopRequireDefault"],[10,43,4,0],[10,44,4,0,"require"],[10,51,4,0],[10,52,4,0,"_dependencyMap"],[10,66,4,0],[11,2,4,50],[11,6,4,50,"_s"],[11,8,4,50],[11,11,4,50,"$RefreshSig$"],[11,23,4,50],[12,2,17,7],[12,8,17,13,"useVideoHandlers"],[12,24,17,29],[12,27,17,32,"_ref"],[12,31,17,32],[12,35,26,29],[13,4,26,29,"_s"],[13,6,26,29],[14,4,26,29],[14,8,17,33],[15,6,18,2,"videoRef"],[15,14,18,10],[16,6,19,2,"currentEpisode"],[16,20,19,16],[17,6,20,2,"initialPosition"],[17,21,20,17],[18,6,21,2,"introEndTime"],[18,18,21,14],[19,6,22,2,"playbackRate"],[19,18,22,14],[20,6,23,2,"handlePlaybackStatusUpdate"],[20,32,23,28],[21,6,24,2,"deviceType"],[21,16,24,12],[22,6,25,2,"detail"],[23,4,26,23],[23,5,26,24],[23,8,26,24,"_ref"],[23,12,26,24],[24,4,28,2],[24,10,28,8,"onLoad"],[24,16,28,14],[24,19,28,17],[24,23,28,17,"useCallback"],[24,41,28,28],[24,43,28,29],[24,55,28,41],[25,6,29,4,"console"],[25,13,29,11],[25,14,29,12,"info"],[25,18,29,16],[25,19,29,17],[25,62,29,60],[25,63,29,61],[26,6,31,4],[26,10,31,8],[27,8,32,6],[28,8,33,6],[28,14,33,12,"jumpPosition"],[28,26,33,24],[28,29,33,27,"initialPosition"],[28,44,33,42],[28,48,33,46,"introEndTime"],[28,60,33,58],[28,64,33,62],[28,65,33,63],[29,8,34,6],[29,12,34,10,"jumpPosition"],[29,24,34,22],[29,27,34,25],[29,28,34,26],[29,30,34,28],[30,10,35,8,"console"],[30,17,35,15],[30,18,35,16,"info"],[30,22,35,20],[30,23,35,21],[30,61,35,59,"jumpPosition"],[30,73,35,71],[30,77,35,75],[30,78,35,76],[31,10,36,8],[31,16,36,14,"videoRef"],[31,24,36,22],[31,25,36,23,"current"],[31,32,36,30],[31,34,36,32,"setPositionAsync"],[31,50,36,48],[31,51,36,49,"jumpPosition"],[31,63,36,61],[31,64,36,62],[32,8,37,6],[34,8,39,6],[35,8,40,6,"console"],[35,15,40,13],[35,16,40,14,"info"],[35,20,40,18],[35,21,40,19],[35,75,40,73],[35,76,40,74],[36,8,41,6],[36,14,41,12,"videoRef"],[36,22,41,20],[36,23,41,21,"current"],[36,30,41,28],[36,32,41,30,"playAsync"],[36,41,41,39],[36,42,41,40],[36,43,41,41],[37,8,42,6,"console"],[37,15,42,13],[37,16,42,14,"info"],[37,20,42,18],[37,21,42,19],[37,67,42,65],[37,68,42,66],[38,8,44,6,"usePlayerStore"],[38,28,44,20],[38,29,44,21,"setState"],[38,37,44,29],[38,38,44,30],[39,10,44,32,"isLoading"],[39,19,44,41],[39,21,44,43],[40,8,44,49],[40,9,44,50],[40,10,44,51],[41,8,45,6,"console"],[41,15,45,13],[41,16,45,14,"info"],[41,20,45,18],[41,21,45,19],[41,77,45,75],[41,78,45,76],[42,6,46,4],[42,7,46,5],[42,8,46,6],[42,15,46,13,"error"],[42,20,46,18],[42,22,46,20],[43,8,47,6,"console"],[43,15,47,13],[43,16,47,14,"warn"],[43,20,47,18],[43,21,47,19],[43,67,47,65],[43,69,47,67,"error"],[43,74,47,72],[43,75,47,73],[44,8,48,6],[45,8,49,6,"usePlayerStore"],[45,28,49,20],[45,29,49,21,"setState"],[45,37,49,29],[45,38,49,30],[46,10,49,32,"isLoading"],[46,19,49,41],[46,21,49,43],[47,8,49,49],[47,9,49,50],[47,10,49,51],[48,8,50,6],[49,6,51,4],[50,4,52,2],[50,5,52,3],[50,7,52,5],[50,8,52,6,"videoRef"],[50,16,52,14],[50,18,52,16,"initialPosition"],[50,33,52,31],[50,35,52,33,"introEndTime"],[50,47,52,45],[50,48,52,46],[50,49,52,47],[51,4,54,2],[51,10,54,8,"onLoadStart"],[51,21,54,19],[51,24,54,22],[51,28,54,22,"useCallback"],[51,46,54,33],[51,48,54,34],[51,54,54,40],[52,6,55,4],[52,10,55,8],[52,11,55,9,"currentEpisode"],[52,25,55,23],[52,27,55,25,"url"],[52,30,55,28],[52,32,55,30],[53,6,57,4,"console"],[53,13,57,11],[53,14,57,12,"info"],[53,18,57,16],[53,19,57,17],[53,73,57,71,"currentEpisode"],[53,87,57,85],[53,88,57,86,"url"],[53,91,57,89],[53,92,57,90,"substring"],[53,101,57,99],[53,102,57,100],[53,103,57,101],[53,105,57,103],[53,108,57,106],[53,109,57,107],[53,114,57,112],[53,115,57,113],[54,6,58,4,"usePlayerStore"],[54,26,58,18],[54,27,58,19,"setState"],[54,35,58,27],[54,36,58,28],[55,8,58,30,"isLoading"],[55,17,58,39],[55,19,58,41],[56,6,58,46],[56,7,58,47],[56,8,58,48],[57,4,59,2],[57,5,59,3],[57,7,59,5],[57,8,59,6,"currentEpisode"],[57,22,59,20],[57,24,59,22,"url"],[57,27,59,25],[57,28,59,26],[57,29,59,27],[58,4,61,2],[58,10,61,8,"onError"],[58,17,61,15],[58,20,61,18],[58,24,61,18,"useCallback"],[58,42,61,29],[58,44,61,31,"error"],[58,49,61,41],[58,53,61,46],[59,6,62,4],[59,10,62,8],[59,11,62,9,"currentEpisode"],[59,25,62,23],[59,27,62,25,"url"],[59,30,62,28],[59,32,62,30],[60,6,64,4,"console"],[60,13,64,11],[60,14,64,12,"error"],[60,19,64,17],[60,20,64,18],[60,51,64,49],[60,53,64,51,"error"],[60,58,64,56],[60,59,64,57],[62,6,66,4],[63,6,67,4],[63,12,67,10,"errorString"],[63,23,67,21],[63,26,67,25,"error"],[63,31,67,30],[63,33,67,40,"error"],[63,38,67,45],[63,40,67,47,"toString"],[63,48,67,55],[63,49,67,56],[63,50,67,57],[63,54,67,61,"error"],[63,59,67,66],[63,61,67,68,"toString"],[63,69,67,76],[63,70,67,77],[63,71,67,78],[63,75,67,82],[63,77,67,84],[64,6,68,4],[64,12,68,10,"isSSLError"],[64,22,68,20],[64,25,68,23,"errorString"],[64,36,68,34],[64,37,68,35,"includes"],[64,45,68,43],[64,46,68,44],[64,69,68,67],[64,70,68,68],[64,74,69,22,"errorString"],[64,85,69,33],[64,86,69,34,"includes"],[64,94,69,42],[64,95,69,43],[64,123,69,71],[64,124,69,72],[64,128,70,22,"errorString"],[64,139,70,33],[64,140,70,34,"includes"],[64,148,70,42],[64,149,70,43],[64,196,70,90],[64,197,70,91],[65,6,71,4],[65,12,71,10,"isNetworkError"],[65,26,71,24],[65,29,71,27,"errorString"],[65,40,71,38],[65,41,71,39,"includes"],[65,49,71,47],[65,50,71,48],[65,75,71,73],[65,76,71,74],[65,80,72,25,"errorString"],[65,91,72,36],[65,92,72,37,"includes"],[65,100,72,45],[65,101,72,46],[65,114,72,59],[65,115,72,60],[65,119,73,25,"errorString"],[65,130,73,36],[65,131,73,37,"includes"],[65,139,73,45],[65,140,73,46],[65,164,73,70],[65,165,73,71],[66,6,75,4],[66,10,75,8,"isSSLError"],[66,20,75,18],[66,22,75,20],[67,8,76,6,"console"],[67,15,76,13],[67,16,76,14,"error"],[67,21,76,19],[67,22,76,20],[67,80,76,78,"currentEpisode"],[67,94,76,92],[67,95,76,93,"url"],[67,98,76,96],[67,100,76,98],[67,101,76,99],[68,8,77,6,"Toast"],[68,40,77,11],[68,41,77,12,"show"],[68,45,77,16],[68,46,77,17],[69,10,78,8,"type"],[69,14,78,12],[69,16,78,14],[69,23,78,21],[70,10,79,8,"text1"],[70,15,79,13],[70,17,79,15],[70,39,79,37],[71,10,80,8,"text2"],[71,15,80,13],[71,17,80,15],[72,8,81,6],[72,9,81,7],[72,10,81,8],[73,8,82,6,"usePlayerStore"],[73,28,82,20],[73,29,82,21,"getState"],[73,37,82,29],[73,38,82,30],[73,39,82,31],[73,40,82,32,"handleVideoError"],[73,56,82,48],[73,57,82,49],[73,62,82,54],[73,64,82,56,"currentEpisode"],[73,78,82,70],[73,79,82,71,"url"],[73,82,82,74],[73,83,82,75],[74,6,83,4],[74,7,83,5],[74,13,83,11],[74,17,83,15,"isNetworkError"],[74,31,83,29],[74,33,83,31],[75,8,84,6,"console"],[75,15,84,13],[75,16,84,14,"error"],[75,21,84,19],[75,22,84,20],[75,76,84,74,"currentEpisode"],[75,90,84,88],[75,91,84,89,"url"],[75,94,84,92],[75,96,84,94],[75,97,84,95],[76,8,85,6,"Toast"],[76,40,85,11],[76,41,85,12,"show"],[76,45,85,16],[76,46,85,17],[77,10,86,8,"type"],[77,14,86,12],[77,16,86,14],[77,23,86,21],[78,10,87,8,"text1"],[78,15,87,13],[78,17,87,15],[78,38,87,36],[79,10,88,8,"text2"],[79,15,88,13],[79,17,88,15],[80,8,89,6],[80,9,89,7],[80,10,89,8],[81,8,90,6,"usePlayerStore"],[81,28,90,20],[81,29,90,21,"getState"],[81,37,90,29],[81,38,90,30],[81,39,90,31],[81,40,90,32,"handleVideoError"],[81,56,90,48],[81,57,90,49],[81,66,90,58],[81,68,90,60,"currentEpisode"],[81,82,90,74],[81,83,90,75,"url"],[81,86,90,78],[81,87,90,79],[82,6,91,4],[82,7,91,5],[82,13,91,11],[83,8,92,6,"console"],[83,15,92,13],[83,16,92,14,"error"],[83,21,92,19],[83,22,92,20],[83,66,92,64,"currentEpisode"],[83,80,92,78],[83,81,92,79,"url"],[83,84,92,82],[83,86,92,84],[83,87,92,85],[84,8,93,6,"Toast"],[84,40,93,11],[84,41,93,12,"show"],[84,45,93,16],[84,46,93,17],[85,10,94,8,"type"],[85,14,94,12],[85,16,94,14],[85,23,94,21],[86,10,95,8,"text1"],[86,15,95,13],[86,17,95,15],[86,38,95,36],[87,10,96,8,"text2"],[87,15,96,13],[87,17,96,15],[88,8,97,6],[88,9,97,7],[88,10,97,8],[89,8,98,6,"usePlayerStore"],[89,28,98,20],[89,29,98,21,"getState"],[89,37,98,29],[89,38,98,30],[89,39,98,31],[89,40,98,32,"handleVideoError"],[89,56,98,48],[89,57,98,49],[89,64,98,56],[89,66,98,58,"currentEpisode"],[89,80,98,72],[89,81,98,73,"url"],[89,84,98,76],[89,85,98,77],[90,6,99,4],[91,4,100,2],[91,5,100,3],[91,7,100,5],[91,8,100,6,"currentEpisode"],[91,22,100,20],[91,24,100,22,"url"],[91,27,100,25],[91,28,100,26],[91,29,100,27],[93,4,102,2],[94,4,103,2],[94,10,103,8,"videoProps"],[94,20,103,18],[94,23,103,21],[94,27,103,21,"useMemo"],[94,41,103,28],[94,43,103,29],[94,50,103,36],[95,6,104,4,"source"],[95,12,104,10],[95,14,104,12],[96,8,104,14,"uri"],[96,11,104,17],[96,13,104,19,"currentEpisode"],[96,27,104,33],[96,29,104,35,"url"],[96,32,104,38],[96,36,104,42],[97,6,104,45],[97,7,104,46],[98,6,105,4,"posterSource"],[98,18,105,16],[98,20,105,18],[99,8,105,20,"uri"],[99,11,105,23],[99,13,105,25,"detail"],[99,19,105,31],[99,21,105,33,"poster"],[99,27,105,39],[99,31,105,43],[100,6,105,46],[100,7,105,47],[101,6,106,4,"resizeMode"],[101,16,106,14],[101,18,106,16,"ResizeMode"],[101,36,106,26],[101,37,106,27,"CONTAIN"],[101,44,106,34],[102,6,107,4,"rate"],[102,10,107,8],[102,12,107,10,"playbackRate"],[102,24,107,22],[103,6,108,4,"onPlaybackStatusUpdate"],[103,28,108,26],[103,30,108,28,"handlePlaybackStatusUpdate"],[103,56,108,54],[104,6,109,4,"onLoad"],[104,12,109,10],[105,6,110,4,"onLoadStart"],[105,17,110,15],[106,6,111,4,"onError"],[106,13,111,11],[107,6,112,4,"useNativeControls"],[107,23,112,21],[107,25,112,23,"deviceType"],[107,35,112,33],[107,40,112,38],[107,44,112,42],[108,6,113,4,"shouldPlay"],[108,16,113,14],[108,18,113,16],[109,4,114,2],[109,5,114,3],[109,6,114,4],[109,8,114,6],[109,9,115,4,"currentEpisode"],[109,23,115,18],[109,25,115,20,"url"],[109,28,115,23],[109,30,116,4,"detail"],[109,36,116,10],[109,38,116,12,"poster"],[109,44,116,18],[109,46,117,4,"playbackRate"],[109,58,117,16],[109,60,118,4,"handlePlaybackStatusUpdate"],[109,86,118,30],[109,88,119,4,"onLoad"],[109,94,119,10],[109,96,120,4,"onLoadStart"],[109,107,120,15],[109,109,121,4,"onError"],[109,116,121,11],[109,118,122,4,"deviceType"],[109,128,122,14],[109,129,123,3],[109,130,123,4],[110,4,125,2],[110,11,125,9],[111,6,126,4,"onLoad"],[111,12,126,10],[112,6,127,4,"onLoadStart"],[112,17,127,15],[113,6,128,4,"onError"],[113,13,128,11],[114,6,129,4,"videoProps"],[115,4,130,2],[115,5,130,3],[116,2,131,0],[116,3,131,1],[117,2,131,2,"exports"],[117,9,131,2],[117,10,131,2,"useVideoHandlers"],[117,26,131,2],[117,29,131,2,"useVideoHandlers"],[117,45,131,2],[118,2,131,2,"_s"],[118,4,131,2],[118,5,17,13,"useVideoHandlers"],[118,21,17,29],[119,0,17,29]],"functionMap":{"names":["<global>","useVideoHandlers","onLoad","onLoadStart","onError","useMemo$argument_0"],"mappings":"AAA;gCCgB;6BCW;GDwB;kCEE;GFK;8BGE;GHuC;6BIG;IJW;CDiB"}},"type":"js/module"}]}