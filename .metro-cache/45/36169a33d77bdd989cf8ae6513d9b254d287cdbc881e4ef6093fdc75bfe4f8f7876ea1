{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":95,"column":4,"index":2830}}],"key":"7kvm5yrOpz4NYiDi6sn4qxa8DVQ="}},{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":95,"column":4,"index":2830}}],"key":"8I802z/QkQYw0PV6ZCqhBNDwn0Q="}},{"name":"zustand","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":33,"index":33}}],"key":"xFAZpEovr+Y5/UCynUzO0ntFekY="}},{"name":"../services/remoteControlService","data":{"asyncType":null,"locs":[{"start":{"line":2,"column":0,"index":34},"end":{"line":2,"column":72,"index":106}}],"key":"dI0O+QLR5AK0Heyu0Z3/vXbmxek="}},{"name":"../utils/Logger","data":{"asyncType":null,"locs":[{"start":{"line":3,"column":0,"index":107},"end":{"line":3,"column":37,"index":144}}],"key":"rD5UrWJd899SO1d///YpsfF5nbE="}},{"name":"react-native","data":{"asyncType":null,"locs":[{"start":{"line":4,"column":0,"index":145},"end":{"line":4,"column":40,"index":185}}],"key":"XEo4Z+Aarw9Y7I7ZLBt66vGLAVQ="}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _interopRequireDefault = require(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.useRemoteControlStore = void 0;\n  var _asyncToGenerator2 = _interopRequireDefault(require(_dependencyMap[1], \"@babel/runtime/helpers/asyncToGenerator\"));\n  var _zustand = require(_dependencyMap[2], \"zustand\");\n  var _remoteControlService = require(_dependencyMap[3], \"../services/remoteControlService\");\n  var _Logger = _interopRequireDefault(require(_dependencyMap[4], \"../utils/Logger\"));\n  var _reactNative = require(_dependencyMap[5], \"react-native\");\n  var logger = _Logger.default.withTag('RemoteControlStore');\n  var useRemoteControlStore = exports.useRemoteControlStore = (0, _zustand.create)(function (set, get) {\n    return {\n      isServerRunning: false,\n      serverUrl: null,\n      error: null,\n      isModalVisible: false,\n      lastMessage: null,\n      targetPage: null,\n      startServer: function () {\n        var _ref = (0, _asyncToGenerator2.default)(function* () {\n          if (get().isServerRunning) {\n            return;\n          }\n\n          // 在Web平台上禁用远程输入服务器功能\n          if (_reactNative.Platform.OS === 'web') {\n            var errorMessage = 'Web平台暂不支持远程输入功能';\n            logger.error('Cannot start server on web platform:', errorMessage);\n            set({\n              error: errorMessage\n            });\n            return;\n          }\n          _remoteControlService.remoteControlService.init({\n            onMessage: function (message) {\n              logger.debug('Received message:', message);\n              var currentState = get();\n              // Use the current targetPage from the store\n              set({\n                lastMessage: message,\n                targetPage: currentState.targetPage\n              });\n            },\n            onHandshake: function () {\n              logger.debug('Handshake successful');\n              set({\n                isModalVisible: false\n              });\n            }\n          });\n          try {\n            // 确保服务已正确初始化\n            if (!_remoteControlService.remoteControlService) {\n              throw new Error('远程控制服务未正确初始化');\n            }\n\n            // 检查服务是否已经运行\n            if (_remoteControlService.remoteControlService.isRunning()) {\n              logger.debug('Remote control service is already running');\n              return;\n            }\n            var url = yield _remoteControlService.remoteControlService.startServer();\n            logger.info('Server started, URL:', url);\n            set({\n              isServerRunning: true,\n              serverUrl: url,\n              error: null\n            });\n          } catch (error) {\n            var _errorMessage = error instanceof Error ? error.message : '启动失败，请强制退应用后重试。';\n            logger.error('Failed to start server:', _errorMessage);\n            set({\n              error: _errorMessage\n            });\n          }\n        });\n        return function startServer() {\n          return _ref.apply(this, arguments);\n        };\n      }(),\n      stopServer: function () {\n        if (get().isServerRunning) {\n          _remoteControlService.remoteControlService.stopServer();\n          set({\n            isServerRunning: false,\n            serverUrl: null\n          });\n        }\n      },\n      showModal: function (targetPage) {\n        return set({\n          isModalVisible: true,\n          targetPage\n        });\n      },\n      hideModal: function () {\n        return set({\n          isModalVisible: false,\n          targetPage: null\n        });\n      },\n      setMessage: function (message, targetPage) {\n        set({\n          lastMessage: `${message}_${Date.now()}`,\n          targetPage\n        });\n      },\n      clearMessage: function () {\n        set({\n          lastMessage: null,\n          targetPage: null\n        });\n      }\n    };\n  });\n});","lineCount":118,"map":[[8,2,1,0],[8,6,1,0,"_zustand"],[8,14,1,0],[8,17,1,0,"require"],[8,24,1,0],[8,25,1,0,"_dependencyMap"],[8,39,1,0],[9,2,2,0],[9,6,2,0,"_remoteControlService"],[9,27,2,0],[9,30,2,0,"require"],[9,37,2,0],[9,38,2,0,"_dependencyMap"],[9,52,2,0],[10,2,3,0],[10,6,3,0,"_Logger"],[10,13,3,0],[10,16,3,0,"_interopRequireDefault"],[10,38,3,0],[10,39,3,0,"require"],[10,46,3,0],[10,47,3,0,"_dependencyMap"],[10,61,3,0],[11,2,4,0],[11,6,4,0,"_reactNative"],[11,18,4,0],[11,21,4,0,"require"],[11,28,4,0],[11,29,4,0,"_dependencyMap"],[11,43,4,0],[12,2,6,0],[12,6,6,6,"logger"],[12,12,6,12],[12,15,6,15,"Logger"],[12,30,6,21],[12,31,6,22,"withTag"],[12,38,6,29],[12,39,6,30],[12,59,6,50],[12,60,6,51],[13,2,23,7],[13,6,23,13,"useRemoteControlStore"],[13,27,23,34],[13,30,23,34,"exports"],[13,37,23,34],[13,38,23,34,"useRemoteControlStore"],[13,59,23,34],[13,62,23,37],[13,66,23,37,"create"],[13,81,23,43],[13,83,23,64],[13,93,23,65,"set"],[13,96,23,68],[13,98,23,70,"get"],[13,101,23,73],[14,4,23,73],[14,11,23,79],[15,6,24,2,"isServerRunning"],[15,21,24,17],[15,23,24,19],[15,28,24,24],[16,6,25,2,"serverUrl"],[16,15,25,11],[16,17,25,13],[16,21,25,17],[17,6,26,2,"error"],[17,11,26,7],[17,13,26,9],[17,17,26,13],[18,6,27,2,"isModalVisible"],[18,20,27,16],[18,22,27,18],[18,27,27,23],[19,6,28,2,"lastMessage"],[19,17,28,13],[19,19,28,15],[19,23,28,19],[20,6,29,2,"targetPage"],[20,16,29,12],[20,18,29,14],[20,22,29,18],[21,6,31,2,"startServer"],[21,17,31,13],[22,8,31,13],[22,12,31,13,"_ref"],[22,16,31,13],[22,23,31,13,"_asyncToGenerator2"],[22,41,31,13],[22,42,31,13,"default"],[22,49,31,13],[22,51,31,15],[22,64,31,27],[23,10,32,4],[23,14,32,8,"get"],[23,17,32,11],[23,18,32,12],[23,19,32,13],[23,20,32,14,"isServerRunning"],[23,35,32,29],[23,37,32,31],[24,12,33,6],[25,10,34,4],[27,10,36,4],[28,10,37,4],[28,14,37,8,"Platform"],[28,35,37,16],[28,36,37,17,"OS"],[28,38,37,19],[28,43,37,24],[28,48,37,29],[28,50,37,31],[29,12,38,6],[29,16,38,12,"errorMessage"],[29,28,38,24],[29,31,38,27],[29,48,38,44],[30,12,39,6,"logger"],[30,18,39,12],[30,19,39,13,"error"],[30,24,39,18],[30,25,39,19],[30,63,39,57],[30,65,39,59,"errorMessage"],[30,77,39,71],[30,78,39,72],[31,12,40,6,"set"],[31,15,40,9],[31,16,40,10],[32,14,40,12,"error"],[32,19,40,17],[32,21,40,19,"errorMessage"],[33,12,40,32],[33,13,40,33],[33,14,40,34],[34,12,41,6],[35,10,42,4],[36,10,44,4,"remoteControlService"],[36,52,44,24],[36,53,44,25,"init"],[36,57,44,29],[36,58,44,30],[37,12,45,6,"onMessage"],[37,21,45,15],[37,23,45,17],[37,32,45,17,"onMessage"],[37,33,45,18,"message"],[37,40,45,33],[37,42,45,38],[38,14,46,8,"logger"],[38,20,46,14],[38,21,46,15,"debug"],[38,26,46,20],[38,27,46,21],[38,46,46,40],[38,48,46,42,"message"],[38,55,46,49],[38,56,46,50],[39,14,47,8],[39,18,47,14,"currentState"],[39,30,47,26],[39,33,47,29,"get"],[39,36,47,32],[39,37,47,33],[39,38,47,34],[40,14,48,8],[41,14,49,8,"set"],[41,17,49,11],[41,18,49,12],[42,16,49,14,"lastMessage"],[42,27,49,25],[42,29,49,27,"message"],[42,36,49,34],[43,16,49,36,"targetPage"],[43,26,49,46],[43,28,49,48,"currentState"],[43,40,49,60],[43,41,49,61,"targetPage"],[44,14,49,72],[44,15,49,73],[44,16,49,74],[45,12,50,6],[45,13,50,7],[46,12,51,6,"onHandshake"],[46,23,51,17],[46,25,51,19],[46,34,51,19,"onHandshake"],[46,35,51,19],[46,37,51,25],[47,14,52,8,"logger"],[47,20,52,14],[47,21,52,15,"debug"],[47,26,52,20],[47,27,52,21],[47,49,52,43],[47,50,52,44],[48,14,53,8,"set"],[48,17,53,11],[48,18,53,12],[49,16,53,14,"isModalVisible"],[49,30,53,28],[49,32,53,30],[50,14,53,36],[50,15,53,37],[50,16,53,38],[51,12,54,6],[52,10,55,4],[52,11,55,5],[52,12,55,6],[53,10,56,4],[53,14,56,8],[54,12,57,6],[55,12,58,6],[55,16,58,10],[55,17,58,11,"remoteControlService"],[55,59,58,31],[55,61,58,33],[56,14,59,8],[56,20,59,14],[56,24,59,18,"Error"],[56,29,59,23],[56,30,59,24],[56,44,59,38],[56,45,59,39],[57,12,60,6],[59,12,62,6],[60,12,63,6],[60,16,63,10,"remoteControlService"],[60,58,63,30],[60,59,63,31,"isRunning"],[60,68,63,40],[60,69,63,41],[60,70,63,42],[60,72,63,44],[61,14,64,8,"logger"],[61,20,64,14],[61,21,64,15,"debug"],[61,26,64,20],[61,27,64,21],[61,70,64,64],[61,71,64,65],[62,14,65,8],[63,12,66,6],[64,12,68,6],[64,16,68,12,"url"],[64,19,68,15],[64,28,68,24,"remoteControlService"],[64,70,68,44],[64,71,68,45,"startServer"],[64,82,68,56],[64,83,68,57],[64,84,68,58],[65,12,69,6,"logger"],[65,18,69,12],[65,19,69,13,"info"],[65,23,69,17],[65,24,69,18],[65,46,69,40],[65,48,69,42,"url"],[65,51,69,45],[65,52,69,46],[66,12,70,6,"set"],[66,15,70,9],[66,16,70,10],[67,14,70,12,"isServerRunning"],[67,29,70,27],[67,31,70,29],[67,35,70,33],[68,14,70,35,"serverUrl"],[68,23,70,44],[68,25,70,46,"url"],[68,28,70,49],[69,14,70,51,"error"],[69,19,70,56],[69,21,70,58],[70,12,70,63],[70,13,70,64],[70,14,70,65],[71,10,71,4],[71,11,71,5],[71,12,71,6],[71,19,71,13,"error"],[71,24,71,18],[71,26,71,20],[72,12,72,6],[72,16,72,12,"errorMessage"],[72,29,72,24],[72,32,72,27,"error"],[72,37,72,32],[72,49,72,44,"Error"],[72,54,72,49],[72,57,72,52,"error"],[72,62,72,57],[72,63,72,58,"message"],[72,70,72,65],[72,73,72,68],[72,90,72,85],[73,12,73,6,"logger"],[73,18,73,12],[73,19,73,13,"error"],[73,24,73,18],[73,25,73,19],[73,50,73,44],[73,52,73,46,"errorMessage"],[73,65,73,58],[73,66,73,59],[74,12,74,6,"set"],[74,15,74,9],[74,16,74,10],[75,14,74,12,"error"],[75,19,74,17],[75,21,74,19,"errorMessage"],[76,12,74,32],[76,13,74,33],[76,14,74,34],[77,10,75,4],[78,8,76,2],[78,9,76,3],[79,8,76,3],[79,24,31,2,"startServer"],[79,35,31,13,"startServer"],[79,36,31,13],[80,10,31,13],[80,17,31,13,"_ref"],[80,21,31,13],[80,22,31,13,"apply"],[80,27,31,13],[80,34,31,13,"arguments"],[80,43,31,13],[81,8,31,13],[82,6,31,13],[82,9,76,3],[83,6,78,2,"stopServer"],[83,16,78,12],[83,18,78,14],[83,27,78,14,"stopServer"],[83,28,78,14],[83,30,78,20],[84,8,79,4],[84,12,79,8,"get"],[84,15,79,11],[84,16,79,12],[84,17,79,13],[84,18,79,14,"isServerRunning"],[84,33,79,29],[84,35,79,31],[85,10,80,6,"remoteControlService"],[85,52,80,26],[85,53,80,27,"stopServer"],[85,63,80,37],[85,64,80,38],[85,65,80,39],[86,10,81,6,"set"],[86,13,81,9],[86,14,81,10],[87,12,81,12,"isServerRunning"],[87,27,81,27],[87,29,81,29],[87,34,81,34],[88,12,81,36,"serverUrl"],[88,21,81,45],[88,23,81,47],[89,10,81,52],[89,11,81,53],[89,12,81,54],[90,8,82,4],[91,6,83,2],[91,7,83,3],[92,6,85,2,"showModal"],[92,15,85,11],[92,17,85,13],[92,26,85,13,"showModal"],[92,27,85,14,"targetPage"],[92,37,85,33],[93,8,85,33],[93,15,85,38,"set"],[93,18,85,41],[93,19,85,42],[94,10,85,44,"isModalVisible"],[94,24,85,58],[94,26,85,60],[94,30,85,64],[95,10,85,66,"targetPage"],[96,8,85,77],[96,9,85,78],[96,10,85,79],[97,6,85,79],[98,6,86,2,"hideModal"],[98,15,86,11],[98,17,86,13],[98,26,86,13,"hideModal"],[98,27,86,13],[99,8,86,13],[99,15,86,19,"set"],[99,18,86,22],[99,19,86,23],[100,10,86,25,"isModalVisible"],[100,24,86,39],[100,26,86,41],[100,31,86,46],[101,10,86,48,"targetPage"],[101,20,86,58],[101,22,86,60],[102,8,86,65],[102,9,86,66],[102,10,86,67],[103,6,86,67],[104,6,88,2,"setMessage"],[104,16,88,12],[104,18,88,14],[104,27,88,14,"setMessage"],[104,28,88,15,"message"],[104,35,88,30],[104,37,88,32,"targetPage"],[104,47,88,51],[104,49,88,56],[105,8,89,4,"set"],[105,11,89,7],[105,12,89,8],[106,10,89,10,"lastMessage"],[106,21,89,21],[106,23,89,23],[106,26,89,26,"message"],[106,33,89,33],[106,37,89,37,"Date"],[106,41,89,41],[106,42,89,42,"now"],[106,45,89,45],[106,46,89,46],[106,47,89,47],[106,49,89,49],[107,10,89,51,"targetPage"],[108,8,89,62],[108,9,89,63],[108,10,89,64],[109,6,90,2],[109,7,90,3],[110,6,92,2,"clearMessage"],[110,18,92,14],[110,20,92,16],[110,29,92,16,"clearMessage"],[110,30,92,16],[110,32,92,22],[111,8,93,4,"set"],[111,11,93,7],[111,12,93,8],[112,10,93,10,"lastMessage"],[112,21,93,21],[112,23,93,23],[112,27,93,27],[113,10,93,29,"targetPage"],[113,20,93,39],[113,22,93,41],[114,8,93,46],[114,9,93,47],[114,10,93,48],[115,6,94,2],[116,4,95,0],[116,5,95,1],[117,2,95,1],[117,3,95,2],[117,4,95,3],[118,0,95,4]],"functionMap":{"names":["<global>","create$argument_0","startServer","remoteControlService.init$argument_0.onMessage","remoteControlService.init$argument_0.onHandshake","stopServer","showModal","hideModal","setMessage","clearMessage"],"mappings":"AAA;gECsB;eCQ;iBCc;ODK;mBEC;OFG;GDsB;cIE;GJK;aKE,kEL;aMC,sDN;cOE;GPE;gBQE;GRE;EDC"}},"type":"js/module"}]}