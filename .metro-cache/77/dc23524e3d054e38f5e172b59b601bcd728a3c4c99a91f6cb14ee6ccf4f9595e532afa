{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":139,"column":2,"index":3736}}],"key":"7kvm5yrOpz4NYiDi6sn4qxa8DVQ="}},{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":139,"column":2,"index":3736}}],"key":"8I802z/QkQYw0PV6ZCqhBNDwn0Q="}},{"name":"@babel/runtime/helpers/slicedToArray","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":139,"column":2,"index":3736}}],"key":"EU+qeBIKi4KcIzPeK4PbkLqFqVY="}},{"name":"react","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":44,"index":44}}],"key":"a4EMkKqamYWCMMPV7UeQlqGQ+ks="}},{"name":"@/stores/settingsStore","data":{"asyncType":null,"locs":[{"start":{"line":2,"column":0,"index":45},"end":{"line":2,"column":58,"index":103}}],"key":"eV02vLtn6v4o2w8A7owZVbPhKIg="}},{"name":"@/services/api","data":{"asyncType":null,"locs":[{"start":{"line":3,"column":0,"index":104},"end":{"line":3,"column":37,"index":141}}],"key":"kVzDQdjnETfy4Hfg6zlHm9ALTDs="}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _interopRequireDefault = require(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.useApiConfig = exports.getApiConfigErrorMessage = void 0;\n  var _asyncToGenerator2 = _interopRequireDefault(require(_dependencyMap[1], \"@babel/runtime/helpers/asyncToGenerator\"));\n  var _slicedToArray2 = _interopRequireDefault(require(_dependencyMap[2], \"@babel/runtime/helpers/slicedToArray\"));\n  var _react = require(_dependencyMap[3], \"react\");\n  var _settingsStore = require(_dependencyMap[4], \"@/stores/settingsStore\");\n  var _api = require(_dependencyMap[5], \"@/services/api\");\n  var _s = $RefreshSig$();\n  var useApiConfig = function () {\n    _s();\n    var _useSettingsStore = (0, _settingsStore.useSettingsStore)(),\n      apiBaseUrl = _useSettingsStore.apiBaseUrl,\n      serverConfig = _useSettingsStore.serverConfig,\n      isLoadingServerConfig = _useSettingsStore.isLoadingServerConfig;\n    var _useState = (0, _react.useState)({\n        isValidating: false,\n        isValid: null,\n        error: null\n      }),\n      _useState2 = (0, _slicedToArray2.default)(_useState, 2),\n      validationState = _useState2[0],\n      setValidationState = _useState2[1];\n    var isConfigured = Boolean(apiBaseUrl && apiBaseUrl.trim());\n    var needsConfiguration = !isConfigured;\n\n    // Validate API configuration when it changes\n    (0, _react.useEffect)(function () {\n      if (!isConfigured) {\n        setValidationState({\n          isValidating: false,\n          isValid: false,\n          error: null\n        });\n        return;\n      }\n      var validateConfig = /*#__PURE__*/function () {\n        var _ref = (0, _asyncToGenerator2.default)(function* () {\n          setValidationState(function (prev) {\n            return {\n              ...prev,\n              isValidating: true,\n              error: null\n            };\n          });\n          try {\n            yield _api.api.getServerConfig();\n            setValidationState({\n              isValidating: false,\n              isValid: true,\n              error: null\n            });\n          } catch (error) {\n            var errorMessage = '服务器连接失败';\n            if (error instanceof Error) {\n              switch (error.message) {\n                case 'API_URL_NOT_SET':\n                  errorMessage = 'API地址未设置';\n                  break;\n                case 'UNAUTHORIZED':\n                  errorMessage = '服务器认证失败';\n                  break;\n                default:\n                  if (error.message.includes('Network')) {\n                    errorMessage = '网络连接失败，请检查网络或服务器地址';\n                  } else if (error.message.includes('timeout')) {\n                    errorMessage = '连接超时，请检查服务器地址';\n                  } else if (error.message.includes('404')) {\n                    errorMessage = '服务器地址无效，请检查API路径';\n                  } else if (error.message.includes('500')) {\n                    errorMessage = '服务器内部错误';\n                  }\n                  break;\n              }\n            }\n            setValidationState({\n              isValidating: false,\n              isValid: false,\n              error: errorMessage\n            });\n          }\n        });\n        return function validateConfig() {\n          return _ref.apply(this, arguments);\n        };\n      }();\n\n      // Only validate if not already loading server config\n      if (!isLoadingServerConfig) {\n        validateConfig();\n      }\n    }, [apiBaseUrl, isConfigured, isLoadingServerConfig]);\n\n    // Reset validation when server config loading state changes\n    (0, _react.useEffect)(function () {\n      if (isLoadingServerConfig) {\n        setValidationState(function (prev) {\n          return {\n            ...prev,\n            isValidating: true,\n            error: null\n          };\n        });\n      }\n    }, [isLoadingServerConfig]);\n\n    // Update validation state based on server config\n    (0, _react.useEffect)(function () {\n      if (!isLoadingServerConfig && isConfigured) {\n        if (serverConfig) {\n          setValidationState(function (prev) {\n            return {\n              ...prev,\n              isValid: true,\n              error: null\n            };\n          });\n        } else {\n          setValidationState(function (prev) {\n            return {\n              ...prev,\n              isValid: false,\n              error: prev.error || '无法获取服务器配置'\n            };\n          });\n        }\n      }\n    }, [serverConfig, isLoadingServerConfig, isConfigured]);\n    var status = {\n      isConfigured,\n      isValidating: validationState.isValidating || isLoadingServerConfig,\n      isValid: validationState.isValid,\n      error: validationState.error,\n      needsConfiguration\n    };\n    return status;\n  };\n  exports.useApiConfig = useApiConfig;\n  _s(useApiConfig, \"taSK+pvopONN482YK7Ja3TDdukc=\", false, function () {\n    return [_settingsStore.useSettingsStore];\n  });\n  var getApiConfigErrorMessage = function (status) {\n    if (status.needsConfiguration) {\n      return '请点击右上角设置按钮，配置您的服务器地址';\n    }\n    if (status.error) {\n      return status.error;\n    }\n    if (status.isValidating) {\n      return '正在验证服务器配置...';\n    }\n    if (status.isValid === false) {\n      return '服务器配置验证失败，请检查设置';\n    }\n    return '加载失败，请重试';\n  };\n  exports.getApiConfigErrorMessage = getApiConfigErrorMessage;\n});","lineCount":161,"map":[[9,2,1,0],[9,6,1,0,"_react"],[9,12,1,0],[9,15,1,0,"require"],[9,22,1,0],[9,23,1,0,"_dependencyMap"],[9,37,1,0],[10,2,2,0],[10,6,2,0,"_settingsStore"],[10,20,2,0],[10,23,2,0,"require"],[10,30,2,0],[10,31,2,0,"_dependencyMap"],[10,45,2,0],[11,2,3,0],[11,6,3,0,"_api"],[11,10,3,0],[11,13,3,0,"require"],[11,20,3,0],[11,21,3,0,"_dependencyMap"],[11,35,3,0],[12,2,3,37],[12,6,3,37,"_s"],[12,8,3,37],[12,11,3,37,"$RefreshSig$"],[12,23,3,37],[13,2,13,7],[13,6,13,13,"useApiConfig"],[13,18,13,25],[13,21,13,28],[13,30,13,28,"useApiConfig"],[13,31,13,28],[13,33,13,34],[14,4,13,34,"_s"],[14,6,13,34],[15,4,14,2],[15,8,14,2,"_useSettingsStore"],[15,25,14,2],[15,28,14,62],[15,32,14,62,"useSettingsStore"],[15,63,14,78],[15,65,14,79],[15,66,14,80],[16,6,14,10,"apiBaseUrl"],[16,16,14,20],[16,19,14,20,"_useSettingsStore"],[16,36,14,20],[16,37,14,10,"apiBaseUrl"],[16,47,14,20],[17,6,14,22,"serverConfig"],[17,18,14,34],[17,21,14,34,"_useSettingsStore"],[17,38,14,34],[17,39,14,22,"serverConfig"],[17,51,14,34],[18,6,14,36,"isLoadingServerConfig"],[18,27,14,57],[18,30,14,57,"_useSettingsStore"],[18,47,14,57],[18,48,14,36,"isLoadingServerConfig"],[18,69,14,57],[19,4,15,2],[19,8,15,2,"_useState"],[19,17,15,2],[19,20,15,48],[19,24,15,48,"useState"],[19,39,15,56],[19,41,19,5],[20,8,20,4,"isValidating"],[20,20,20,16],[20,22,20,18],[20,27,20,23],[21,8,21,4,"isValid"],[21,15,21,11],[21,17,21,13],[21,21,21,17],[22,8,22,4,"error"],[22,13,22,9],[22,15,22,11],[23,6,23,2],[23,7,23,3],[23,8,23,4],[24,6,23,4,"_useState2"],[24,16,23,4],[24,23,23,4,"_slicedToArray2"],[24,38,23,4],[24,39,23,4,"default"],[24,46,23,4],[24,48,23,4,"_useState"],[24,57,23,4],[25,6,15,9,"validationState"],[25,21,15,24],[25,24,15,24,"_useState2"],[25,34,15,24],[26,6,15,26,"setValidationState"],[26,24,15,44],[26,27,15,44,"_useState2"],[26,37,15,44],[27,4,25,2],[27,8,25,8,"isConfigured"],[27,20,25,20],[27,23,25,23,"Boolean"],[27,30,25,30],[27,31,25,31,"apiBaseUrl"],[27,41,25,41],[27,45,25,45,"apiBaseUrl"],[27,55,25,55],[27,56,25,56,"trim"],[27,60,25,60],[27,61,25,61],[27,62,25,62],[27,63,25,63],[28,4,26,2],[28,8,26,8,"needsConfiguration"],[28,26,26,26],[28,29,26,29],[28,30,26,30,"isConfigured"],[28,42,26,42],[30,4,28,2],[31,4,29,2],[31,8,29,2,"useEffect"],[31,24,29,11],[31,26,29,12],[31,38,29,18],[32,6,30,4],[32,10,30,8],[32,11,30,9,"isConfigured"],[32,23,30,21],[32,25,30,23],[33,8,31,6,"setValidationState"],[33,26,31,24],[33,27,31,25],[34,10,32,8,"isValidating"],[34,22,32,20],[34,24,32,22],[34,29,32,27],[35,10,33,8,"isValid"],[35,17,33,15],[35,19,33,17],[35,24,33,22],[36,10,34,8,"error"],[36,15,34,13],[36,17,34,15],[37,8,35,6],[37,9,35,7],[37,10,35,8],[38,8,36,6],[39,6,37,4],[40,6,39,4],[40,10,39,10,"validateConfig"],[40,24,39,24],[41,8,39,24],[41,12,39,24,"_ref"],[41,16,39,24],[41,23,39,24,"_asyncToGenerator2"],[41,41,39,24],[41,42,39,24,"default"],[41,49,39,24],[41,51,39,27],[41,64,39,39],[42,10,40,6,"setValidationState"],[42,28,40,24],[42,29,40,25],[42,39,40,25,"prev"],[42,43,40,29],[43,12,40,29],[43,19,40,34],[44,14,40,36],[44,17,40,39,"prev"],[44,21,40,43],[45,14,40,45,"isValidating"],[45,26,40,57],[45,28,40,59],[45,32,40,63],[46,14,40,65,"error"],[46,19,40,70],[46,21,40,72],[47,12,40,77],[47,13,40,78],[48,10,40,78],[48,11,40,79],[48,12,40,80],[49,10,42,6],[49,14,42,10],[50,12,43,8],[50,18,43,14,"api"],[50,26,43,17],[50,27,43,18,"getServerConfig"],[50,42,43,33],[50,43,43,34],[50,44,43,35],[51,12,44,8,"setValidationState"],[51,30,44,26],[51,31,44,27],[52,14,45,10,"isValidating"],[52,26,45,22],[52,28,45,24],[52,33,45,29],[53,14,46,10,"isValid"],[53,21,46,17],[53,23,46,19],[53,27,46,23],[54,14,47,10,"error"],[54,19,47,15],[54,21,47,17],[55,12,48,8],[55,13,48,9],[55,14,48,10],[56,10,49,6],[56,11,49,7],[56,12,49,8],[56,19,49,15,"error"],[56,24,49,20],[56,26,49,22],[57,12,50,8],[57,16,50,12,"errorMessage"],[57,28,50,24],[57,31,50,27],[57,40,50,36],[58,12,52,8],[58,16,52,12,"error"],[58,21,52,17],[58,33,52,29,"Error"],[58,38,52,34],[58,40,52,36],[59,14,53,10],[59,22,53,18,"error"],[59,27,53,23],[59,28,53,24,"message"],[59,35,53,31],[60,16,54,12],[60,21,54,17],[60,38,54,34],[61,18,55,14,"errorMessage"],[61,30,55,26],[61,33,55,29],[61,43,55,39],[62,18,56,14],[63,16,57,12],[63,21,57,17],[63,35,57,31],[64,18,58,14,"errorMessage"],[64,30,58,26],[64,33,58,29],[64,42,58,38],[65,18,59,14],[66,16,60,12],[67,18,61,14],[67,22,61,18,"error"],[67,27,61,23],[67,28,61,24,"message"],[67,35,61,31],[67,36,61,32,"includes"],[67,44,61,40],[67,45,61,41],[67,54,61,50],[67,55,61,51],[67,57,61,53],[68,20,62,16,"errorMessage"],[68,32,62,28],[68,35,62,31],[68,55,62,51],[69,18,63,14],[69,19,63,15],[69,25,63,21],[69,29,63,25,"error"],[69,34,63,30],[69,35,63,31,"message"],[69,42,63,38],[69,43,63,39,"includes"],[69,51,63,47],[69,52,63,48],[69,61,63,57],[69,62,63,58],[69,64,63,60],[70,20,64,16,"errorMessage"],[70,32,64,28],[70,35,64,31],[70,50,64,46],[71,18,65,14],[71,19,65,15],[71,25,65,21],[71,29,65,25,"error"],[71,34,65,30],[71,35,65,31,"message"],[71,42,65,38],[71,43,65,39,"includes"],[71,51,65,47],[71,52,65,48],[71,57,65,53],[71,58,65,54],[71,60,65,56],[72,20,66,16,"errorMessage"],[72,32,66,28],[72,35,66,31],[72,53,66,49],[73,18,67,14],[73,19,67,15],[73,25,67,21],[73,29,67,25,"error"],[73,34,67,30],[73,35,67,31,"message"],[73,42,67,38],[73,43,67,39,"includes"],[73,51,67,47],[73,52,67,48],[73,57,67,53],[73,58,67,54],[73,60,67,56],[74,20,68,16,"errorMessage"],[74,32,68,28],[74,35,68,31],[74,44,68,40],[75,18,69,14],[76,18,70,14],[77,14,71,10],[78,12,72,8],[79,12,74,8,"setValidationState"],[79,30,74,26],[79,31,74,27],[80,14,75,10,"isValidating"],[80,26,75,22],[80,28,75,24],[80,33,75,29],[81,14,76,10,"isValid"],[81,21,76,17],[81,23,76,19],[81,28,76,24],[82,14,77,10,"error"],[82,19,77,15],[82,21,77,17,"errorMessage"],[83,12,78,8],[83,13,78,9],[83,14,78,10],[84,10,79,6],[85,8,80,4],[85,9,80,5],[86,8,80,5],[86,24,39,10,"validateConfig"],[86,38,39,24,"validateConfig"],[86,39,39,24],[87,10,39,24],[87,17,39,24,"_ref"],[87,21,39,24],[87,22,39,24,"apply"],[87,27,39,24],[87,34,39,24,"arguments"],[87,43,39,24],[88,8,39,24],[89,6,39,24],[89,9,80,5],[91,6,82,4],[92,6,83,4],[92,10,83,8],[92,11,83,9,"isLoadingServerConfig"],[92,32,83,30],[92,34,83,32],[93,8,84,6,"validateConfig"],[93,22,84,20],[93,23,84,21],[93,24,84,22],[94,6,85,4],[95,4,86,2],[95,5,86,3],[95,7,86,5],[95,8,86,6,"apiBaseUrl"],[95,18,86,16],[95,20,86,18,"isConfigured"],[95,32,86,30],[95,34,86,32,"isLoadingServerConfig"],[95,55,86,53],[95,56,86,54],[95,57,86,55],[97,4,88,2],[98,4,89,2],[98,8,89,2,"useEffect"],[98,24,89,11],[98,26,89,12],[98,38,89,18],[99,6,90,4],[99,10,90,8,"isLoadingServerConfig"],[99,31,90,29],[99,33,90,31],[100,8,91,6,"setValidationState"],[100,26,91,24],[100,27,91,25],[100,37,91,25,"prev"],[100,41,91,29],[101,10,91,29],[101,17,91,34],[102,12,91,36],[102,15,91,39,"prev"],[102,19,91,43],[103,12,91,45,"isValidating"],[103,24,91,57],[103,26,91,59],[103,30,91,63],[104,12,91,65,"error"],[104,17,91,70],[104,19,91,72],[105,10,91,77],[105,11,91,78],[106,8,91,78],[106,9,91,79],[106,10,91,80],[107,6,92,4],[108,4,93,2],[108,5,93,3],[108,7,93,5],[108,8,93,6,"isLoadingServerConfig"],[108,29,93,27],[108,30,93,28],[108,31,93,29],[110,4,95,2],[111,4,96,2],[111,8,96,2,"useEffect"],[111,24,96,11],[111,26,96,12],[111,38,96,18],[112,6,97,4],[112,10,97,8],[112,11,97,9,"isLoadingServerConfig"],[112,32,97,30],[112,36,97,34,"isConfigured"],[112,48,97,46],[112,50,97,48],[113,8,98,6],[113,12,98,10,"serverConfig"],[113,24,98,22],[113,26,98,24],[114,10,99,8,"setValidationState"],[114,28,99,26],[114,29,99,27],[114,39,99,27,"prev"],[114,43,99,31],[115,12,99,31],[115,19,99,36],[116,14,99,38],[116,17,99,41,"prev"],[116,21,99,45],[117,14,99,47,"isValid"],[117,21,99,54],[117,23,99,56],[117,27,99,60],[118,14,99,62,"error"],[118,19,99,67],[118,21,99,69],[119,12,99,74],[119,13,99,75],[120,10,99,75],[120,11,99,76],[120,12,99,77],[121,8,100,6],[121,9,100,7],[121,15,100,13],[122,10,101,8,"setValidationState"],[122,28,101,26],[122,29,101,27],[122,39,101,27,"prev"],[122,43,101,31],[123,12,101,31],[123,19,101,36],[124,14,102,10],[124,17,102,13,"prev"],[124,21,102,17],[125,14,103,10,"isValid"],[125,21,103,17],[125,23,103,19],[125,28,103,24],[126,14,104,10,"error"],[126,19,104,15],[126,21,104,17,"prev"],[126,25,104,21],[126,26,104,22,"error"],[126,31,104,27],[126,35,104,31],[127,12,105,8],[127,13,105,9],[128,10,105,9],[128,11,105,10],[128,12,105,11],[129,8,106,6],[130,6,107,4],[131,4,108,2],[131,5,108,3],[131,7,108,5],[131,8,108,6,"serverConfig"],[131,20,108,18],[131,22,108,20,"isLoadingServerConfig"],[131,43,108,41],[131,45,108,43,"isConfigured"],[131,57,108,55],[131,58,108,56],[131,59,108,57],[132,4,110,2],[132,8,110,8,"status"],[132,14,110,31],[132,17,110,34],[133,6,111,4,"isConfigured"],[133,18,111,16],[134,6,112,4,"isValidating"],[134,18,112,16],[134,20,112,18,"validationState"],[134,35,112,33],[134,36,112,34,"isValidating"],[134,48,112,46],[134,52,112,50,"isLoadingServerConfig"],[134,73,112,71],[135,6,113,4,"isValid"],[135,13,113,11],[135,15,113,13,"validationState"],[135,30,113,28],[135,31,113,29,"isValid"],[135,38,113,36],[136,6,114,4,"error"],[136,11,114,9],[136,13,114,11,"validationState"],[136,28,114,26],[136,29,114,27,"error"],[136,34,114,32],[137,6,115,4,"needsConfiguration"],[138,4,116,2],[138,5,116,3],[139,4,118,2],[139,11,118,9,"status"],[139,17,118,15],[140,2,119,0],[140,3,119,1],[141,2,119,2,"exports"],[141,9,119,2],[141,10,119,2,"useApiConfig"],[141,22,119,2],[141,25,119,2,"useApiConfig"],[141,37,119,2],[142,2,119,2,"_s"],[142,4,119,2],[142,5,13,13,"useApiConfig"],[142,17,13,25],[143,4,13,25],[143,12,14,62,"useSettingsStore"],[143,43,14,78],[144,2,14,78],[145,2,121,7],[145,6,121,13,"getApiConfigErrorMessage"],[145,30,121,37],[145,33,121,40],[145,42,121,40,"getApiConfigErrorMessage"],[145,43,121,41,"status"],[145,49,121,64],[145,51,121,77],[146,4,122,2],[146,8,122,6,"status"],[146,14,122,12],[146,15,122,13,"needsConfiguration"],[146,33,122,31],[146,35,122,33],[147,6,123,4],[147,13,123,11],[147,35,123,33],[148,4,124,2],[149,4,126,2],[149,8,126,6,"status"],[149,14,126,12],[149,15,126,13,"error"],[149,20,126,18],[149,22,126,20],[150,6,127,4],[150,13,127,11,"status"],[150,19,127,17],[150,20,127,18,"error"],[150,25,127,23],[151,4,128,2],[152,4,130,2],[152,8,130,6,"status"],[152,14,130,12],[152,15,130,13,"isValidating"],[152,27,130,25],[152,29,130,27],[153,6,131,4],[153,13,131,11],[153,27,131,25],[154,4,132,2],[155,4,134,2],[155,8,134,6,"status"],[155,14,134,12],[155,15,134,13,"isValid"],[155,22,134,20],[155,27,134,25],[155,32,134,30],[155,34,134,32],[156,6,135,4],[156,13,135,11],[156,30,135,28],[157,4,136,2],[158,4,138,2],[158,11,138,9],[158,21,138,19],[159,2,139,0],[159,3,139,1],[160,2,139,2,"exports"],[160,9,139,2],[160,10,139,2,"getApiConfigErrorMessage"],[160,34,139,2],[160,37,139,2,"getApiConfigErrorMessage"],[160,61,139,2],[161,0,139,2]],"functionMap":{"names":["<global>","useApiConfig","useEffect$argument_0","validateConfig","setValidationState$argument_0","getApiConfigErrorMessage"],"mappings":"AAA;4BCY;YCgB;2BCU;yBCC,sDD;KDwC;GDM;YCG;yBEE,sDF;GDE;YCG;2BEG,iDF;2BEE;UFI;GDG;CDW;wCKE;CLkB"}},"type":"js/module"}]}