{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":128,"column":0,"index":4070}}],"key":"7kvm5yrOpz4NYiDi6sn4qxa8DVQ="}},{"name":"zustand","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":33,"index":33}}],"key":"xFAZpEovr+Y5/UCynUzO0ntFekY="}},{"name":"@/services/storage","data":{"asyncType":null,"locs":[{"start":{"line":2,"column":0,"index":34},"end":{"line":2,"column":53,"index":87}}],"key":"v6jfO8eZLYQviiEcpnOAsesBT1k="}},{"name":"@/services/api","data":{"asyncType":null,"locs":[{"start":{"line":3,"column":0,"index":88},"end":{"line":3,"column":51,"index":139}}],"key":"kVzDQdjnETfy4Hfg6zlHm9ALTDs="}},{"name":"@/services/storageConfig","data":{"asyncType":null,"locs":[{"start":{"line":4,"column":0,"index":140},"end":{"line":4,"column":57,"index":197}}],"key":"M4Qdlekj0JhaVogi7vQAoYVD/vQ="}},{"name":"@/utils/Logger","data":{"asyncType":null,"locs":[{"start":{"line":5,"column":0,"index":198},"end":{"line":5,"column":36,"index":234}}],"key":"dpbJvsqVW0VVfFOl8dlhEC6KfVk="}},{"name":"@/stores/remoteControlStore","data":{"asyncType":null,"locs":[{"start":{"line":6,"column":0,"index":235},"end":{"line":6,"column":68,"index":303}}],"key":"5M+PCAoMd/m5AuGF4bipjXmKUek="}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _interopRequireDefault = require(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.useSettingsStore = void 0;\n  var _zustand = require(_dependencyMap[1], \"zustand\");\n  var _storage = require(_dependencyMap[2], \"@/services/storage\");\n  var _api = require(_dependencyMap[3], \"@/services/api\");\n  var _storageConfig = require(_dependencyMap[4], \"@/services/storageConfig\");\n  var _Logger = _interopRequireDefault(require(_dependencyMap[5], \"@/utils/Logger\"));\n  var _remoteControlStore = require(_dependencyMap[6], \"@/stores/remoteControlStore\");\n  const logger = _Logger.default.withTag('SettingsStore');\n  const useSettingsStore = exports.useSettingsStore = (0, _zustand.create)((set, get) => ({\n    apiBaseUrl: \"\",\n    m3uUrl: \"\",\n    liveStreamSources: [],\n    remoteInputEnabled: false,\n    isModalVisible: false,\n    serverConfig: null,\n    isLoadingServerConfig: false,\n    videoSource: {\n      enabledAll: true,\n      sources: {}\n    },\n    loadSettings: async () => {\n      const settings = await _storage.SettingsManager.get();\n      set({\n        apiBaseUrl: settings.apiBaseUrl,\n        m3uUrl: settings.m3uUrl,\n        remoteInputEnabled: settings.remoteInputEnabled || false,\n        videoSource: settings.videoSource || {\n          enabledAll: true,\n          sources: {}\n        }\n      });\n      if (settings.apiBaseUrl) {\n        _api.api.setBaseUrl(settings.apiBaseUrl);\n        await get().fetchServerConfig();\n      }\n    },\n    fetchServerConfig: async () => {\n      set({\n        isLoadingServerConfig: true\n      });\n      try {\n        const config = await _api.api.getServerConfig();\n        if (config) {\n          _storageConfig.storageConfig.setStorageType(config.StorageType);\n          set({\n            serverConfig: config\n          });\n        }\n      } catch (error) {\n        set({\n          serverConfig: null\n        });\n        logger.error(\"Failed to fetch server config:\", error);\n      } finally {\n        set({\n          isLoadingServerConfig: false\n        });\n      }\n    },\n    setApiBaseUrl: url => set({\n      apiBaseUrl: url\n    }),\n    setM3uUrl: url => set({\n      m3uUrl: url\n    }),\n    setRemoteInputEnabled: enabled => {\n      set({\n        remoteInputEnabled: enabled\n      });\n      // 根据设置启动或停止远程控制服务器\n      const remoteControlActions = _remoteControlStore.useRemoteControlStore.getState();\n      if (enabled) {\n        remoteControlActions.startServer().catch(error => {\n          logger.error(\"Failed to start remote control server:\", error);\n        });\n      } else {\n        remoteControlActions.stopServer();\n      }\n    },\n    setVideoSource: config => set({\n      videoSource: config\n    }),\n    saveSettings: async () => {\n      const {\n        apiBaseUrl,\n        m3uUrl,\n        remoteInputEnabled,\n        videoSource\n      } = get();\n      let processedApiBaseUrl = apiBaseUrl.trim();\n      if (processedApiBaseUrl.endsWith(\"/\")) {\n        processedApiBaseUrl = processedApiBaseUrl.slice(0, -1);\n      }\n      if (!/^https?:\\/\\//i.test(processedApiBaseUrl)) {\n        const hostPart = processedApiBaseUrl.split(\"/\")[0];\n        // Simple check for IP address format.\n        const isIpAddress = /^((\\d{1,3}\\.){3}\\d{1,3})(:\\d+)?$/.test(hostPart);\n        // Check if the domain includes a port.\n        const hasPort = /:\\d+/.test(hostPart);\n        if (isIpAddress || hasPort) {\n          processedApiBaseUrl = \"http://\" + processedApiBaseUrl;\n        } else {\n          processedApiBaseUrl = \"https://\" + processedApiBaseUrl;\n        }\n      }\n      await _storage.SettingsManager.save({\n        apiBaseUrl: processedApiBaseUrl,\n        m3uUrl,\n        remoteInputEnabled,\n        videoSource\n      });\n      _api.api.setBaseUrl(processedApiBaseUrl);\n      // Also update the URL in the state so the input field shows the processed URL\n      set({\n        isModalVisible: false,\n        apiBaseUrl: processedApiBaseUrl\n      });\n      await get().fetchServerConfig();\n    },\n    showModal: () => set({\n      isModalVisible: true\n    }),\n    hideModal: () => set({\n      isModalVisible: false\n    })\n  }));\n});","lineCount":132,"map":[[7,2,1,0],[7,6,1,0,"_zustand"],[7,14,1,0],[7,17,1,0,"require"],[7,24,1,0],[7,25,1,0,"_dependencyMap"],[7,39,1,0],[8,2,2,0],[8,6,2,0,"_storage"],[8,14,2,0],[8,17,2,0,"require"],[8,24,2,0],[8,25,2,0,"_dependencyMap"],[8,39,2,0],[9,2,3,0],[9,6,3,0,"_api"],[9,10,3,0],[9,13,3,0,"require"],[9,20,3,0],[9,21,3,0,"_dependencyMap"],[9,35,3,0],[10,2,4,0],[10,6,4,0,"_storageConfig"],[10,20,4,0],[10,23,4,0,"require"],[10,30,4,0],[10,31,4,0,"_dependencyMap"],[10,45,4,0],[11,2,5,0],[11,6,5,0,"_Logger"],[11,13,5,0],[11,16,5,0,"_interopRequireDefault"],[11,38,5,0],[11,39,5,0,"require"],[11,46,5,0],[11,47,5,0,"_dependencyMap"],[11,61,5,0],[12,2,6,0],[12,6,6,0,"_remoteControlStore"],[12,25,6,0],[12,28,6,0,"require"],[12,35,6,0],[12,36,6,0,"_dependencyMap"],[12,50,6,0],[13,2,8,0],[13,8,8,6,"logger"],[13,14,8,12],[13,17,8,15,"Logger"],[13,32,8,21],[13,33,8,22,"withTag"],[13,40,8,29],[13,41,8,30],[13,56,8,45],[13,57,8,46],[14,2,34,7],[14,8,34,13,"useSettingsStore"],[14,24,34,29],[14,27,34,29,"exports"],[14,34,34,29],[14,35,34,29,"useSettingsStore"],[14,51,34,29],[14,54,34,32],[14,58,34,32,"create"],[14,73,34,38],[14,75,34,54],[14,76,34,55,"set"],[14,79,34,58],[14,81,34,60,"get"],[14,84,34,63],[14,90,34,69],[15,4,35,2,"apiBaseUrl"],[15,14,35,12],[15,16,35,14],[15,18,35,16],[16,4,36,2,"m3uUrl"],[16,10,36,8],[16,12,36,10],[16,14,36,12],[17,4,37,2,"liveStreamSources"],[17,21,37,19],[17,23,37,21],[17,25,37,23],[18,4,38,2,"remoteInputEnabled"],[18,22,38,20],[18,24,38,22],[18,29,38,27],[19,4,39,2,"isModalVisible"],[19,18,39,16],[19,20,39,18],[19,25,39,23],[20,4,40,2,"serverConfig"],[20,16,40,14],[20,18,40,16],[20,22,40,20],[21,4,41,2,"isLoadingServerConfig"],[21,25,41,23],[21,27,41,25],[21,32,41,30],[22,4,42,2,"videoSource"],[22,15,42,13],[22,17,42,15],[23,6,43,4,"enabledAll"],[23,16,43,14],[23,18,43,16],[23,22,43,20],[24,6,44,4,"sources"],[24,13,44,11],[24,15,44,13],[24,16,44,14],[25,4,45,2],[25,5,45,3],[26,4,46,2,"loadSettings"],[26,16,46,14],[26,18,46,16],[26,24,46,16,"loadSettings"],[26,25,46,16],[26,30,46,28],[27,6,47,4],[27,12,47,10,"settings"],[27,20,47,18],[27,23,47,21],[27,29,47,27,"SettingsManager"],[27,53,47,42],[27,54,47,43,"get"],[27,57,47,46],[27,58,47,47],[27,59,47,48],[28,6,48,4,"set"],[28,9,48,7],[28,10,48,8],[29,8,49,6,"apiBaseUrl"],[29,18,49,16],[29,20,49,18,"settings"],[29,28,49,26],[29,29,49,27,"apiBaseUrl"],[29,39,49,37],[30,8,50,6,"m3uUrl"],[30,14,50,12],[30,16,50,14,"settings"],[30,24,50,22],[30,25,50,23,"m3uUrl"],[30,31,50,29],[31,8,51,6,"remoteInputEnabled"],[31,26,51,24],[31,28,51,26,"settings"],[31,36,51,34],[31,37,51,35,"remoteInputEnabled"],[31,55,51,53],[31,59,51,57],[31,64,51,62],[32,8,52,6,"videoSource"],[32,19,52,17],[32,21,52,19,"settings"],[32,29,52,27],[32,30,52,28,"videoSource"],[32,41,52,39],[32,45,52,43],[33,10,53,8,"enabledAll"],[33,20,53,18],[33,22,53,20],[33,26,53,24],[34,10,54,8,"sources"],[34,17,54,15],[34,19,54,17],[34,20,54,18],[35,8,55,6],[36,6,56,4],[36,7,56,5],[36,8,56,6],[37,6,57,4],[37,10,57,8,"settings"],[37,18,57,16],[37,19,57,17,"apiBaseUrl"],[37,29,57,27],[37,31,57,29],[38,8,58,6,"api"],[38,16,58,9],[38,17,58,10,"setBaseUrl"],[38,27,58,20],[38,28,58,21,"settings"],[38,36,58,29],[38,37,58,30,"apiBaseUrl"],[38,47,58,40],[38,48,58,41],[39,8,59,6],[39,14,59,12,"get"],[39,17,59,15],[39,18,59,16],[39,19,59,17],[39,20,59,18,"fetchServerConfig"],[39,37,59,35],[39,38,59,36],[39,39,59,37],[40,6,60,4],[41,4,61,2],[41,5,61,3],[42,4,62,2,"fetchServerConfig"],[42,21,62,19],[42,23,62,21],[42,29,62,21,"fetchServerConfig"],[42,30,62,21],[42,35,62,33],[43,6,63,4,"set"],[43,9,63,7],[43,10,63,8],[44,8,63,10,"isLoadingServerConfig"],[44,29,63,31],[44,31,63,33],[45,6,63,38],[45,7,63,39],[45,8,63,40],[46,6,64,4],[46,10,64,8],[47,8,65,6],[47,14,65,12,"config"],[47,20,65,18],[47,23,65,21],[47,29,65,27,"api"],[47,37,65,30],[47,38,65,31,"getServerConfig"],[47,53,65,46],[47,54,65,47],[47,55,65,48],[48,8,66,6],[48,12,66,10,"config"],[48,18,66,16],[48,20,66,18],[49,10,67,8,"storageConfig"],[49,38,67,21],[49,39,67,22,"setStorageType"],[49,53,67,36],[49,54,67,37,"config"],[49,60,67,43],[49,61,67,44,"StorageType"],[49,72,67,55],[49,73,67,56],[50,10,68,8,"set"],[50,13,68,11],[50,14,68,12],[51,12,68,14,"serverConfig"],[51,24,68,26],[51,26,68,28,"config"],[52,10,68,35],[52,11,68,36],[52,12,68,37],[53,8,69,6],[54,6,70,4],[54,7,70,5],[54,8,70,6],[54,15,70,13,"error"],[54,20,70,18],[54,22,70,20],[55,8,71,6,"set"],[55,11,71,9],[55,12,71,10],[56,10,71,12,"serverConfig"],[56,22,71,24],[56,24,71,26],[57,8,71,31],[57,9,71,32],[57,10,71,33],[58,8,72,6,"logger"],[58,14,72,12],[58,15,72,13,"error"],[58,20,72,18],[58,21,72,19],[58,53,72,51],[58,55,72,53,"error"],[58,60,72,58],[58,61,72,59],[59,6,73,4],[59,7,73,5],[59,16,73,14],[60,8,74,6,"set"],[60,11,74,9],[60,12,74,10],[61,10,74,12,"isLoadingServerConfig"],[61,31,74,33],[61,33,74,35],[62,8,74,41],[62,9,74,42],[62,10,74,43],[63,6,75,4],[64,4,76,2],[64,5,76,3],[65,4,77,2,"setApiBaseUrl"],[65,17,77,15],[65,19,77,18,"url"],[65,22,77,21],[65,26,77,26,"set"],[65,29,77,29],[65,30,77,30],[66,6,77,32,"apiBaseUrl"],[66,16,77,42],[66,18,77,44,"url"],[67,4,77,48],[67,5,77,49],[67,6,77,50],[68,4,78,2,"setM3uUrl"],[68,13,78,11],[68,15,78,14,"url"],[68,18,78,17],[68,22,78,22,"set"],[68,25,78,25],[68,26,78,26],[69,6,78,28,"m3uUrl"],[69,12,78,34],[69,14,78,36,"url"],[70,4,78,40],[70,5,78,41],[70,6,78,42],[71,4,79,2,"setRemoteInputEnabled"],[71,25,79,23],[71,27,79,26,"enabled"],[71,34,79,33],[71,38,79,38],[72,6,80,4,"set"],[72,9,80,7],[72,10,80,8],[73,8,80,10,"remoteInputEnabled"],[73,26,80,28],[73,28,80,30,"enabled"],[74,6,80,38],[74,7,80,39],[74,8,80,40],[75,6,81,4],[76,6,82,4],[76,12,82,10,"remoteControlActions"],[76,32,82,30],[76,35,82,33,"useRemoteControlStore"],[76,76,82,54],[76,77,82,55,"getState"],[76,85,82,63],[76,86,82,64],[76,87,82,65],[77,6,83,4],[77,10,83,8,"enabled"],[77,17,83,15],[77,19,83,17],[78,8,84,6,"remoteControlActions"],[78,28,84,26],[78,29,84,27,"startServer"],[78,40,84,38],[78,41,84,39],[78,42,84,40],[78,43,84,41,"catch"],[78,48,84,46],[78,49,84,47,"error"],[78,54,84,52],[78,58,84,56],[79,10,85,8,"logger"],[79,16,85,14],[79,17,85,15,"error"],[79,22,85,20],[79,23,85,21],[79,63,85,61],[79,65,85,63,"error"],[79,70,85,68],[79,71,85,69],[80,8,86,6],[80,9,86,7],[80,10,86,8],[81,6,87,4],[81,7,87,5],[81,13,87,11],[82,8,88,6,"remoteControlActions"],[82,28,88,26],[82,29,88,27,"stopServer"],[82,39,88,37],[82,40,88,38],[82,41,88,39],[83,6,89,4],[84,4,90,2],[84,5,90,3],[85,4,91,2,"setVideoSource"],[85,18,91,16],[85,20,91,19,"config"],[85,26,91,25],[85,30,91,30,"set"],[85,33,91,33],[85,34,91,34],[86,6,91,36,"videoSource"],[86,17,91,47],[86,19,91,49,"config"],[87,4,91,56],[87,5,91,57],[87,6,91,58],[88,4,92,2,"saveSettings"],[88,16,92,14],[88,18,92,16],[88,24,92,16,"saveSettings"],[88,25,92,16],[88,30,92,28],[89,6,93,4],[89,12,93,10],[90,8,93,12,"apiBaseUrl"],[90,18,93,22],[91,8,93,24,"m3uUrl"],[91,14,93,30],[92,8,93,32,"remoteInputEnabled"],[92,26,93,50],[93,8,93,52,"videoSource"],[94,6,93,64],[94,7,93,65],[94,10,93,68,"get"],[94,13,93,71],[94,14,93,72],[94,15,93,73],[95,6,95,4],[95,10,95,8,"processedApiBaseUrl"],[95,29,95,27],[95,32,95,30,"apiBaseUrl"],[95,42,95,40],[95,43,95,41,"trim"],[95,47,95,45],[95,48,95,46],[95,49,95,47],[96,6,96,4],[96,10,96,8,"processedApiBaseUrl"],[96,29,96,27],[96,30,96,28,"endsWith"],[96,38,96,36],[96,39,96,37],[96,42,96,40],[96,43,96,41],[96,45,96,43],[97,8,97,6,"processedApiBaseUrl"],[97,27,97,25],[97,30,97,28,"processedApiBaseUrl"],[97,49,97,47],[97,50,97,48,"slice"],[97,55,97,53],[97,56,97,54],[97,57,97,55],[97,59,97,57],[97,60,97,58],[97,61,97,59],[97,62,97,60],[98,6,98,4],[99,6,100,4],[99,10,100,8],[99,11,100,9],[99,26,100,24],[99,27,100,25,"test"],[99,31,100,29],[99,32,100,30,"processedApiBaseUrl"],[99,51,100,49],[99,52,100,50],[99,54,100,52],[100,8,101,6],[100,14,101,12,"hostPart"],[100,22,101,20],[100,25,101,23,"processedApiBaseUrl"],[100,44,101,42],[100,45,101,43,"split"],[100,50,101,48],[100,51,101,49],[100,54,101,52],[100,55,101,53],[100,56,101,54],[100,57,101,55],[100,58,101,56],[101,8,102,6],[102,8,103,6],[102,14,103,12,"isIpAddress"],[102,25,103,23],[102,28,103,26],[102,62,103,60],[102,63,103,61,"test"],[102,67,103,65],[102,68,103,66,"hostPart"],[102,76,103,74],[102,77,103,75],[103,8,104,6],[104,8,105,6],[104,14,105,12,"hasPort"],[104,21,105,19],[104,24,105,22],[104,30,105,28],[104,31,105,29,"test"],[104,35,105,33],[104,36,105,34,"hostPart"],[104,44,105,42],[104,45,105,43],[105,8,107,6],[105,12,107,10,"isIpAddress"],[105,23,107,21],[105,27,107,25,"hasPort"],[105,34,107,32],[105,36,107,34],[106,10,108,8,"processedApiBaseUrl"],[106,29,108,27],[106,32,108,30],[106,41,108,39],[106,44,108,42,"processedApiBaseUrl"],[106,63,108,61],[107,8,109,6],[107,9,109,7],[107,15,109,13],[108,10,110,8,"processedApiBaseUrl"],[108,29,110,27],[108,32,110,30],[108,42,110,40],[108,45,110,43,"processedApiBaseUrl"],[108,64,110,62],[109,8,111,6],[110,6,112,4],[111,6,114,4],[111,12,114,10,"SettingsManager"],[111,36,114,25],[111,37,114,26,"save"],[111,41,114,30],[111,42,114,31],[112,8,115,6,"apiBaseUrl"],[112,18,115,16],[112,20,115,18,"processedApiBaseUrl"],[112,39,115,37],[113,8,116,6,"m3uUrl"],[113,14,116,12],[114,8,117,6,"remoteInputEnabled"],[114,26,117,24],[115,8,118,6,"videoSource"],[116,6,119,4],[116,7,119,5],[116,8,119,6],[117,6,120,4,"api"],[117,14,120,7],[117,15,120,8,"setBaseUrl"],[117,25,120,18],[117,26,120,19,"processedApiBaseUrl"],[117,45,120,38],[117,46,120,39],[118,6,121,4],[119,6,122,4,"set"],[119,9,122,7],[119,10,122,8],[120,8,122,10,"isModalVisible"],[120,22,122,24],[120,24,122,26],[120,29,122,31],[121,8,122,33,"apiBaseUrl"],[121,18,122,43],[121,20,122,45,"processedApiBaseUrl"],[122,6,122,65],[122,7,122,66],[122,8,122,67],[123,6,123,4],[123,12,123,10,"get"],[123,15,123,13],[123,16,123,14],[123,17,123,15],[123,18,123,16,"fetchServerConfig"],[123,35,123,33],[123,36,123,34],[123,37,123,35],[124,4,124,2],[124,5,124,3],[125,4,125,2,"showModal"],[125,13,125,11],[125,15,125,13,"showModal"],[125,16,125,13],[125,21,125,19,"set"],[125,24,125,22],[125,25,125,23],[126,6,125,25,"isModalVisible"],[126,20,125,39],[126,22,125,41],[127,4,125,46],[127,5,125,47],[127,6,125,48],[128,4,126,2,"hideModal"],[128,13,126,11],[128,15,126,13,"hideModal"],[128,16,126,13],[128,21,126,19,"set"],[128,24,126,22],[128,25,126,23],[129,6,126,25,"isModalVisible"],[129,20,126,39],[129,22,126,41],[130,4,126,47],[130,5,126,48],[131,2,127,0],[131,3,127,1],[131,4,127,2],[131,5,127,3],[132,0,127,4]],"functionMap":{"names":["<global>","create$argument_0","loadSettings","fetchServerConfig","setApiBaseUrl","setM3uUrl","setRemoteInputEnabled","remoteControlActions.startServer._catch$argument_0","setVideoSource","saveSettings","showModal","hideModal"],"mappings":"AAA;sDCiC;gBCY;GDe;qBEC;GFc;iBGC,iCH;aIC,6BJ;yBKC;+CCK;ODE;GLI;kBOC,wCP;gBQC;GRgC;aSC,mCT;aUC,oCV;EDC"}},"type":"js/module"}]}