{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":154,"column":0,"index":5431}}],"key":"7kvm5yrOpz4NYiDi6sn4qxa8DVQ="}},{"name":"./tcpHttpServer","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":44,"index":44}}],"key":"ghesVyvsyW6gvmbDeKu+G4MWix0="}},{"name":"../utils/Logger","data":{"asyncType":null,"locs":[{"start":{"line":2,"column":0,"index":45},"end":{"line":2,"column":37,"index":82}}],"key":"rD5UrWJd899SO1d///YpsfF5nbE="}}],"output":[{"data":{"code":"__d(function(g,r,i,a,m,e,d){var t=r(d[0]);Object.defineProperty(e,\"__esModule\",{value:!0}),e.remoteControlService=void 0;var n=t(r(d[1]));const o=t(r(d[2])).default.withTag('RemoteControl');e.remoteControlService=new class{onMessage=()=>{};onHandshake=()=>{};constructor(){this.httpServer=new n.default,this.setupRequestHandler()}setupRequestHandler(){this.httpServer.setRequestHandler(t=>{o.debug(\"[RemoteControl] Received request:\",t.method,t.url);try{if(\"GET\"===t.method&&\"/\"===t.url)return{statusCode:200,headers:{\"Content-Type\":\"text/html; charset=utf-8\"},body:\"\\n  <!DOCTYPE html>\\n  <html>\\n  <head>\\n    <title>OrionTV Remote</title>\\n    <meta charset=\\\"UTF-8\\\">\\n    <meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1.0, user-scalable=no\\\">\\n    <style>\\n      body { font-family: -apple-system, BlinkMacSystemFont, \\\"Segoe UI\\\", Roboto, \\\"Helvetica Neue\\\", Arial, sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; background-color: #121212; color: white; }\\n      h3 { color: #eee; }\\n      #container { display: flex; flex-direction: column; align-items: center; width: 90%; max-width: 400px; }\\n      #text { width: 100%; padding: 15px; font-size: 16px; border-radius: 8px; border: 1px solid #333; background-color: #2a2a2a; color: white; margin-bottom: 20px; box-sizing: border-box; }\\n      button { width: 100%; padding: 15px; font-size: 18px; font-weight: bold; border: none; border-radius: 8px; background-color: #007AFF; color: white; cursor: pointer; }\\n      button:active { background-color: #0056b3; }\\n    </style>\\n  </head>\\n  <body>\\n    <div id=\\\"container\\\">\\n      <h3>\\u5411\\u7535\\u89c6\\u53d1\\u9001\\u6587\\u672c</h3>\\n      <input id=\\\"text\\\" placeholder=\\\"\\u8bf7\\u8f93\\u5165...\\\" />\\n      <button onclick=\\\"send()\\\">\\u53d1\\u9001</button>\\n    </div>\\n    <script>\\n      window.addEventListener('DOMContentLoaded', () => {\\n        fetch('/handshake', { method: 'POST' }).catch(err => logger.info('Handshake failed:', err));\\n      });\\n      function send() {\\n        const input = document.getElementById(\\\"text\\\");\\n        const value = input.value;\\n        if (value) {\\n          fetch(\\\"/message\\\", {\\n            method: 'POST',\\n            headers: { 'Content-Type': 'application/json' },\\n            body: JSON.stringify({ message: value })\\n          })\\n          .catch(err => logger.info('Message send failed:', err));\\n          input.value = '';\\n        }\\n      }\\n    <\\/script>\\n  </body>\\n  </html>\\n  \"};if(\"POST\"!==t.method||\"/message\"!==t.url)return\"POST\"===t.method&&\"/handshake\"===t.url?(this.onHandshake(),{statusCode:200,headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({status:\"ok\"})}):{statusCode:404,headers:{\"Content-Type\":\"text/plain\"},body:\"Not Found\"};try{const n=JSON.parse(t.body||\"{}\").message;return n&&this.onMessage(n),{statusCode:200,headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({status:\"ok\"})}}catch(t){return o.info(\"[RemoteControl] Failed to parse message body:\",t),{statusCode:400,headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({error:\"Invalid JSON\"})}}}catch(t){return o.info(\"[RemoteControl] Request handler error:\",t),{statusCode:500,headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({error:\"Internal Server Error\"})}}})}init(t){this.onMessage=t.onMessage,this.onHandshake=t.onHandshake}async startServer(){o.debug(\"[RemoteControl] Attempting to start server...\");try{this.httpServer&&this.httpServer.getIsRunning()&&(o.debug(\"[RemoteControl] Stopping existing server before restart...\"),this.httpServer.stop());const t=await this.httpServer.start();return o.debug(`[RemoteControl] Server started successfully at: ${t}`),t}catch(t){const n=t instanceof Error?t.message:\"\\u542f\\u52a8\\u5931\\u8d25\";throw o.info(\"[RemoteControl] Failed to start server:\",n),new Error(n)}}stopServer(){o.debug(\"[RemoteControl] Stopping server...\"),this.httpServer.stop()}isRunning(){return this.httpServer.getIsRunning()}}});","lineCount":1,"map":[[1,121,1,0],[1,125,1,0,"_tcpHttpServer"],[1,127,1,0,"_interopRequireDefault"],[1,129,1,0,"r"],[1,131,1,0,"d"],[1,133,1,0],[1,138,4,0],[1,144,4,6,"logger"],[1,146,2,0,"_interopRequireDefault"],[1,148,2,0,"r"],[1,150,2,0,"d"],[1,152,2,0],[1,157,4,15,"Logger"],[1,165,4,22,"withTag"],[1,173,4,30],[1,190,153,33,"e"],[1,192,153,33,"remoteControlService"],[1,213,153,36],[1,217,52,0],[1,223,54,10,"onMessage"],[1,233,54,49,"onMessage"],[1,240,55,10,"onHandshake"],[1,252,55,36,"onHandshake"],[1,259,57,2,"constructor"],[1,273,58,4,"this"],[1,278,58,9,"httpServer"],[1,289,58,22],[1,293,58,26,"TCPHttpServer"],[1,303,59,4,"this"],[1,308,59,9,"setupRequestHandler"],[1,329,60,2],[1,330,62,10,"setupRequestHandler"],[1,352,63,4,"this"],[1,357,63,9,"httpServer"],[1,368,63,20,"setRequestHandler"],[1,386,63,39,"request"],[1,390,64,6,"logger"],[1,392,64,13,"debug"],[1,398,64,19],[1,434,64,56,"request"],[1,436,64,64,"method"],[1,443,64,72,"request"],[1,445,64,80,"url"],[1,450,66,6],[1,454,67,8],[1,457,67,31],[1,465,67,12,"request"],[1,467,67,20,"method"],[1,475,67,56],[1,481,67,40,"request"],[1,483,67,48,"url"],[1,487,68,10],[1,493,68,17],[1,494,69,12,"statusCode"],[1,505,69,24],[1,509,70,12,"headers"],[1,517,70,21],[1,518,70,23],[1,533,70,39],[1,561,71,12,"body"],[1,566,7,9],[1,2554,73,15],[1,2557,73,38],[1,2566,73,19,"request"],[1,2568,73,27,"method"],[1,2576,73,64],[1,2589,73,48,"request"],[1,2591,73,56,"url"],[1,2595,93,15],[1,2601,93,38],[1,2610,93,19,"request"],[1,2612,93,27,"method"],[1,2620,93,64],[1,2635,93,48,"request"],[1,2637,93,56,"url"],[1,2642,94,10,"this"],[1,2647,94,15,"onHandshake"],[1,2661,95,17],[1,2662,96,12,"statusCode"],[1,2673,96,24],[1,2677,97,12,"headers"],[1,2685,97,21],[1,2686,97,23],[1,2701,97,39],[1,2721,98,12,"body"],[1,2726,98,18,"JSON"],[1,2731,98,23,"stringify"],[1,2741,98,33],[1,2742,98,35,"status"],[1,2749,98,43],[1,2758,101,17],[1,2759,102,12,"statusCode"],[1,2770,102,24],[1,2774,103,12,"headers"],[1,2782,103,21],[1,2783,103,23],[1,2798,103,39],[1,2812,104,12,"body"],[1,2817,104,18],[1,2830,74,10],[1,2834,75,12],[1,2840,76,18,"message"],[1,2842,75,31,"JSON"],[1,2847,75,36,"parse"],[1,2853,75,42,"request"],[1,2855,75,50,"body"],[1,2861,75,58],[1,2867,76,39,"message"],[1,2875,80,12],[1,2882,77,16,"message"],[1,2885,78,14,"this"],[1,2890,78,19,"onMessage"],[1,2900,78,29,"message"],[1,2903,80,19],[1,2904,81,14,"statusCode"],[1,2915,81,26],[1,2919,82,14,"headers"],[1,2927,82,23],[1,2928,82,25],[1,2943,82,41],[1,2963,83,14,"body"],[1,2968,83,20,"JSON"],[1,2973,83,25,"stringify"],[1,2983,83,35],[1,2984,83,37,"status"],[1,2991,83,45],[1,2998,85,10],[1,2999,85,12],[1,3005,85,19,"parseError"],[1,3008,87,12],[1,3015,86,12,"logger"],[1,3017,86,19,"info"],[1,3022,86,24],[1,3070,86,73,"parseError"],[1,3073,87,19],[1,3074,88,14,"statusCode"],[1,3085,88,26],[1,3089,89,14,"headers"],[1,3097,89,23],[1,3098,89,25],[1,3113,89,41],[1,3133,90,14,"body"],[1,3138,90,20,"JSON"],[1,3143,90,25,"stringify"],[1,3153,90,35],[1,3154,90,37,"error"],[1,3160,90,44],[1,3177,92,10],[1,3178,107,6],[1,3179,107,8],[1,3185,107,15,"error"],[1,3188,109,8],[1,3195,108,8,"logger"],[1,3197,108,15,"info"],[1,3202,108,20],[1,3243,108,62,"error"],[1,3246,109,15],[1,3247,110,10,"statusCode"],[1,3258,110,22],[1,3262,111,10,"headers"],[1,3270,111,19],[1,3271,111,21],[1,3286,111,37],[1,3306,112,10,"body"],[1,3311,112,16,"JSON"],[1,3316,112,21,"stringify"],[1,3326,112,31],[1,3327,112,33,"error"],[1,3333,112,40],[1,3359,114,6],[1,3362,116,2],[1,3363,118,9,"init"],[1,3368,118,14,"actions"],[1,3371,119,4,"this"],[1,3376,119,9,"onMessage"],[1,3386,119,21,"actions"],[1,3388,119,29,"onMessage"],[1,3398,120,4,"this"],[1,3403,120,9,"onHandshake"],[1,3415,120,23,"actions"],[1,3417,120,31,"onHandshake"],[1,3428,121,2],[1,3429,123,2],[1,3446,123,15,"startServer"],[1,3449,124,4,"logger"],[1,3451,124,11,"debug"],[1,3457,124,17],[1,3506,126,4],[1,3510,128,10,"this"],[1,3515,128,15,"httpServer"],[1,3527,128,29,"this"],[1,3532,128,34,"httpServer"],[1,3543,128,45,"getIsRunning"],[1,3560,129,8,"logger"],[1,3562,129,15,"debug"],[1,3568,129,21],[1,3630,130,8,"this"],[1,3635,130,13,"httpServer"],[1,3646,130,24,"stop"],[1,3654,133,6],[1,3660,133,12,"url"],[1,3668,133,24,"this"],[1,3673,133,29,"httpServer"],[1,3684,133,40,"start"],[1,3692,135,6],[1,3699,134,6,"logger"],[1,3701,134,13,"debug"],[1,3707,134,19],[1,3758,134,70,"url"],[1,3763,135,13,"url"],[1,3764,136,4],[1,3765,136,6],[1,3771,136,13,"error"],[1,3774,137,6],[1,3780,137,12,"errorMessage"],[1,3782,137,27,"error"],[1,3795,137,44,"Error"],[1,3801,137,52,"error"],[1,3803,137,58,"message"],[1,3811,137,68],[1,3838,139,6],[1,3844,138,6,"logger"],[1,3846,138,13,"info"],[1,3851,138,18],[1,3893,138,61,"errorMessage"],[1,3896,139,12],[1,3900,139,16,"Error"],[1,3906,139,22,"errorMessage"],[1,3908,140,4],[1,3909,141,2],[1,3910,143,9,"stopServer"],[1,3923,144,4,"logger"],[1,3925,144,11,"debug"],[1,3931,144,17],[1,3969,145,4,"this"],[1,3974,145,9,"httpServer"],[1,3985,145,20,"stop"],[1,3991,146,2],[1,3992,148,9,"isRunning"],[1,4004,149,4],[1,4011,149,11,"this"],[1,4016,149,16,"httpServer"],[1,4027,149,27,"getIsRunning"],[1,4041,150,2],[1,4043,153,63]],"functionMap":{"names":["<global>","getRemotePageHTML","RemoteControlService","RemoteControlService#onMessage","RemoteControlService#onHandshake","RemoteControlService#constructor","RemoteControlService#setupRequestHandler","httpServer.setRequestHandler$argument_0","RemoteControlService#init","RemoteControlService#startServer","RemoteControlService#stopServer","RemoteControlService#isRunning"],"mappings":"AAA;0BCK;CD4C;AEE;iDCE,QD;oCEC,QF;EGE;GHG;EIE;sCCC;KDoD;GJC;EME;GNG;EOE;GPkB;EQE;GRG;ESE;GTE;CFC"}},"type":"js/module"}]}