{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":107,"column":0,"index":3730}}],"key":"7kvm5yrOpz4NYiDi6sn4qxa8DVQ="}},{"name":"zustand","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":33,"index":33}}],"key":"xFAZpEovr+Y5/UCynUzO0ntFekY="}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"locs":[{"start":{"line":2,"column":0,"index":34},"end":{"line":2,"column":69,"index":103}}],"key":"6eZFbfKht0uO2NEVT/d8+i8B0s8="}},{"name":"../services/api","data":{"asyncType":null,"locs":[{"start":{"line":3,"column":0,"index":104},"end":{"line":3,"column":38,"index":142}}],"key":"9k4jq6FYa7kulu8bjoa7L/z8gFU="}},{"name":"./settingsStore","data":{"asyncType":null,"locs":[{"start":{"line":4,"column":0,"index":143},"end":{"line":4,"column":51,"index":194}}],"key":"K2bXEdKq/GtHbPkcBG1P8ED6GZY="}},{"name":"react-native-toast-message","data":{"asyncType":null,"locs":[{"start":{"line":5,"column":0,"index":195},"end":{"line":5,"column":47,"index":242}}],"key":"mvLfpRqMmyOUTnGhKaiVkXHegIo="}},{"name":"../utils/Logger","data":{"asyncType":null,"locs":[{"start":{"line":6,"column":0,"index":243},"end":{"line":6,"column":37,"index":280}}],"key":"rD5UrWJd899SO1d///YpsfF5nbE="}},{"name":"./membershipStore","data":{"asyncType":null,"locs":[{"start":{"line":7,"column":0,"index":281},"end":{"line":7,"column":52,"index":333}}],"key":"kL5wwjQvYtD2vtI9NP3IZqbpDt4="}}],"output":[{"data":{"code":"__d(function(g,r,i,a,m,e,d){var t=r(d[0]);Object.defineProperty(e,\"__esModule\",{value:!0}),e.useAuthStore=e.default=e.authStore=void 0;var o=r(d[1]),s=t(r(d[2])),n=r(d[3]),l=r(d[4]),h=t(r(d[5])),S=t(r(d[6])),c=r(d[7]);const f=S.default.withTag('AuthStore'),u=e.useAuthStore=(0,o.create)(t=>({isLoggedIn:!1,isLoginModalVisible:!1,showLoginModal:()=>t({isLoginModalVisible:!0}),hideLoginModal:()=>t({isLoginModalVisible:!1}),checkLoginStatus:async o=>{if(!o)return t({isLoggedIn:!1,isLoginModalVisible:!1}),void c.membershipStore.getState().clearMembershipInfo();try{const o=l.useSettingsStore.getState();let S=o.serverConfig;if(o.isLoadingServerConfig){const t=3e3,o=100;let s=0;for(;s<t;){await new Promise(t=>setTimeout(t,o)),s+=o;const t=l.useSettingsStore.getState();if(!t.isLoadingServerConfig){S=t.serverConfig;break}}}if(!S?.StorageType)return void(o.isLoadingServerConfig||h.default.show({type:\"error\",text1:\"\\u8bf7\\u68c0\\u67e5\\u7f51\\u7edc\\u6216\\u8005\\u670d\\u52a1\\u5668\\u5730\\u5740\\u662f\\u5426\\u53ef\\u7528\"}));if(await s.default.getItem('authCookies'))t({isLoggedIn:!0,isLoginModalVisible:!1}),await c.membershipStore.getState().fetchMembershipInfo();else if(S&&\"localstorage\"===S.StorageType){const o=await n.api.login().catch(()=>{t({isLoggedIn:!1,isLoginModalVisible:!0}),c.membershipStore.getState().clearMembershipInfo()});o&&o.ok&&(t({isLoggedIn:!0}),await c.membershipStore.getState().fetchMembershipInfo())}else t({isLoggedIn:!1,isLoginModalVisible:!0}),c.membershipStore.getState().clearMembershipInfo()}catch(o){f.error(\"Failed to check login status:\",o),c.membershipStore.getState().clearMembershipInfo(),o instanceof Error&&\"UNAUTHORIZED\"===o.message?t({isLoggedIn:!1,isLoginModalVisible:!0}):t({isLoggedIn:!1})}},logout:async()=>{try{await n.api.logout(),t({isLoggedIn:!1,isLoginModalVisible:!0}),c.membershipStore.getState().clearMembershipInfo()}catch(t){f.error(\"Failed to logout:\",t)}}}));e.default=u;e.authStore=u});","lineCount":1,"map":[[1,135,1,0],[1,139,1,0,"_zustand"],[1,141,1,0,"r"],[1,143,1,0,"d"],[1,145,1,0],[1,149,2,0,"_asyncStorage"],[1,151,2,0,"_interopRequireDefault"],[1,153,2,0,"r"],[1,155,2,0,"d"],[1,157,2,0],[1,162,3,0,"_api"],[1,164,3,0,"r"],[1,166,3,0,"d"],[1,168,3,0],[1,172,4,0,"_settingsStore"],[1,174,4,0,"r"],[1,176,4,0,"d"],[1,178,4,0],[1,182,5,0,"_reactNativeToastMessage"],[1,184,5,0,"_interopRequireDefault"],[1,186,5,0,"r"],[1,188,5,0,"d"],[1,190,5,0],[1,195,6,0,"_Logger"],[1,197,6,0,"_interopRequireDefault"],[1,199,6,0,"r"],[1,201,6,0,"d"],[1,203,6,0],[1,208,7,0,"_membershipStore"],[1,210,7,0,"r"],[1,212,7,0,"d"],[1,214,7,0],[1,218,9,0],[1,224,9,6,"logger"],[1,226,9,15,"Logger"],[1,236,9,22,"withTag"],[1,244,9,30],[1,257,21,13,"useAuthStore"],[1,259,21,25,"e"],[1,261,21,25,"useAuthStore"],[1,275,21,28],[1,277,21,28,"create"],[1,287,21,47,"set"],[1,291,21,50],[1,292,22,2,"isLoggedIn"],[1,304,22,14],[1,306,23,2,"isLoginModalVisible"],[1,327,23,23],[1,329,24,2,"showLoginModal"],[1,344,24,18,"showLoginModal"],[1,348,24,24,"set"],[1,350,24,28],[1,351,24,30,"isLoginModalVisible"],[1,372,24,51],[1,376,25,2,"hideLoginModal"],[1,391,25,18,"hideLoginModal"],[1,395,25,24,"set"],[1,397,25,28],[1,398,25,30,"isLoginModalVisible"],[1,419,25,51],[1,423,26,2,"checkLoginStatus"],[1,440,26,20,"async"],[1,450,27,4],[1,454,27,9,"apiBaseUrl"],[1,456,30,6],[1,463,28,6,"set"],[1,465,28,10],[1,466,28,12,"isLoggedIn"],[1,478,28,24],[1,480,28,31,"isLoginModalVisible"],[1,501,28,52],[1,510,29,6,"membershipStore"],[1,528,29,22,"getState"],[1,539,29,33,"clearMembershipInfo"],[1,561,32,4],[1,565,34,6],[1,571,34,12,"settingsState"],[1,573,34,28,"useSettingsStore"],[1,592,34,45,"getState"],[1,603,35,6],[1,607,35,10,"serverConfig"],[1,609,35,25,"settingsState"],[1,611,35,39,"serverConfig"],[1,624,38,6],[1,627,38,10,"settingsState"],[1,629,38,24,"isLoadingServerConfig"],[1,651,38,47],[1,652,40,8],[1,658,40,14,"maxWaitTime"],[1,660,40,28],[1,664,41,14,"checkInterval"],[1,666,41,30],[1,670,42,8],[1,674,42,12,"waitTime"],[1,676,42,23],[1,678,44,8],[1,683,44,15,"waitTime"],[1,685,44,26,"maxWaitTime"],[1,688,44,39],[1,695,45,16],[1,699,45,20,"Promise"],[1,707,45,28,"resolve"],[1,710,45,39,"setTimeout"],[1,721,45,50,"resolve"],[1,723,45,59,"checkInterval"],[1,727,46,10,"waitTime"],[1,730,46,22,"checkInterval"],[1,732,47,10],[1,738,47,16,"currentState"],[1,740,47,31,"useSettingsStore"],[1,759,47,48,"getState"],[1,770,48,10],[1,774,48,15,"currentState"],[1,776,48,28,"isLoadingServerConfig"],[1,798,48,51],[1,799,49,12,"serverConfig"],[1,801,49,27,"currentState"],[1,803,49,40,"serverConfig"],[1,816,50,12],[1,821,51,10],[1,822,52,8],[1,823,53,6],[1,824,55,6],[1,828,55,11,"serverConfig"],[1,831,55,25,"StorageType"],[1,843,60,8],[1,855,57,13,"settingsState"],[1,857,57,27,"isLoadingServerConfig"],[1,880,58,10,"Toast"],[1,890,58,16,"show"],[1,895,58,21],[1,896,58,23,"type"],[1,901,58,29],[1,909,58,38,"text1"],[1,915,58,45],[1,1017,64,6],[1,1026,63,30,"AsyncStorage"],[1,1036,63,43,"getItem"],[1,1044,63,51],[1,1059,79,8,"set"],[1,1061,79,12],[1,1062,79,14,"isLoggedIn"],[1,1074,79,26],[1,1076,79,32,"isLoginModalVisible"],[1,1097,79,53],[1,1107,80,14,"membershipStore"],[1,1125,80,30,"getState"],[1,1136,80,41,"fetchMembershipInfo"],[1,1163,65,8],[1,1166,65,12,"serverConfig"],[1,1169,65,57],[1,1186,65,28,"serverConfig"],[1,1188,65,41,"StorageType"],[1,1200,65,73],[1,1201,66,10],[1,1207,66,16,"loginResult"],[1,1215,66,36,"api"],[1,1221,66,40,"login"],[1,1229,66,48,"catch"],[1,1235,66,54],[1,1240,67,12,"set"],[1,1242,67,16],[1,1243,67,18,"isLoggedIn"],[1,1255,67,30],[1,1257,67,37,"isLoginModalVisible"],[1,1278,67,58],[1,1282,68,12,"membershipStore"],[1,1300,68,28,"getState"],[1,1311,68,39,"clearMembershipInfo"],[1,1335,70,14,"loginResult"],[1,1338,70,29,"loginResult"],[1,1340,70,41,"ok"],[1,1345,71,12,"set"],[1,1347,71,16],[1,1348,71,18,"isLoggedIn"],[1,1360,71,30],[1,1370,72,18,"membershipStore"],[1,1388,72,34,"getState"],[1,1399,72,45,"fetchMembershipInfo"],[1,1421,74,8],[1,1427,75,10,"set"],[1,1429,75,14],[1,1430,75,16,"isLoggedIn"],[1,1442,75,28],[1,1444,75,35,"isLoginModalVisible"],[1,1465,75,56],[1,1469,76,10,"membershipStore"],[1,1487,76,26,"getState"],[1,1498,76,37,"clearMembershipInfo"],[1,1519,82,4],[1,1520,82,6],[1,1526,82,13,"error"],[1,1529,83,6,"logger"],[1,1531,83,13,"error"],[1,1537,83,19],[1,1569,83,52,"error"],[1,1572,84,6,"membershipStore"],[1,1590,84,22,"getState"],[1,1601,84,33,"clearMembershipInfo"],[1,1623,85,10,"error"],[1,1636,85,27,"Error"],[1,1643,85,54],[1,1660,85,36,"error"],[1,1662,85,42,"message"],[1,1670,86,8,"set"],[1,1672,86,12],[1,1673,86,14,"isLoggedIn"],[1,1685,86,26],[1,1687,86,33,"isLoginModalVisible"],[1,1708,86,54],[1,1712,88,8,"set"],[1,1714,88,12],[1,1715,88,14,"isLoggedIn"],[1,1727,88,26],[1,1730,90,4],[1,1733,92,2,"logout"],[1,1740,92,10,"async"],[1,1750,93,4],[1,1760,94,12,"api"],[1,1766,94,16,"logout"],[1,1775,95,6,"set"],[1,1777,95,10],[1,1778,95,12,"isLoggedIn"],[1,1790,95,24],[1,1792,95,31,"isLoginModalVisible"],[1,1813,95,52],[1,1817,96,6,"membershipStore"],[1,1835,96,22,"getState"],[1,1846,96,33,"clearMembershipInfo"],[1,1867,97,4],[1,1868,97,6],[1,1874,97,13,"error"],[1,1877,98,6,"logger"],[1,1879,98,13,"error"],[1,1885,98,19],[1,1905,98,40,"error"],[1,1907,99,4],[1,1913,101,4,"e"],[1,1915,101,4,"default"],[1,1923,103,15,"useAuthStore"],[1,1925,105,15,"e"],[1,1927,105,15,"authStore"],[1,1937,105,18,"useAuthStore"],[1,1938,105,31]],"functionMap":{"names":["<global>","create$argument_0","showLoginModal","hideLoginModal","checkLoginStatus","Promise$argument_0","api.login._catch$argument_0","logout"],"mappings":"AAA;8CCoB;kBCG,wCD;kBEC,yCF;oBGC;4BCmB,6CD;sDEqB;WFG;GHsB;UMC;GNQ;EDC"}},"type":"js/module"}]}