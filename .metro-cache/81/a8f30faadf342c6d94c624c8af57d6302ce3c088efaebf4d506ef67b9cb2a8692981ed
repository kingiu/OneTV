{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":208,"column":2,"index":5177}}],"key":"7kvm5yrOpz4NYiDi6sn4qxa8DVQ="}},{"name":"zustand","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":33,"index":33}}],"key":"xFAZpEovr+Y5/UCynUzO0ntFekY="}},{"name":"../services/updateService","data":{"asyncType":null,"locs":[{"start":{"line":2,"column":0,"index":34},"end":{"line":2,"column":54,"index":88}}],"key":"rFEOAFc8ZANxphFLZQu3plCdMY4="}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"locs":[{"start":{"line":3,"column":0,"index":89},"end":{"line":3,"column":69,"index":158}}],"key":"6eZFbfKht0uO2NEVT/d8+i8B0s8="}},{"name":"react-native-toast-message","data":{"asyncType":null,"locs":[{"start":{"line":4,"column":0,"index":159},"end":{"line":4,"column":47,"index":206}}],"key":"mvLfpRqMmyOUTnGhKaiVkXHegIo="}},{"name":"@/utils/Logger","data":{"asyncType":null,"locs":[{"start":{"line":5,"column":0,"index":207},"end":{"line":5,"column":36,"index":243}}],"key":"dpbJvsqVW0VVfFOl8dlhEC6KfVk="}}],"output":[{"data":{"code":"__d(function(g,r,i,a,m,e,d){var t=r(d[0]);Object.defineProperty(e,\"__esModule\",{value:!0}),e.useUpdateStore=e.initUpdateStore=void 0;var o=r(d[1]),s=t(r(d[2])),n=t(r(d[3])),l=t(r(d[4]));const w=t(r(d[5])).default.withTag('UpdateStore'),c='update_last_check_time',u='update_skip_version',p=e.useUpdateStore=(0,o.create)((t,o)=>({updateAvailable:!1,currentVersion:s.default.getCurrentVersion(),remoteVersion:'',downloadUrl:'',downloading:!1,downloadProgress:0,downloadedPath:null,error:null,lastCheckTime:0,skipVersion:null,showUpdateModal:!1,isLatestVersion:!1,checkForUpdate:async(o=!1)=>{try{t({error:null,isLatestVersion:!1});const w=await n.default.getItem(u),p=await s.default.checkVersion(),h=s.default.isUpdateAvailable(p.version),f=h&&p.version!==w,U=!h;t({remoteVersion:p.version,downloadUrl:p.downloadUrl,updateAvailable:h,lastCheckTime:Date.now(),skipVersion:w,showUpdateModal:f&&!o,isLatestVersion:U}),!o&&U&&l.default.show({type:'success',text1:'\\u5df2\\u662f\\u6700\\u65b0\\u7248\\u672c',text2:`\\u5f53\\u524d\\u7248\\u672c v${s.default.getCurrentVersion()} \\u5df2\\u662f\\u6700\\u65b0\\u7248\\u672c`,visibilityTime:3e3}),await n.default.setItem(c,Date.now().toString())}catch(o){t({error:o instanceof Error?o.message:'\\u68c0\\u67e5\\u66f4\\u65b0\\u5931\\u8d25',updateAvailable:!1,isLatestVersion:!1})}},startDownload:async()=>{const{downloadUrl:n}=o();if(n)try{t({downloading:!0,downloadProgress:0,error:null});const o=await s.default.downloadApk(n,o=>{t({downloadProgress:o})});t({downloadedPath:o,downloading:!1,downloadProgress:100})}catch(o){t({downloading:!1,downloadProgress:0,error:o instanceof Error?o.message:'\\u4e0b\\u8f7d\\u5931\\u8d25'})}else t({error:'\\u4e0b\\u8f7d\\u5730\\u5740\\u65e0\\u6548'})},installUpdate:async()=>{const{downloadedPath:n}=o();if(n)try{await s.default.installApk(n),t({showUpdateModal:!1})}catch(o){w.error('\\u5b89\\u88c5\\u5931\\u8d25:',o),t({error:o instanceof Error?o.message:'\\u5b89\\u88c5\\u5931\\u8d25'})}else t({error:'\\u5b89\\u88c5\\u6587\\u4ef6\\u4e0d\\u5b58\\u5728'})},setShowUpdateModal:o=>{t({showUpdateModal:o})},skipThisVersion:async()=>{const{remoteVersion:s}=o();s&&(await n.default.setItem(u,s),t({skipVersion:s,showUpdateModal:!1}))},reset:()=>{t({downloading:!1,downloadProgress:0,downloadedPath:null,error:null,showUpdateModal:!1,isLatestVersion:!1})}}));e.initUpdateStore=async()=>{try{const t=await n.default.getItem(c),o=await n.default.getItem(u);p.setState({lastCheckTime:t?parseInt(t,10):0,skipVersion:o||null})}catch(t){w.error('\\u521d\\u59cb\\u5316\\u66f4\\u65b0\\u5b58\\u50a8\\u5931\\u8d25:',t)}}});","lineCount":1,"map":[[1,133,1,0],[1,137,1,0,"_zustand"],[1,139,1,0,"r"],[1,141,1,0,"d"],[1,143,1,0],[1,147,2,0,"_updateService"],[1,149,2,0,"_interopRequireDefault"],[1,151,2,0,"r"],[1,153,2,0,"d"],[1,155,2,0],[1,160,3,0,"_asyncStorage"],[1,162,3,0,"_interopRequireDefault"],[1,164,3,0,"r"],[1,166,3,0,"d"],[1,168,3,0],[1,173,4,0,"_reactNativeToastMessage"],[1,175,4,0,"_interopRequireDefault"],[1,177,4,0,"r"],[1,179,4,0,"d"],[1,181,4,0],[1,186,7,0],[1,192,7,6,"logger"],[1,194,5,0,"_interopRequireDefault"],[1,196,5,0,"r"],[1,198,5,0,"d"],[1,200,5,0],[1,205,7,15,"Logger"],[1,213,7,22,"withTag"],[1,221,7,30],[1,236,33,6,"STORAGE_KEYS"],[1,238,34,19],[1,263,33,6,"STORAGE_KEYS"],[1,265,35,16],[1,287,38,13,"useUpdateStore"],[1,289,38,27,"e"],[1,291,38,27,"useUpdateStore"],[1,307,38,30],[1,309,38,30,"create"],[1,319,38,50],[1,320,38,51,"set"],[1,322,38,56,"get"],[1,327,38,59],[1,328,40,2,"updateAvailable"],[1,345,40,19],[1,347,41,2,"currentVersion"],[1,362,41,18,"updateService"],[1,372,41,32,"getCurrentVersion"],[1,392,42,2,"remoteVersion"],[1,406,42,17],[1,409,43,2,"downloadUrl"],[1,421,43,15],[1,424,44,2,"downloading"],[1,437,44,15],[1,439,45,2,"downloadProgress"],[1,456,45,20],[1,458,46,2,"downloadedPath"],[1,473,46,18],[1,478,47,2,"error"],[1,484,47,9],[1,489,48,2,"lastCheckTime"],[1,503,48,17],[1,505,49,2,"skipVersion"],[1,517,49,15],[1,522,50,2,"showUpdateModal"],[1,539,50,19],[1,541,51,2,"isLatestVersion"],[1,558,51,19],[1,560,54,2,"checkForUpdate"],[1,575,54,18,"async"],[1,581,54,25,"silent"],[1,584,54,34],[1,589,55,4],[1,593,56,6,"set"],[1,595,56,10],[1,596,56,12,"error"],[1,602,56,19],[1,607,56,25,"isLatestVersion"],[1,624,56,42],[1,628,59,6],[1,634,59,12,"skipVersion"],[1,642,59,32,"AsyncStorage"],[1,652,59,45,"getItem"],[1,660,59,53,"STORAGE_KEYS"],[1,663,61,12,"versionInfo"],[1,671,61,32,"updateService"],[1,681,61,46,"checkVersion"],[1,696,62,12,"isUpdateAvailable"],[1,698,62,32,"updateService"],[1,708,62,46,"isUpdateAvailable"],[1,726,62,64,"versionInfo"],[1,728,62,76,"version"],[1,737,65,12,"shouldShowUpdate"],[1,739,65,31,"isUpdateAvailable"],[1,742,65,52,"versionInfo"],[1,744,65,64,"version"],[1,754,65,76,"skipVersion"],[1,756,68,12,"isLatest"],[1,759,68,24,"isUpdateAvailable"],[1,761,70,6,"set"],[1,763,70,10],[1,764,71,8,"remoteVersion"],[1,778,71,23,"versionInfo"],[1,780,71,35,"version"],[1,788,72,8,"downloadUrl"],[1,800,72,21,"versionInfo"],[1,802,72,33,"downloadUrl"],[1,814,73,8,"updateAvailable"],[1,830,73,25,"isUpdateAvailable"],[1,832,74,8,"lastCheckTime"],[1,846,74,23,"Date"],[1,851,74,28,"now"],[1,857,75,8,"skipVersion"],[1,871,76,8,"showUpdateModal"],[1,887,76,25,"shouldShowUpdate"],[1,891,76,46,"silent"],[1,893,77,8,"isLatestVersion"],[1,909,77,25,"isLatest"],[1,914,81,11,"silent"],[1,917,81,21,"isLatest"],[1,920,82,8,"Toast"],[1,930,82,14,"show"],[1,935,82,19],[1,936,83,10,"type"],[1,941,83,16],[1,951,84,10,"text1"],[1,957,84,17],[1,996,85,10,"text2"],[1,1002,85,17],[1,1031,85,26,"updateService"],[1,1041,85,40,"getCurrentVersion"],[1,1100,86,10,"visibilityTime"],[1,1115,86,26],[1,1127,91,12,"AsyncStorage"],[1,1137,91,25,"setItem"],[1,1145,92,8,"STORAGE_KEYS"],[1,1147,93,8,"Date"],[1,1152,93,13,"now"],[1,1158,93,19,"toString"],[1,1169,95,4],[1,1170,95,6],[1,1176,95,13,"error"],[1,1179,97,6,"set"],[1,1181,97,10],[1,1182,98,8,"error"],[1,1188,98,15,"error"],[1,1201,98,32,"Error"],[1,1207,98,40,"error"],[1,1209,98,46,"message"],[1,1217,98,56],[1,1256,99,8,"updateAvailable"],[1,1273,99,25],[1,1275,100,8,"isLatestVersion"],[1,1292,100,25],[1,1295,102,4],[1,1298,106,2,"startDownload"],[1,1312,106,17,"async"],[1,1322,107,4],[1,1328,107,10,"downloadUrl"],[1,1340,107,12,"downloadUrl"],[1,1343,107,28,"get"],[1,1347,109,4],[1,1350,109,9,"downloadUrl"],[1,1352,114,4],[1,1356,115,6,"set"],[1,1358,115,10],[1,1359,116,8,"downloading"],[1,1372,116,21],[1,1374,117,8,"downloadProgress"],[1,1391,117,26],[1,1393,118,8,"error"],[1,1399,118,15],[1,1406,121,6],[1,1412,121,12,"filePath"],[1,1420,121,29,"updateService"],[1,1430,121,43,"downloadApk"],[1,1442,122,8,"downloadUrl"],[1,1444,123,9,"progress"],[1,1448,124,10,"set"],[1,1450,124,14],[1,1451,124,16,"downloadProgress"],[1,1468,124,34,"progress"],[1,1474,128,6,"set"],[1,1476,128,10],[1,1477,129,8,"downloadedPath"],[1,1492,129,24,"filePath"],[1,1494,130,8,"downloading"],[1,1507,130,21],[1,1509,131,8,"downloadProgress"],[1,1526,131,26],[1,1531,133,4],[1,1532,133,6],[1,1538,133,13,"error"],[1,1541,135,6,"set"],[1,1543,135,10],[1,1544,136,8,"downloading"],[1,1557,136,21],[1,1559,137,8,"downloadProgress"],[1,1576,137,26],[1,1578,138,8,"error"],[1,1584,138,15,"error"],[1,1597,138,32,"Error"],[1,1603,138,40,"error"],[1,1605,138,46,"message"],[1,1613,138,56],[1,1641,140,4],[1,1647,110,6,"set"],[1,1649,110,10],[1,1650,110,12,"error"],[1,1656,110,19],[1,1698,144,2,"installUpdate"],[1,1712,144,17,"async"],[1,1722,145,4],[1,1728,145,10,"downloadedPath"],[1,1743,145,12,"downloadedPath"],[1,1746,145,31,"get"],[1,1750,147,4],[1,1753,147,9,"downloadedPath"],[1,1755,152,4],[1,1765,153,12,"updateService"],[1,1775,153,26,"installApk"],[1,1786,153,37,"downloadedPath"],[1,1789,155,6,"set"],[1,1791,155,10],[1,1792,155,12,"showUpdateModal"],[1,1809,155,29],[1,1812,156,4],[1,1813,156,6],[1,1819,156,13,"error"],[1,1822,157,6,"logger"],[1,1824,157,13,"error"],[1,1830,157,19],[1,1858,157,28,"error"],[1,1861,158,6,"set"],[1,1863,158,10],[1,1864,159,8,"error"],[1,1870,159,15,"error"],[1,1883,159,32,"Error"],[1,1889,159,40,"error"],[1,1891,159,46,"message"],[1,1899,159,56],[1,1927,161,4],[1,1933,148,6,"set"],[1,1935,148,10],[1,1936,148,12,"error"],[1,1942,148,19],[1,1990,165,2,"setShowUpdateModal"],[1,2009,165,23,"show"],[1,2013,166,4,"set"],[1,2015,166,8],[1,2016,166,10,"showUpdateModal"],[1,2032,166,27,"show"],[1,2037,170,2,"skipThisVersion"],[1,2053,170,19,"async"],[1,2063,171,4],[1,2069,171,10,"remoteVersion"],[1,2083,171,12,"remoteVersion"],[1,2086,171,30,"get"],[1,2090,173,8,"remoteVersion"],[1,2100,174,12,"AsyncStorage"],[1,2110,174,25,"setItem"],[1,2118,174,33,"STORAGE_KEYS"],[1,2120,174,60,"remoteVersion"],[1,2123,175,6,"set"],[1,2125,175,10],[1,2126,176,8,"skipVersion"],[1,2138,176,21,"remoteVersion"],[1,2140,177,8,"showUpdateModal"],[1,2157,177,25],[1,2163,183,2,"reset"],[1,2169,183,9,"reset"],[1,2174,184,4,"set"],[1,2176,184,8],[1,2177,185,6,"downloading"],[1,2190,185,19],[1,2192,186,6,"downloadProgress"],[1,2209,186,24],[1,2211,187,6,"downloadedPath"],[1,2226,187,22],[1,2231,188,6,"error"],[1,2237,188,13],[1,2242,189,6,"showUpdateModal"],[1,2259,189,23],[1,2261,190,6,"isLatestVersion"],[1,2278,190,23],[1,2286,208,2,"e"],[1,2288,208,2,"initUpdateStore"],[1,2304,196,31,"async"],[1,2314,197,2],[1,2318,198,4],[1,2324,198,10,"lastCheckTime"],[1,2332,198,32,"AsyncStorage"],[1,2342,198,45,"getItem"],[1,2350,198,53,"STORAGE_KEYS"],[1,2353,199,10,"skipVersion"],[1,2361,199,30,"AsyncStorage"],[1,2371,199,43,"getItem"],[1,2379,199,51,"STORAGE_KEYS"],[1,2382,201,4,"useUpdateStore"],[1,2384,201,19,"setState"],[1,2393,201,28],[1,2394,202,6,"lastCheckTime"],[1,2408,202,21,"lastCheckTime"],[1,2410,202,37,"parseInt"],[1,2419,202,46,"lastCheckTime"],[1,2421,202,61],[1,2425,202,67],[1,2427,203,6,"skipVersion"],[1,2439,203,19,"skipVersion"],[1,2442,203,34],[1,2448,205,2],[1,2449,205,4],[1,2455,205,11,"error"],[1,2458,206,4,"logger"],[1,2460,206,11,"error"],[1,2466,206,17],[1,2524,206,31,"error"],[1,2526,207,2],[1,2528,208,2]],"functionMap":{"names":["<global>","create$argument_0","checkForUpdate","startDownload","updateService.downloadApk$argument_1","installUpdate","setShowUpdateModal","skipThisVersion","reset","initUpdateStore"],"mappings":"AAA;kDCqC;kBCgB;GDiD;iBEG;QCiB;SDE;GFgB;iBIG;GJkB;sBKG;GLE;mBMG;GNU;SOG;GPS;EDC;+BSG;CTY"}},"type":"js/module"}]}