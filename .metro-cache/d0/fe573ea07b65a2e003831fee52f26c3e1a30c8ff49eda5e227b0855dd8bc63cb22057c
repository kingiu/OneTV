{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":95,"column":4,"index":2829}}],"key":"7kvm5yrOpz4NYiDi6sn4qxa8DVQ="}},{"name":"zustand","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":33,"index":33}}],"key":"xFAZpEovr+Y5/UCynUzO0ntFekY="}},{"name":"../services/remoteControlService","data":{"asyncType":null,"locs":[{"start":{"line":2,"column":0,"index":34},"end":{"line":2,"column":72,"index":106}}],"key":"dI0O+QLR5AK0Heyu0Z3/vXbmxek="}},{"name":"@/utils/Logger","data":{"asyncType":null,"locs":[{"start":{"line":3,"column":0,"index":107},"end":{"line":3,"column":36,"index":143}}],"key":"dpbJvsqVW0VVfFOl8dlhEC6KfVk="}},{"name":"react-native-web/dist/exports/Platform","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":95,"column":4,"index":2829}}],"key":"jM/HC84YZkM9kLoiCo0Bpf0Xr+w="}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _interopRequireDefault = require(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.useRemoteControlStore = void 0;\n  var _zustand = require(_dependencyMap[1], \"zustand\");\n  var _remoteControlService = require(_dependencyMap[2], \"../services/remoteControlService\");\n  var _Logger = _interopRequireDefault(require(_dependencyMap[3], \"@/utils/Logger\"));\n  var _Platform = _interopRequireDefault(require(_dependencyMap[4], \"react-native-web/dist/exports/Platform\"));\n  const logger = _Logger.default.withTag('RemoteControlStore');\n  const useRemoteControlStore = exports.useRemoteControlStore = (0, _zustand.create)((set, get) => ({\n    isServerRunning: false,\n    serverUrl: null,\n    error: null,\n    isModalVisible: false,\n    lastMessage: null,\n    targetPage: null,\n    startServer: async () => {\n      if (get().isServerRunning) {\n        return;\n      }\n\n      // 在Web平台上禁用远程输入服务器功能\n      if (_Platform.default.OS === 'web') {\n        const errorMessage = 'Web平台暂不支持远程输入功能';\n        logger.error('Cannot start server on web platform:', errorMessage);\n        set({\n          error: errorMessage\n        });\n        return;\n      }\n      _remoteControlService.remoteControlService.init({\n        onMessage: message => {\n          logger.debug('Received message:', message);\n          const currentState = get();\n          // Use the current targetPage from the store\n          set({\n            lastMessage: message,\n            targetPage: currentState.targetPage\n          });\n        },\n        onHandshake: () => {\n          logger.debug('Handshake successful');\n          set({\n            isModalVisible: false\n          });\n        }\n      });\n      try {\n        // 确保服务已正确初始化\n        if (!_remoteControlService.remoteControlService) {\n          throw new Error('远程控制服务未正确初始化');\n        }\n\n        // 检查服务是否已经运行\n        if (_remoteControlService.remoteControlService.isRunning()) {\n          logger.debug('Remote control service is already running');\n          return;\n        }\n        const url = await _remoteControlService.remoteControlService.startServer();\n        logger.info('Server started, URL:', url);\n        set({\n          isServerRunning: true,\n          serverUrl: url,\n          error: null\n        });\n      } catch (error) {\n        const errorMessage = error instanceof Error ? error.message : '启动失败，请强制退应用后重试。';\n        logger.error('Failed to start server:', errorMessage);\n        set({\n          error: errorMessage\n        });\n      }\n    },\n    stopServer: () => {\n      if (get().isServerRunning) {\n        _remoteControlService.remoteControlService.stopServer();\n        set({\n          isServerRunning: false,\n          serverUrl: null\n        });\n      }\n    },\n    showModal: targetPage => set({\n      isModalVisible: true,\n      targetPage\n    }),\n    hideModal: () => set({\n      isModalVisible: false,\n      targetPage: null\n    }),\n    setMessage: (message, targetPage) => {\n      set({\n        lastMessage: `${message}_${Date.now()}`,\n        targetPage\n      });\n    },\n    clearMessage: () => {\n      set({\n        lastMessage: null,\n        targetPage: null\n      });\n    }\n  }));\n});","lineCount":106,"map":[[7,2,1,0],[7,6,1,0,"_zustand"],[7,14,1,0],[7,17,1,0,"require"],[7,24,1,0],[7,25,1,0,"_dependencyMap"],[7,39,1,0],[8,2,2,0],[8,6,2,0,"_remoteControlService"],[8,27,2,0],[8,30,2,0,"require"],[8,37,2,0],[8,38,2,0,"_dependencyMap"],[8,52,2,0],[9,2,3,0],[9,6,3,0,"_Logger"],[9,13,3,0],[9,16,3,0,"_interopRequireDefault"],[9,38,3,0],[9,39,3,0,"require"],[9,46,3,0],[9,47,3,0,"_dependencyMap"],[9,61,3,0],[10,2,3,36],[10,6,3,36,"_Platform"],[10,15,3,36],[10,18,3,36,"_interopRequireDefault"],[10,40,3,36],[10,41,3,36,"require"],[10,48,3,36],[10,49,3,36,"_dependencyMap"],[10,63,3,36],[11,2,6,0],[11,8,6,6,"logger"],[11,14,6,12],[11,17,6,15,"Logger"],[11,32,6,21],[11,33,6,22,"withTag"],[11,40,6,29],[11,41,6,30],[11,61,6,50],[11,62,6,51],[12,2,23,7],[12,8,23,13,"useRemoteControlStore"],[12,29,23,34],[12,32,23,34,"exports"],[12,39,23,34],[12,40,23,34,"useRemoteControlStore"],[12,61,23,34],[12,64,23,37],[12,68,23,37,"create"],[12,83,23,43],[12,85,23,64],[12,86,23,65,"set"],[12,89,23,68],[12,91,23,70,"get"],[12,94,23,73],[12,100,23,79],[13,4,24,2,"isServerRunning"],[13,19,24,17],[13,21,24,19],[13,26,24,24],[14,4,25,2,"serverUrl"],[14,13,25,11],[14,15,25,13],[14,19,25,17],[15,4,26,2,"error"],[15,9,26,7],[15,11,26,9],[15,15,26,13],[16,4,27,2,"isModalVisible"],[16,18,27,16],[16,20,27,18],[16,25,27,23],[17,4,28,2,"lastMessage"],[17,15,28,13],[17,17,28,15],[17,21,28,19],[18,4,29,2,"targetPage"],[18,14,29,12],[18,16,29,14],[18,20,29,18],[19,4,31,2,"startServer"],[19,15,31,13],[19,17,31,15],[19,23,31,15,"startServer"],[19,24,31,15],[19,29,31,27],[20,6,32,4],[20,10,32,8,"get"],[20,13,32,11],[20,14,32,12],[20,15,32,13],[20,16,32,14,"isServerRunning"],[20,31,32,29],[20,33,32,31],[21,8,33,6],[22,6,34,4],[24,6,36,4],[25,6,37,4],[25,10,37,8,"Platform"],[25,27,37,16],[25,28,37,17,"OS"],[25,30,37,19],[25,35,37,24],[25,40,37,29],[25,42,37,31],[26,8,38,6],[26,14,38,12,"errorMessage"],[26,26,38,24],[26,29,38,27],[26,46,38,44],[27,8,39,6,"logger"],[27,14,39,12],[27,15,39,13,"error"],[27,20,39,18],[27,21,39,19],[27,59,39,57],[27,61,39,59,"errorMessage"],[27,73,39,71],[27,74,39,72],[28,8,40,6,"set"],[28,11,40,9],[28,12,40,10],[29,10,40,12,"error"],[29,15,40,17],[29,17,40,19,"errorMessage"],[30,8,40,32],[30,9,40,33],[30,10,40,34],[31,8,41,6],[32,6,42,4],[33,6,44,4,"remoteControlService"],[33,48,44,24],[33,49,44,25,"init"],[33,53,44,29],[33,54,44,30],[34,8,45,6,"onMessage"],[34,17,45,15],[34,19,45,18,"message"],[34,26,45,33],[34,30,45,38],[35,10,46,8,"logger"],[35,16,46,14],[35,17,46,15,"debug"],[35,22,46,20],[35,23,46,21],[35,42,46,40],[35,44,46,42,"message"],[35,51,46,49],[35,52,46,50],[36,10,47,8],[36,16,47,14,"currentState"],[36,28,47,26],[36,31,47,29,"get"],[36,34,47,32],[36,35,47,33],[36,36,47,34],[37,10,48,8],[38,10,49,8,"set"],[38,13,49,11],[38,14,49,12],[39,12,49,14,"lastMessage"],[39,23,49,25],[39,25,49,27,"message"],[39,32,49,34],[40,12,49,36,"targetPage"],[40,22,49,46],[40,24,49,48,"currentState"],[40,36,49,60],[40,37,49,61,"targetPage"],[41,10,49,72],[41,11,49,73],[41,12,49,74],[42,8,50,6],[42,9,50,7],[43,8,51,6,"onHandshake"],[43,19,51,17],[43,21,51,19,"onHandshake"],[43,22,51,19],[43,27,51,25],[44,10,52,8,"logger"],[44,16,52,14],[44,17,52,15,"debug"],[44,22,52,20],[44,23,52,21],[44,45,52,43],[44,46,52,44],[45,10,53,8,"set"],[45,13,53,11],[45,14,53,12],[46,12,53,14,"isModalVisible"],[46,26,53,28],[46,28,53,30],[47,10,53,36],[47,11,53,37],[47,12,53,38],[48,8,54,6],[49,6,55,4],[49,7,55,5],[49,8,55,6],[50,6,56,4],[50,10,56,8],[51,8,57,6],[52,8,58,6],[52,12,58,10],[52,13,58,11,"remoteControlService"],[52,55,58,31],[52,57,58,33],[53,10,59,8],[53,16,59,14],[53,20,59,18,"Error"],[53,25,59,23],[53,26,59,24],[53,40,59,38],[53,41,59,39],[54,8,60,6],[56,8,62,6],[57,8,63,6],[57,12,63,10,"remoteControlService"],[57,54,63,30],[57,55,63,31,"isRunning"],[57,64,63,40],[57,65,63,41],[57,66,63,42],[57,68,63,44],[58,10,64,8,"logger"],[58,16,64,14],[58,17,64,15,"debug"],[58,22,64,20],[58,23,64,21],[58,66,64,64],[58,67,64,65],[59,10,65,8],[60,8,66,6],[61,8,68,6],[61,14,68,12,"url"],[61,17,68,15],[61,20,68,18],[61,26,68,24,"remoteControlService"],[61,68,68,44],[61,69,68,45,"startServer"],[61,80,68,56],[61,81,68,57],[61,82,68,58],[62,8,69,6,"logger"],[62,14,69,12],[62,15,69,13,"info"],[62,19,69,17],[62,20,69,18],[62,42,69,40],[62,44,69,42,"url"],[62,47,69,45],[62,48,69,46],[63,8,70,6,"set"],[63,11,70,9],[63,12,70,10],[64,10,70,12,"isServerRunning"],[64,25,70,27],[64,27,70,29],[64,31,70,33],[65,10,70,35,"serverUrl"],[65,19,70,44],[65,21,70,46,"url"],[65,24,70,49],[66,10,70,51,"error"],[66,15,70,56],[66,17,70,58],[67,8,70,63],[67,9,70,64],[67,10,70,65],[68,6,71,4],[68,7,71,5],[68,8,71,6],[68,15,71,13,"error"],[68,20,71,18],[68,22,71,20],[69,8,72,6],[69,14,72,12,"errorMessage"],[69,26,72,24],[69,29,72,27,"error"],[69,34,72,32],[69,46,72,44,"Error"],[69,51,72,49],[69,54,72,52,"error"],[69,59,72,57],[69,60,72,58,"message"],[69,67,72,65],[69,70,72,68],[69,87,72,85],[70,8,73,6,"logger"],[70,14,73,12],[70,15,73,13,"error"],[70,20,73,18],[70,21,73,19],[70,46,73,44],[70,48,73,46,"errorMessage"],[70,60,73,58],[70,61,73,59],[71,8,74,6,"set"],[71,11,74,9],[71,12,74,10],[72,10,74,12,"error"],[72,15,74,17],[72,17,74,19,"errorMessage"],[73,8,74,32],[73,9,74,33],[73,10,74,34],[74,6,75,4],[75,4,76,2],[75,5,76,3],[76,4,78,2,"stopServer"],[76,14,78,12],[76,16,78,14,"stopServer"],[76,17,78,14],[76,22,78,20],[77,6,79,4],[77,10,79,8,"get"],[77,13,79,11],[77,14,79,12],[77,15,79,13],[77,16,79,14,"isServerRunning"],[77,31,79,29],[77,33,79,31],[78,8,80,6,"remoteControlService"],[78,50,80,26],[78,51,80,27,"stopServer"],[78,61,80,37],[78,62,80,38],[78,63,80,39],[79,8,81,6,"set"],[79,11,81,9],[79,12,81,10],[80,10,81,12,"isServerRunning"],[80,25,81,27],[80,27,81,29],[80,32,81,34],[81,10,81,36,"serverUrl"],[81,19,81,45],[81,21,81,47],[82,8,81,52],[82,9,81,53],[82,10,81,54],[83,6,82,4],[84,4,83,2],[84,5,83,3],[85,4,85,2,"showModal"],[85,13,85,11],[85,15,85,14,"targetPage"],[85,25,85,33],[85,29,85,38,"set"],[85,32,85,41],[85,33,85,42],[86,6,85,44,"isModalVisible"],[86,20,85,58],[86,22,85,60],[86,26,85,64],[87,6,85,66,"targetPage"],[88,4,85,77],[88,5,85,78],[88,6,85,79],[89,4,86,2,"hideModal"],[89,13,86,11],[89,15,86,13,"hideModal"],[89,16,86,13],[89,21,86,19,"set"],[89,24,86,22],[89,25,86,23],[90,6,86,25,"isModalVisible"],[90,20,86,39],[90,22,86,41],[90,27,86,46],[91,6,86,48,"targetPage"],[91,16,86,58],[91,18,86,60],[92,4,86,65],[92,5,86,66],[92,6,86,67],[93,4,88,2,"setMessage"],[93,14,88,12],[93,16,88,14,"setMessage"],[93,17,88,15,"message"],[93,24,88,30],[93,26,88,32,"targetPage"],[93,36,88,51],[93,41,88,56],[94,6,89,4,"set"],[94,9,89,7],[94,10,89,8],[95,8,89,10,"lastMessage"],[95,19,89,21],[95,21,89,23],[95,24,89,26,"message"],[95,31,89,33],[95,35,89,37,"Date"],[95,39,89,41],[95,40,89,42,"now"],[95,43,89,45],[95,44,89,46],[95,45,89,47],[95,47,89,49],[96,8,89,51,"targetPage"],[97,6,89,62],[97,7,89,63],[97,8,89,64],[98,4,90,2],[98,5,90,3],[99,4,92,2,"clearMessage"],[99,16,92,14],[99,18,92,16,"clearMessage"],[99,19,92,16],[99,24,92,22],[100,6,93,4,"set"],[100,9,93,7],[100,10,93,8],[101,8,93,10,"lastMessage"],[101,19,93,21],[101,21,93,23],[101,25,93,27],[102,8,93,29,"targetPage"],[102,18,93,39],[102,20,93,41],[103,6,93,46],[103,7,93,47],[103,8,93,48],[104,4,94,2],[105,2,95,0],[105,3,95,1],[105,4,95,2],[105,5,95,3],[106,0,95,4]],"functionMap":{"names":["<global>","create$argument_0","startServer","remoteControlService.init$argument_0.onMessage","remoteControlService.init$argument_0.onHandshake","stopServer","showModal","hideModal","setMessage","clearMessage"],"mappings":"AAA;gECsB;eCQ;iBCc;ODK;mBEC;OFG;GDsB;cIE;GJK;aKE,kEL;aMC,sDN;cOE;GPE;gBQE;GRE;EDC"}},"type":"js/module"}]}