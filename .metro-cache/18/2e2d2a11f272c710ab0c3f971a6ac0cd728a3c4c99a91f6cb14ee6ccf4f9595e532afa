{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":139,"column":2,"index":3736}}],"key":"7kvm5yrOpz4NYiDi6sn4qxa8DVQ="}},{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":139,"column":2,"index":3736}}],"key":"8I802z/QkQYw0PV6ZCqhBNDwn0Q="}},{"name":"@babel/runtime/helpers/slicedToArray","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":139,"column":2,"index":3736}}],"key":"EU+qeBIKi4KcIzPeK4PbkLqFqVY="}},{"name":"react","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":44,"index":44}}],"key":"a4EMkKqamYWCMMPV7UeQlqGQ+ks="}},{"name":"../stores/settingsStore","data":{"asyncType":null,"locs":[{"start":{"line":2,"column":0,"index":45},"end":{"line":2,"column":58,"index":103}}],"key":"cYd7bXZRUUlZX4iM7z2px4HzHB0="}},{"name":"../services/api","data":{"asyncType":null,"locs":[{"start":{"line":3,"column":0,"index":104},"end":{"line":3,"column":37,"index":141}}],"key":"9k4jq6FYa7kulu8bjoa7L/z8gFU="}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _interopRequireDefault = require(_dependencyMap[0]);\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.useApiConfig = exports.getApiConfigErrorMessage = undefined;\n  var _asyncToGenerator2 = _interopRequireDefault(require(_dependencyMap[1]));\n  var _slicedToArray2 = _interopRequireDefault(require(_dependencyMap[2]));\n  var _react = require(_dependencyMap[3]);\n  var _settingsStore = require(_dependencyMap[4]);\n  var _api = require(_dependencyMap[5]);\n  var useApiConfig = function () {\n    var _useSettingsStore = (0, _settingsStore.useSettingsStore)(),\n      apiBaseUrl = _useSettingsStore.apiBaseUrl,\n      serverConfig = _useSettingsStore.serverConfig,\n      isLoadingServerConfig = _useSettingsStore.isLoadingServerConfig;\n    var _useState = (0, _react.useState)({\n        isValidating: false,\n        isValid: null,\n        error: null\n      }),\n      _useState2 = (0, _slicedToArray2.default)(_useState, 2),\n      validationState = _useState2[0],\n      setValidationState = _useState2[1];\n    var isConfigured = Boolean(apiBaseUrl && apiBaseUrl.trim());\n    var needsConfiguration = !isConfigured;\n\n    // Validate API configuration when it changes\n    (0, _react.useEffect)(function () {\n      if (!isConfigured) {\n        setValidationState({\n          isValidating: false,\n          isValid: false,\n          error: null\n        });\n        return;\n      }\n      var validateConfig = /*#__PURE__*/function () {\n        var _ref = (0, _asyncToGenerator2.default)(function* () {\n          setValidationState(function (prev) {\n            return {\n              ...prev,\n              isValidating: true,\n              error: null\n            };\n          });\n          try {\n            yield _api.api.getServerConfig();\n            setValidationState({\n              isValidating: false,\n              isValid: true,\n              error: null\n            });\n          } catch (error) {\n            var errorMessage = '服务器连接失败';\n            if (error instanceof Error) {\n              switch (error.message) {\n                case 'API_URL_NOT_SET':\n                  errorMessage = 'API地址未设置';\n                  break;\n                case 'UNAUTHORIZED':\n                  errorMessage = '服务器认证失败';\n                  break;\n                default:\n                  if (error.message.includes('Network')) {\n                    errorMessage = '网络连接失败，请检查网络或服务器地址';\n                  } else if (error.message.includes('timeout')) {\n                    errorMessage = '连接超时，请检查服务器地址';\n                  } else if (error.message.includes('404')) {\n                    errorMessage = '服务器地址无效，请检查API路径';\n                  } else if (error.message.includes('500')) {\n                    errorMessage = '服务器内部错误';\n                  }\n                  break;\n              }\n            }\n            setValidationState({\n              isValidating: false,\n              isValid: false,\n              error: errorMessage\n            });\n          }\n        });\n        return function validateConfig() {\n          return _ref.apply(this, arguments);\n        };\n      }();\n\n      // Only validate if not already loading server config\n      if (!isLoadingServerConfig) {\n        validateConfig();\n      }\n    }, [apiBaseUrl, isConfigured, isLoadingServerConfig]);\n\n    // Reset validation when server config loading state changes\n    (0, _react.useEffect)(function () {\n      if (isLoadingServerConfig) {\n        setValidationState(function (prev) {\n          return {\n            ...prev,\n            isValidating: true,\n            error: null\n          };\n        });\n      }\n    }, [isLoadingServerConfig]);\n\n    // Update validation state based on server config\n    (0, _react.useEffect)(function () {\n      if (!isLoadingServerConfig && isConfigured) {\n        if (serverConfig) {\n          setValidationState(function (prev) {\n            return {\n              ...prev,\n              isValid: true,\n              error: null\n            };\n          });\n        } else {\n          setValidationState(function (prev) {\n            return {\n              ...prev,\n              isValid: false,\n              error: prev.error || '无法获取服务器配置'\n            };\n          });\n        }\n      }\n    }, [serverConfig, isLoadingServerConfig, isConfigured]);\n    var status = {\n      isConfigured,\n      isValidating: validationState.isValidating || isLoadingServerConfig,\n      isValid: validationState.isValid,\n      error: validationState.error,\n      needsConfiguration\n    };\n    return status;\n  };\n  exports.useApiConfig = useApiConfig;\n  var getApiConfigErrorMessage = function (status) {\n    if (status.needsConfiguration) {\n      return '请点击右上角设置按钮，配置您的服务器地址';\n    }\n    if (status.error) {\n      return status.error;\n    }\n    if (status.isValidating) {\n      return '正在验证服务器配置...';\n    }\n    if (status.isValid === false) {\n      return '服务器配置验证失败，请检查设置';\n    }\n    return '加载失败，请重试';\n  };\n  exports.getApiConfigErrorMessage = getApiConfigErrorMessage;\n});","lineCount":156,"map":[[9,2,1,0],[9,6,1,0,"_react"],[9,12,1,0],[9,15,1,0,"require"],[9,22,1,0],[9,23,1,0,"_dependencyMap"],[9,37,1,0],[10,2,2,0],[10,6,2,0,"_settingsStore"],[10,20,2,0],[10,23,2,0,"require"],[10,30,2,0],[10,31,2,0,"_dependencyMap"],[10,45,2,0],[11,2,3,0],[11,6,3,0,"_api"],[11,10,3,0],[11,13,3,0,"require"],[11,20,3,0],[11,21,3,0,"_dependencyMap"],[11,35,3,0],[12,2,13,7],[12,6,13,13,"useApiConfig"],[12,18,13,25],[12,21,13,28],[12,30,13,28,"useApiConfig"],[12,31,13,28],[12,33,13,34],[13,4,14,2],[13,8,14,2,"_useSettingsStore"],[13,25,14,2],[13,28,14,62],[13,32,14,62,"useSettingsStore"],[13,63,14,78],[13,65,14,79],[13,66,14,80],[14,6,14,10,"apiBaseUrl"],[14,16,14,20],[14,19,14,20,"_useSettingsStore"],[14,36,14,20],[14,37,14,10,"apiBaseUrl"],[14,47,14,20],[15,6,14,22,"serverConfig"],[15,18,14,34],[15,21,14,34,"_useSettingsStore"],[15,38,14,34],[15,39,14,22,"serverConfig"],[15,51,14,34],[16,6,14,36,"isLoadingServerConfig"],[16,27,14,57],[16,30,14,57,"_useSettingsStore"],[16,47,14,57],[16,48,14,36,"isLoadingServerConfig"],[16,69,14,57],[17,4,15,2],[17,8,15,2,"_useState"],[17,17,15,2],[17,20,15,48],[17,24,15,48,"useState"],[17,39,15,56],[17,41,19,5],[18,8,20,4,"isValidating"],[18,20,20,16],[18,22,20,18],[18,27,20,23],[19,8,21,4,"isValid"],[19,15,21,11],[19,17,21,13],[19,21,21,17],[20,8,22,4,"error"],[20,13,22,9],[20,15,22,11],[21,6,23,2],[21,7,23,3],[21,8,23,4],[22,6,23,4,"_useState2"],[22,16,23,4],[22,23,23,4,"_slicedToArray2"],[22,38,23,4],[22,39,23,4,"default"],[22,46,23,4],[22,48,23,4,"_useState"],[22,57,23,4],[23,6,15,9,"validationState"],[23,21,15,24],[23,24,15,24,"_useState2"],[23,34,15,24],[24,6,15,26,"setValidationState"],[24,24,15,44],[24,27,15,44,"_useState2"],[24,37,15,44],[25,4,25,2],[25,8,25,8,"isConfigured"],[25,20,25,20],[25,23,25,23,"Boolean"],[25,30,25,30],[25,31,25,31,"apiBaseUrl"],[25,41,25,41],[25,45,25,45,"apiBaseUrl"],[25,55,25,55],[25,56,25,56,"trim"],[25,60,25,60],[25,61,25,61],[25,62,25,62],[25,63,25,63],[26,4,26,2],[26,8,26,8,"needsConfiguration"],[26,26,26,26],[26,29,26,29],[26,30,26,30,"isConfigured"],[26,42,26,42],[28,4,28,2],[29,4,29,2],[29,8,29,2,"useEffect"],[29,24,29,11],[29,26,29,12],[29,38,29,18],[30,6,30,4],[30,10,30,8],[30,11,30,9,"isConfigured"],[30,23,30,21],[30,25,30,23],[31,8,31,6,"setValidationState"],[31,26,31,24],[31,27,31,25],[32,10,32,8,"isValidating"],[32,22,32,20],[32,24,32,22],[32,29,32,27],[33,10,33,8,"isValid"],[33,17,33,15],[33,19,33,17],[33,24,33,22],[34,10,34,8,"error"],[34,15,34,13],[34,17,34,15],[35,8,35,6],[35,9,35,7],[35,10,35,8],[36,8,36,6],[37,6,37,4],[38,6,39,4],[38,10,39,10,"validateConfig"],[38,24,39,24],[39,8,39,24],[39,12,39,24,"_ref"],[39,16,39,24],[39,23,39,24,"_asyncToGenerator2"],[39,41,39,24],[39,42,39,24,"default"],[39,49,39,24],[39,51,39,27],[39,64,39,39],[40,10,40,6,"setValidationState"],[40,28,40,24],[40,29,40,25],[40,39,40,25,"prev"],[40,43,40,29],[41,12,40,29],[41,19,40,34],[42,14,40,36],[42,17,40,39,"prev"],[42,21,40,43],[43,14,40,45,"isValidating"],[43,26,40,57],[43,28,40,59],[43,32,40,63],[44,14,40,65,"error"],[44,19,40,70],[44,21,40,72],[45,12,40,77],[45,13,40,78],[46,10,40,78],[46,11,40,79],[46,12,40,80],[47,10,42,6],[47,14,42,10],[48,12,43,8],[48,18,43,14,"api"],[48,26,43,17],[48,27,43,18,"getServerConfig"],[48,42,43,33],[48,43,43,34],[48,44,43,35],[49,12,44,8,"setValidationState"],[49,30,44,26],[49,31,44,27],[50,14,45,10,"isValidating"],[50,26,45,22],[50,28,45,24],[50,33,45,29],[51,14,46,10,"isValid"],[51,21,46,17],[51,23,46,19],[51,27,46,23],[52,14,47,10,"error"],[52,19,47,15],[52,21,47,17],[53,12,48,8],[53,13,48,9],[53,14,48,10],[54,10,49,6],[54,11,49,7],[54,12,49,8],[54,19,49,15,"error"],[54,24,49,20],[54,26,49,22],[55,12,50,8],[55,16,50,12,"errorMessage"],[55,28,50,24],[55,31,50,27],[55,40,50,36],[56,12,52,8],[56,16,52,12,"error"],[56,21,52,17],[56,33,52,29,"Error"],[56,38,52,34],[56,40,52,36],[57,14,53,10],[57,22,53,18,"error"],[57,27,53,23],[57,28,53,24,"message"],[57,35,53,31],[58,16,54,12],[58,21,54,17],[58,38,54,34],[59,18,55,14,"errorMessage"],[59,30,55,26],[59,33,55,29],[59,43,55,39],[60,18,56,14],[61,16,57,12],[61,21,57,17],[61,35,57,31],[62,18,58,14,"errorMessage"],[62,30,58,26],[62,33,58,29],[62,42,58,38],[63,18,59,14],[64,16,60,12],[65,18,61,14],[65,22,61,18,"error"],[65,27,61,23],[65,28,61,24,"message"],[65,35,61,31],[65,36,61,32,"includes"],[65,44,61,40],[65,45,61,41],[65,54,61,50],[65,55,61,51],[65,57,61,53],[66,20,62,16,"errorMessage"],[66,32,62,28],[66,35,62,31],[66,55,62,51],[67,18,63,14],[67,19,63,15],[67,25,63,21],[67,29,63,25,"error"],[67,34,63,30],[67,35,63,31,"message"],[67,42,63,38],[67,43,63,39,"includes"],[67,51,63,47],[67,52,63,48],[67,61,63,57],[67,62,63,58],[67,64,63,60],[68,20,64,16,"errorMessage"],[68,32,64,28],[68,35,64,31],[68,50,64,46],[69,18,65,14],[69,19,65,15],[69,25,65,21],[69,29,65,25,"error"],[69,34,65,30],[69,35,65,31,"message"],[69,42,65,38],[69,43,65,39,"includes"],[69,51,65,47],[69,52,65,48],[69,57,65,53],[69,58,65,54],[69,60,65,56],[70,20,66,16,"errorMessage"],[70,32,66,28],[70,35,66,31],[70,53,66,49],[71,18,67,14],[71,19,67,15],[71,25,67,21],[71,29,67,25,"error"],[71,34,67,30],[71,35,67,31,"message"],[71,42,67,38],[71,43,67,39,"includes"],[71,51,67,47],[71,52,67,48],[71,57,67,53],[71,58,67,54],[71,60,67,56],[72,20,68,16,"errorMessage"],[72,32,68,28],[72,35,68,31],[72,44,68,40],[73,18,69,14],[74,18,70,14],[75,14,71,10],[76,12,72,8],[77,12,74,8,"setValidationState"],[77,30,74,26],[77,31,74,27],[78,14,75,10,"isValidating"],[78,26,75,22],[78,28,75,24],[78,33,75,29],[79,14,76,10,"isValid"],[79,21,76,17],[79,23,76,19],[79,28,76,24],[80,14,77,10,"error"],[80,19,77,15],[80,21,77,17,"errorMessage"],[81,12,78,8],[81,13,78,9],[81,14,78,10],[82,10,79,6],[83,8,80,4],[83,9,80,5],[84,8,80,5],[84,24,39,10,"validateConfig"],[84,38,39,24,"validateConfig"],[84,39,39,24],[85,10,39,24],[85,17,39,24,"_ref"],[85,21,39,24],[85,22,39,24,"apply"],[85,27,39,24],[85,34,39,24,"arguments"],[85,43,39,24],[86,8,39,24],[87,6,39,24],[87,9,80,5],[89,6,82,4],[90,6,83,4],[90,10,83,8],[90,11,83,9,"isLoadingServerConfig"],[90,32,83,30],[90,34,83,32],[91,8,84,6,"validateConfig"],[91,22,84,20],[91,23,84,21],[91,24,84,22],[92,6,85,4],[93,4,86,2],[93,5,86,3],[93,7,86,5],[93,8,86,6,"apiBaseUrl"],[93,18,86,16],[93,20,86,18,"isConfigured"],[93,32,86,30],[93,34,86,32,"isLoadingServerConfig"],[93,55,86,53],[93,56,86,54],[93,57,86,55],[95,4,88,2],[96,4,89,2],[96,8,89,2,"useEffect"],[96,24,89,11],[96,26,89,12],[96,38,89,18],[97,6,90,4],[97,10,90,8,"isLoadingServerConfig"],[97,31,90,29],[97,33,90,31],[98,8,91,6,"setValidationState"],[98,26,91,24],[98,27,91,25],[98,37,91,25,"prev"],[98,41,91,29],[99,10,91,29],[99,17,91,34],[100,12,91,36],[100,15,91,39,"prev"],[100,19,91,43],[101,12,91,45,"isValidating"],[101,24,91,57],[101,26,91,59],[101,30,91,63],[102,12,91,65,"error"],[102,17,91,70],[102,19,91,72],[103,10,91,77],[103,11,91,78],[104,8,91,78],[104,9,91,79],[104,10,91,80],[105,6,92,4],[106,4,93,2],[106,5,93,3],[106,7,93,5],[106,8,93,6,"isLoadingServerConfig"],[106,29,93,27],[106,30,93,28],[106,31,93,29],[108,4,95,2],[109,4,96,2],[109,8,96,2,"useEffect"],[109,24,96,11],[109,26,96,12],[109,38,96,18],[110,6,97,4],[110,10,97,8],[110,11,97,9,"isLoadingServerConfig"],[110,32,97,30],[110,36,97,34,"isConfigured"],[110,48,97,46],[110,50,97,48],[111,8,98,6],[111,12,98,10,"serverConfig"],[111,24,98,22],[111,26,98,24],[112,10,99,8,"setValidationState"],[112,28,99,26],[112,29,99,27],[112,39,99,27,"prev"],[112,43,99,31],[113,12,99,31],[113,19,99,36],[114,14,99,38],[114,17,99,41,"prev"],[114,21,99,45],[115,14,99,47,"isValid"],[115,21,99,54],[115,23,99,56],[115,27,99,60],[116,14,99,62,"error"],[116,19,99,67],[116,21,99,69],[117,12,99,74],[117,13,99,75],[118,10,99,75],[118,11,99,76],[118,12,99,77],[119,8,100,6],[119,9,100,7],[119,15,100,13],[120,10,101,8,"setValidationState"],[120,28,101,26],[120,29,101,27],[120,39,101,27,"prev"],[120,43,101,31],[121,12,101,31],[121,19,101,36],[122,14,102,10],[122,17,102,13,"prev"],[122,21,102,17],[123,14,103,10,"isValid"],[123,21,103,17],[123,23,103,19],[123,28,103,24],[124,14,104,10,"error"],[124,19,104,15],[124,21,104,17,"prev"],[124,25,104,21],[124,26,104,22,"error"],[124,31,104,27],[124,35,104,31],[125,12,105,8],[125,13,105,9],[126,10,105,9],[126,11,105,10],[126,12,105,11],[127,8,106,6],[128,6,107,4],[129,4,108,2],[129,5,108,3],[129,7,108,5],[129,8,108,6,"serverConfig"],[129,20,108,18],[129,22,108,20,"isLoadingServerConfig"],[129,43,108,41],[129,45,108,43,"isConfigured"],[129,57,108,55],[129,58,108,56],[129,59,108,57],[130,4,110,2],[130,8,110,8,"status"],[130,14,110,31],[130,17,110,34],[131,6,111,4,"isConfigured"],[131,18,111,16],[132,6,112,4,"isValidating"],[132,18,112,16],[132,20,112,18,"validationState"],[132,35,112,33],[132,36,112,34,"isValidating"],[132,48,112,46],[132,52,112,50,"isLoadingServerConfig"],[132,73,112,71],[133,6,113,4,"isValid"],[133,13,113,11],[133,15,113,13,"validationState"],[133,30,113,28],[133,31,113,29,"isValid"],[133,38,113,36],[134,6,114,4,"error"],[134,11,114,9],[134,13,114,11,"validationState"],[134,28,114,26],[134,29,114,27,"error"],[134,34,114,32],[135,6,115,4,"needsConfiguration"],[136,4,116,2],[136,5,116,3],[137,4,118,2],[137,11,118,9,"status"],[137,17,118,15],[138,2,119,0],[138,3,119,1],[139,2,119,2,"exports"],[139,9,119,2],[139,10,119,2,"useApiConfig"],[139,22,119,2],[139,25,119,2,"useApiConfig"],[139,37,119,2],[140,2,121,7],[140,6,121,13,"getApiConfigErrorMessage"],[140,30,121,37],[140,33,121,40],[140,42,121,40,"getApiConfigErrorMessage"],[140,43,121,41,"status"],[140,49,121,64],[140,51,121,77],[141,4,122,2],[141,8,122,6,"status"],[141,14,122,12],[141,15,122,13,"needsConfiguration"],[141,33,122,31],[141,35,122,33],[142,6,123,4],[142,13,123,11],[142,35,123,33],[143,4,124,2],[144,4,126,2],[144,8,126,6,"status"],[144,14,126,12],[144,15,126,13,"error"],[144,20,126,18],[144,22,126,20],[145,6,127,4],[145,13,127,11,"status"],[145,19,127,17],[145,20,127,18,"error"],[145,25,127,23],[146,4,128,2],[147,4,130,2],[147,8,130,6,"status"],[147,14,130,12],[147,15,130,13,"isValidating"],[147,27,130,25],[147,29,130,27],[148,6,131,4],[148,13,131,11],[148,27,131,25],[149,4,132,2],[150,4,134,2],[150,8,134,6,"status"],[150,14,134,12],[150,15,134,13,"isValid"],[150,22,134,20],[150,27,134,25],[150,32,134,30],[150,34,134,32],[151,6,135,4],[151,13,135,11],[151,30,135,28],[152,4,136,2],[153,4,138,2],[153,11,138,9],[153,21,138,19],[154,2,139,0],[154,3,139,1],[155,2,139,2,"exports"],[155,9,139,2],[155,10,139,2,"getApiConfigErrorMessage"],[155,34,139,2],[155,37,139,2,"getApiConfigErrorMessage"],[155,61,139,2],[156,0,139,2]],"functionMap":{"names":["<global>","useApiConfig","useEffect$argument_0","validateConfig","setValidationState$argument_0","getApiConfigErrorMessage"],"mappings":"AAA;4BCY;YCgB;2BCU;yBCC,sDD;KDwC;GDM;YCG;yBEE,sDF;GDE;YCG;2BEG,iDF;2BEE;UFI;GDG;CDW;wCKE;CLkB"}},"type":"js/module"}]}