{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":81,"column":0,"index":2657}}],"key":"7kvm5yrOpz4NYiDi6sn4qxa8DVQ="}},{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":81,"column":0,"index":2657}}],"key":"8I802z/QkQYw0PV6ZCqhBNDwn0Q="}},{"name":"@/utils/Logger","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":36,"index":36}}],"key":"dpbJvsqVW0VVfFOl8dlhEC6KfVk="}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _interopRequireDefault = require(_dependencyMap[0]);\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.getResolutionFromM3U8 = undefined;\n  var _asyncToGenerator2 = _interopRequireDefault(require(_dependencyMap[1]));\n  var _Logger = _interopRequireDefault(require(_dependencyMap[2]));\n  var logger = _Logger.default.withTag('M3U8');\n  var resolutionCache = {};\n  var CACHE_DURATION = 300000; // 5 minutes\n\n  var getResolutionFromM3U8 = exports.getResolutionFromM3U8 = /*#__PURE__*/function () {\n    var _ref = (0, _asyncToGenerator2.default)(function* (url, signal) {\n      var perfStart = performance.now();\n      logger.info(`[PERF] M3U8 resolution detection START - url: ${url.substring(0, 100)}...`);\n\n      // 1. Check cache first\n      var cachedEntry = resolutionCache[url];\n      if (cachedEntry && Date.now() - cachedEntry.timestamp < CACHE_DURATION) {\n        var perfEnd = performance.now();\n        logger.info(`[PERF] M3U8 resolution detection CACHED - took ${(perfEnd - perfStart).toFixed(2)}ms, resolution: ${cachedEntry.resolution}`);\n        return cachedEntry.resolution;\n      }\n      if (!url.toLowerCase().endsWith(\".m3u8\")) {\n        logger.info(`[PERF] M3U8 resolution detection SKIPPED - not M3U8 file`);\n        return null;\n      }\n      try {\n        var fetchStart = performance.now();\n        var response = yield fetch(url, {\n          signal\n        });\n        var fetchEnd = performance.now();\n        logger.info(`[PERF] M3U8 fetch took ${(fetchEnd - fetchStart).toFixed(2)}ms, status: ${response.status}`);\n        if (!response.ok) {\n          return null;\n        }\n        var parseStart = performance.now();\n        var playlist = yield response.text();\n        var lines = playlist.split(\"\\n\");\n        var highestResolution = 0;\n        var resolutionString = null;\n        for (var line of lines) {\n          if (line.startsWith(\"#EXT-X-STREAM-INF\")) {\n            var resolutionMatch = line.match(/RESOLUTION=(\\d+)x(\\d+)/);\n            if (resolutionMatch) {\n              var height = parseInt(resolutionMatch[2], 10);\n              if (height > highestResolution) {\n                highestResolution = height;\n                resolutionString = `${height}p`;\n              }\n            }\n          }\n        }\n        var parseEnd = performance.now();\n        logger.info(`[PERF] M3U8 parsing took ${(parseEnd - parseStart).toFixed(2)}ms, lines: ${lines.length}`);\n\n        // 2. Store result in cache\n        resolutionCache[url] = {\n          resolution: resolutionString,\n          timestamp: Date.now()\n        };\n        var _perfEnd = performance.now();\n        logger.info(`[PERF] M3U8 resolution detection COMPLETE - took ${(_perfEnd - perfStart).toFixed(2)}ms, resolution: ${resolutionString}`);\n        return resolutionString;\n      } catch (error) {\n        var _perfEnd2 = performance.now();\n        logger.info(`[PERF] M3U8 resolution detection ERROR - took ${(_perfEnd2 - perfStart).toFixed(2)}ms, error: ${error}`);\n        return null;\n      }\n    });\n    return function getResolutionFromM3U8(_x, _x2) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n});","lineCount":77,"map":[[8,2,1,0],[8,6,1,0,"_Logger"],[8,13,1,0],[8,16,1,0,"_interopRequireDefault"],[8,38,1,0],[8,39,1,0,"require"],[8,46,1,0],[8,47,1,0,"_dependencyMap"],[8,61,1,0],[9,2,3,0],[9,6,3,6,"logger"],[9,12,3,12],[9,15,3,15,"Logger"],[9,30,3,21],[9,31,3,22,"withTag"],[9,38,3,29],[9,39,3,30],[9,45,3,36],[9,46,3,37],[10,2,10,0],[10,6,10,6,"resolutionCache"],[10,21,10,52],[10,24,10,55],[10,25,10,56],[10,26,10,57],[11,2,11,0],[11,6,11,6,"CACHE_DURATION"],[11,20,11,20],[11,29,11,36],[11,30,11,37],[11,31,11,38],[13,2,13,7],[13,6,13,13,"getResolutionFromM3U8"],[13,27,13,34],[13,30,13,34,"exports"],[13,37,13,34],[13,38,13,34,"getResolutionFromM3U8"],[13,59,13,34],[14,4,13,34],[14,8,13,34,"_ref"],[14,12,13,34],[14,19,13,34,"_asyncToGenerator2"],[14,37,13,34],[14,38,13,34,"default"],[14,45,13,34],[14,47,13,37],[14,58,14,2,"url"],[14,61,14,13],[14,63,15,2,"signal"],[14,69,15,22],[14,71,16,29],[15,6,17,2],[15,10,17,8,"perfStart"],[15,19,17,17],[15,22,17,20,"performance"],[15,33,17,31],[15,34,17,32,"now"],[15,37,17,35],[15,38,17,36],[15,39,17,37],[16,6,18,2,"logger"],[16,12,18,8],[16,13,18,9,"info"],[16,17,18,13],[16,18,18,14],[16,67,18,63,"url"],[16,70,18,66],[16,71,18,67,"substring"],[16,80,18,76],[16,81,18,77],[16,82,18,78],[16,84,18,80],[16,87,18,83],[16,88,18,84],[16,93,18,89],[16,94,18,90],[18,6,20,2],[19,6,21,2],[19,10,21,8,"cachedEntry"],[19,21,21,19],[19,24,21,22,"resolutionCache"],[19,39,21,37],[19,40,21,38,"url"],[19,43,21,41],[19,44,21,42],[20,6,22,2],[20,10,22,6,"cachedEntry"],[20,21,22,17],[20,25,22,21,"Date"],[20,29,22,25],[20,30,22,26,"now"],[20,33,22,29],[20,34,22,30],[20,35,22,31],[20,38,22,34,"cachedEntry"],[20,49,22,45],[20,50,22,46,"timestamp"],[20,59,22,55],[20,62,22,58,"CACHE_DURATION"],[20,76,22,72],[20,78,22,74],[21,8,23,4],[21,12,23,10,"perfEnd"],[21,19,23,17],[21,22,23,20,"performance"],[21,33,23,31],[21,34,23,32,"now"],[21,37,23,35],[21,38,23,36],[21,39,23,37],[22,8,24,4,"logger"],[22,14,24,10],[22,15,24,11,"info"],[22,19,24,15],[22,20,24,16],[22,70,24,66],[22,71,24,67,"perfEnd"],[22,78,24,74],[22,81,24,77,"perfStart"],[22,90,24,86],[22,92,24,88,"toFixed"],[22,99,24,95],[22,100,24,96],[22,101,24,97],[22,102,24,98],[22,121,24,117,"cachedEntry"],[22,132,24,128],[22,133,24,129,"resolution"],[22,143,24,139],[22,145,24,141],[22,146,24,142],[23,8,25,4],[23,15,25,11,"cachedEntry"],[23,26,25,22],[23,27,25,23,"resolution"],[23,37,25,33],[24,6,26,2],[25,6,28,2],[25,10,28,6],[25,11,28,7,"url"],[25,14,28,10],[25,15,28,11,"toLowerCase"],[25,26,28,22],[25,27,28,23],[25,28,28,24],[25,29,28,25,"endsWith"],[25,37,28,33],[25,38,28,34],[25,45,28,41],[25,46,28,42],[25,48,28,44],[26,8,29,4,"logger"],[26,14,29,10],[26,15,29,11,"info"],[26,19,29,15],[26,20,29,16],[26,78,29,74],[26,79,29,75],[27,8,30,4],[27,15,30,11],[27,19,30,15],[28,6,31,2],[29,6,33,2],[29,10,33,6],[30,8,34,4],[30,12,34,10,"fetchStart"],[30,22,34,20],[30,25,34,23,"performance"],[30,36,34,34],[30,37,34,35,"now"],[30,40,34,38],[30,41,34,39],[30,42,34,40],[31,8,35,4],[31,12,35,10,"response"],[31,20,35,18],[31,29,35,27,"fetch"],[31,34,35,32],[31,35,35,33,"url"],[31,38,35,36],[31,40,35,38],[32,10,35,40,"signal"],[33,8,35,47],[33,9,35,48],[33,10,35,49],[34,8,36,4],[34,12,36,10,"fetchEnd"],[34,20,36,18],[34,23,36,21,"performance"],[34,34,36,32],[34,35,36,33,"now"],[34,38,36,36],[34,39,36,37],[34,40,36,38],[35,8,37,4,"logger"],[35,14,37,10],[35,15,37,11,"info"],[35,19,37,15],[35,20,37,16],[35,46,37,42],[35,47,37,43,"fetchEnd"],[35,55,37,51],[35,58,37,54,"fetchStart"],[35,68,37,64],[35,70,37,66,"toFixed"],[35,77,37,73],[35,78,37,74],[35,79,37,75],[35,80,37,76],[35,95,37,91,"response"],[35,103,37,99],[35,104,37,100,"status"],[35,110,37,106],[35,112,37,108],[35,113,37,109],[36,8,39,4],[36,12,39,8],[36,13,39,9,"response"],[36,21,39,17],[36,22,39,18,"ok"],[36,24,39,20],[36,26,39,22],[37,10,40,6],[37,17,40,13],[37,21,40,17],[38,8,41,4],[39,8,43,4],[39,12,43,10,"parseStart"],[39,22,43,20],[39,25,43,23,"performance"],[39,36,43,34],[39,37,43,35,"now"],[39,40,43,38],[39,41,43,39],[39,42,43,40],[40,8,44,4],[40,12,44,10,"playlist"],[40,20,44,18],[40,29,44,27,"response"],[40,37,44,35],[40,38,44,36,"text"],[40,42,44,40],[40,43,44,41],[40,44,44,42],[41,8,45,4],[41,12,45,10,"lines"],[41,17,45,15],[41,20,45,18,"playlist"],[41,28,45,26],[41,29,45,27,"split"],[41,34,45,32],[41,35,45,33],[41,39,45,37],[41,40,45,38],[42,8,46,4],[42,12,46,8,"highestResolution"],[42,29,46,25],[42,32,46,28],[42,33,46,29],[43,8,47,4],[43,12,47,8,"resolutionString"],[43,28,47,39],[43,31,47,42],[43,35,47,46],[44,8,49,4],[44,13,49,9],[44,17,49,15,"line"],[44,21,49,19],[44,25,49,23,"lines"],[44,30,49,28],[44,32,49,30],[45,10,50,6],[45,14,50,10,"line"],[45,18,50,14],[45,19,50,15,"startsWith"],[45,29,50,25],[45,30,50,26],[45,49,50,45],[45,50,50,46],[45,52,50,48],[46,12,51,8],[46,16,51,14,"resolutionMatch"],[46,31,51,29],[46,34,51,32,"line"],[46,38,51,36],[46,39,51,37,"match"],[46,44,51,42],[46,45,51,43],[46,69,51,67],[46,70,51,68],[47,12,52,8],[47,16,52,12,"resolutionMatch"],[47,31,52,27],[47,33,52,29],[48,14,53,10],[48,18,53,16,"height"],[48,24,53,22],[48,27,53,25,"parseInt"],[48,35,53,33],[48,36,53,34,"resolutionMatch"],[48,51,53,49],[48,52,53,50],[48,53,53,51],[48,54,53,52],[48,56,53,54],[48,58,53,56],[48,59,53,57],[49,14,54,10],[49,18,54,14,"height"],[49,24,54,20],[49,27,54,23,"highestResolution"],[49,44,54,40],[49,46,54,42],[50,16,55,12,"highestResolution"],[50,33,55,29],[50,36,55,32,"height"],[50,42,55,38],[51,16,56,12,"resolutionString"],[51,32,56,28],[51,35,56,31],[51,38,56,34,"height"],[51,44,56,40],[51,47,56,43],[52,14,57,10],[53,12,58,8],[54,10,59,6],[55,8,60,4],[56,8,62,4],[56,12,62,10,"parseEnd"],[56,20,62,18],[56,23,62,21,"performance"],[56,34,62,32],[56,35,62,33,"now"],[56,38,62,36],[56,39,62,37],[56,40,62,38],[57,8,63,4,"logger"],[57,14,63,10],[57,15,63,11,"info"],[57,19,63,15],[57,20,63,16],[57,48,63,44],[57,49,63,45,"parseEnd"],[57,57,63,53],[57,60,63,56,"parseStart"],[57,70,63,66],[57,72,63,68,"toFixed"],[57,79,63,75],[57,80,63,76],[57,81,63,77],[57,82,63,78],[57,96,63,92,"lines"],[57,101,63,97],[57,102,63,98,"length"],[57,108,63,104],[57,110,63,106],[57,111,63,107],[59,8,65,4],[60,8,66,4,"resolutionCache"],[60,23,66,19],[60,24,66,20,"url"],[60,27,66,23],[60,28,66,24],[60,31,66,27],[61,10,67,6,"resolution"],[61,20,67,16],[61,22,67,18,"resolutionString"],[61,38,67,34],[62,10,68,6,"timestamp"],[62,19,68,15],[62,21,68,17,"Date"],[62,25,68,21],[62,26,68,22,"now"],[62,29,68,25],[62,30,68,26],[63,8,69,4],[63,9,69,5],[64,8,71,4],[64,12,71,10,"perfEnd"],[64,20,71,17],[64,23,71,20,"performance"],[64,34,71,31],[64,35,71,32,"now"],[64,38,71,35],[64,39,71,36],[64,40,71,37],[65,8,72,4,"logger"],[65,14,72,10],[65,15,72,11,"info"],[65,19,72,15],[65,20,72,16],[65,72,72,68],[65,73,72,69,"perfEnd"],[65,81,72,76],[65,84,72,79,"perfStart"],[65,93,72,88],[65,95,72,90,"toFixed"],[65,102,72,97],[65,103,72,98],[65,104,72,99],[65,105,72,100],[65,124,72,119,"resolutionString"],[65,140,72,135],[65,142,72,137],[65,143,72,138],[66,8,74,4],[66,15,74,11,"resolutionString"],[66,31,74,27],[67,6,75,2],[67,7,75,3],[67,8,75,4],[67,15,75,11,"error"],[67,20,75,16],[67,22,75,18],[68,8,76,4],[68,12,76,10,"perfEnd"],[68,21,76,17],[68,24,76,20,"performance"],[68,35,76,31],[68,36,76,32,"now"],[68,39,76,35],[68,40,76,36],[68,41,76,37],[69,8,77,4,"logger"],[69,14,77,10],[69,15,77,11,"info"],[69,19,77,15],[69,20,77,16],[69,69,77,65],[69,70,77,66,"perfEnd"],[69,79,77,73],[69,82,77,76,"perfStart"],[69,91,77,85],[69,93,77,87,"toFixed"],[69,100,77,94],[69,101,77,95],[69,102,77,96],[69,103,77,97],[69,117,77,111,"error"],[69,122,77,116],[69,124,77,118],[69,125,77,119],[70,8,78,4],[70,15,78,11],[70,19,78,15],[71,6,79,2],[72,4,80,0],[72,5,80,1],[73,4,80,1],[73,20,13,13,"getResolutionFromM3U8"],[73,41,13,34,"getResolutionFromM3U8"],[73,42,13,34,"_x"],[73,44,13,34],[73,46,13,34,"_x2"],[73,49,13,34],[74,6,13,34],[74,13,13,34,"_ref"],[74,17,13,34],[74,18,13,34,"apply"],[74,23,13,34],[74,30,13,34,"arguments"],[74,39,13,34],[75,4,13,34],[76,2,13,34],[76,5,80,1],[77,0,80,2]],"functionMap":{"names":["<global>","getResolutionFromM3U8"],"mappings":"AAA;qCCY;CDmE"}},"type":"js/module"}]}