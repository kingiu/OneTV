{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":107,"column":0,"index":3730}}],"key":"7kvm5yrOpz4NYiDi6sn4qxa8DVQ="}},{"name":"zustand","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":33,"index":33}}],"key":"xFAZpEovr+Y5/UCynUzO0ntFekY="}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"locs":[{"start":{"line":2,"column":0,"index":34},"end":{"line":2,"column":69,"index":103}}],"key":"6eZFbfKht0uO2NEVT/d8+i8B0s8="}},{"name":"../services/api","data":{"asyncType":null,"locs":[{"start":{"line":3,"column":0,"index":104},"end":{"line":3,"column":38,"index":142}}],"key":"9k4jq6FYa7kulu8bjoa7L/z8gFU="}},{"name":"./settingsStore","data":{"asyncType":null,"locs":[{"start":{"line":4,"column":0,"index":143},"end":{"line":4,"column":51,"index":194}}],"key":"K2bXEdKq/GtHbPkcBG1P8ED6GZY="}},{"name":"react-native-toast-message","data":{"asyncType":null,"locs":[{"start":{"line":5,"column":0,"index":195},"end":{"line":5,"column":47,"index":242}}],"key":"mvLfpRqMmyOUTnGhKaiVkXHegIo="}},{"name":"../utils/Logger","data":{"asyncType":null,"locs":[{"start":{"line":6,"column":0,"index":243},"end":{"line":6,"column":37,"index":280}}],"key":"rD5UrWJd899SO1d///YpsfF5nbE="}},{"name":"./membershipStore","data":{"asyncType":null,"locs":[{"start":{"line":7,"column":0,"index":281},"end":{"line":7,"column":52,"index":333}}],"key":"kL5wwjQvYtD2vtI9NP3IZqbpDt4="}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _interopRequireDefault = require(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.useAuthStore = exports.default = exports.authStore = void 0;\n  var _zustand = require(_dependencyMap[1], \"zustand\");\n  var _asyncStorage = _interopRequireDefault(require(_dependencyMap[2], \"@react-native-async-storage/async-storage\"));\n  var _api = require(_dependencyMap[3], \"../services/api\");\n  var _settingsStore = require(_dependencyMap[4], \"./settingsStore\");\n  var _reactNativeToastMessage = _interopRequireDefault(require(_dependencyMap[5], \"react-native-toast-message\"));\n  var _Logger = _interopRequireDefault(require(_dependencyMap[6], \"../utils/Logger\"));\n  var _membershipStore = require(_dependencyMap[7], \"./membershipStore\");\n  const logger = _Logger.default.withTag('AuthStore');\n  // 创建认证状态store\n  const useAuthStore = exports.useAuthStore = (0, _zustand.create)(set => ({\n    isLoggedIn: false,\n    isLoginModalVisible: false,\n    showLoginModal: () => set({\n      isLoginModalVisible: true\n    }),\n    hideLoginModal: () => set({\n      isLoginModalVisible: false\n    }),\n    checkLoginStatus: async apiBaseUrl => {\n      if (!apiBaseUrl) {\n        set({\n          isLoggedIn: false,\n          isLoginModalVisible: false\n        });\n        _membershipStore.membershipStore.getState().clearMembershipInfo();\n        return;\n      }\n      try {\n        // Wait for server config to be loaded if it's currently loading\n        const settingsState = _settingsStore.useSettingsStore.getState();\n        let serverConfig = settingsState.serverConfig;\n\n        // If server config is loading, wait a bit for it to complete\n        if (settingsState.isLoadingServerConfig) {\n          // Wait up to 3 seconds for server config to load\n          const maxWaitTime = 3000;\n          const checkInterval = 100;\n          let waitTime = 0;\n          while (waitTime < maxWaitTime) {\n            await new Promise(resolve => setTimeout(resolve, checkInterval));\n            waitTime += checkInterval;\n            const currentState = _settingsStore.useSettingsStore.getState();\n            if (!currentState.isLoadingServerConfig) {\n              serverConfig = currentState.serverConfig;\n              break;\n            }\n          }\n        }\n        if (!serverConfig?.StorageType) {\n          // Only show error if we're not loading and have tried to fetch the config\n          if (!settingsState.isLoadingServerConfig) {\n            _reactNativeToastMessage.default.show({\n              type: \"error\",\n              text1: \"请检查网络或者服务器地址是否可用\"\n            });\n          }\n          return;\n        }\n        const authToken = await _asyncStorage.default.getItem('authCookies');\n        if (!authToken) {\n          if (serverConfig && serverConfig.StorageType === \"localstorage\") {\n            const loginResult = await _api.api.login().catch(() => {\n              set({\n                isLoggedIn: false,\n                isLoginModalVisible: true\n              });\n              _membershipStore.membershipStore.getState().clearMembershipInfo();\n            });\n            if (loginResult && loginResult.ok) {\n              set({\n                isLoggedIn: true\n              });\n              await _membershipStore.membershipStore.getState().fetchMembershipInfo();\n            }\n          } else {\n            set({\n              isLoggedIn: false,\n              isLoginModalVisible: true\n            });\n            _membershipStore.membershipStore.getState().clearMembershipInfo();\n          }\n        } else {\n          set({\n            isLoggedIn: true,\n            isLoginModalVisible: false\n          });\n          await _membershipStore.membershipStore.getState().fetchMembershipInfo();\n        }\n      } catch (error) {\n        logger.error(\"Failed to check login status:\", error);\n        _membershipStore.membershipStore.getState().clearMembershipInfo();\n        if (error instanceof Error && error.message === \"UNAUTHORIZED\") {\n          set({\n            isLoggedIn: false,\n            isLoginModalVisible: true\n          });\n        } else {\n          set({\n            isLoggedIn: false\n          });\n        }\n      }\n    },\n    logout: async () => {\n      try {\n        await _api.api.logout();\n        set({\n          isLoggedIn: false,\n          isLoginModalVisible: true\n        });\n        _membershipStore.membershipStore.getState().clearMembershipInfo();\n      } catch (error) {\n        logger.error(\"Failed to logout:\", error);\n      }\n    }\n  }));\n  var _default = exports.default = useAuthStore; // 为了兼容现有代码，保留旧的导出\n  const authStore = exports.authStore = useAuthStore;\n});","lineCount":125,"map":[[7,2,1,0],[7,6,1,0,"_zustand"],[7,14,1,0],[7,17,1,0,"require"],[7,24,1,0],[7,25,1,0,"_dependencyMap"],[7,39,1,0],[8,2,2,0],[8,6,2,0,"_asyncStorage"],[8,19,2,0],[8,22,2,0,"_interopRequireDefault"],[8,44,2,0],[8,45,2,0,"require"],[8,52,2,0],[8,53,2,0,"_dependencyMap"],[8,67,2,0],[9,2,3,0],[9,6,3,0,"_api"],[9,10,3,0],[9,13,3,0,"require"],[9,20,3,0],[9,21,3,0,"_dependencyMap"],[9,35,3,0],[10,2,4,0],[10,6,4,0,"_settingsStore"],[10,20,4,0],[10,23,4,0,"require"],[10,30,4,0],[10,31,4,0,"_dependencyMap"],[10,45,4,0],[11,2,5,0],[11,6,5,0,"_reactNativeToastMessage"],[11,30,5,0],[11,33,5,0,"_interopRequireDefault"],[11,55,5,0],[11,56,5,0,"require"],[11,63,5,0],[11,64,5,0,"_dependencyMap"],[11,78,5,0],[12,2,6,0],[12,6,6,0,"_Logger"],[12,13,6,0],[12,16,6,0,"_interopRequireDefault"],[12,38,6,0],[12,39,6,0,"require"],[12,46,6,0],[12,47,6,0,"_dependencyMap"],[12,61,6,0],[13,2,7,0],[13,6,7,0,"_membershipStore"],[13,22,7,0],[13,25,7,0,"require"],[13,32,7,0],[13,33,7,0,"_dependencyMap"],[13,47,7,0],[14,2,9,0],[14,8,9,6,"logger"],[14,14,9,12],[14,17,9,15,"Logger"],[14,32,9,21],[14,33,9,22,"withTag"],[14,40,9,29],[14,41,9,30],[14,52,9,41],[14,53,9,42],[15,2,20,0],[16,2,21,7],[16,8,21,13,"useAuthStore"],[16,20,21,25],[16,23,21,25,"exports"],[16,30,21,25],[16,31,21,25,"useAuthStore"],[16,43,21,25],[16,46,21,28],[16,50,21,28,"create"],[16,65,21,34],[16,67,21,47,"set"],[16,70,21,50],[16,75,21,56],[17,4,22,2,"isLoggedIn"],[17,14,22,12],[17,16,22,14],[17,21,22,19],[18,4,23,2,"isLoginModalVisible"],[18,23,23,21],[18,25,23,23],[18,30,23,28],[19,4,24,2,"showLoginModal"],[19,18,24,16],[19,20,24,18,"showLoginModal"],[19,21,24,18],[19,26,24,24,"set"],[19,29,24,27],[19,30,24,28],[20,6,24,30,"isLoginModalVisible"],[20,25,24,49],[20,27,24,51],[21,4,24,56],[21,5,24,57],[21,6,24,58],[22,4,25,2,"hideLoginModal"],[22,18,25,16],[22,20,25,18,"hideLoginModal"],[22,21,25,18],[22,26,25,24,"set"],[22,29,25,27],[22,30,25,28],[23,6,25,30,"isLoginModalVisible"],[23,25,25,49],[23,27,25,51],[24,4,25,57],[24,5,25,58],[24,6,25,59],[25,4,26,2,"checkLoginStatus"],[25,20,26,18],[25,22,26,20],[25,28,26,27,"apiBaseUrl"],[25,38,26,46],[25,42,26,51],[26,6,27,4],[26,10,27,8],[26,11,27,9,"apiBaseUrl"],[26,21,27,19],[26,23,27,21],[27,8,28,6,"set"],[27,11,28,9],[27,12,28,10],[28,10,28,12,"isLoggedIn"],[28,20,28,22],[28,22,28,24],[28,27,28,29],[29,10,28,31,"isLoginModalVisible"],[29,29,28,50],[29,31,28,52],[30,8,28,58],[30,9,28,59],[30,10,28,60],[31,8,29,6,"membershipStore"],[31,40,29,21],[31,41,29,22,"getState"],[31,49,29,30],[31,50,29,31],[31,51,29,32],[31,52,29,33,"clearMembershipInfo"],[31,71,29,52],[31,72,29,53],[31,73,29,54],[32,8,30,6],[33,6,31,4],[34,6,32,4],[34,10,32,8],[35,8,33,6],[36,8,34,6],[36,14,34,12,"settingsState"],[36,27,34,25],[36,30,34,28,"useSettingsStore"],[36,61,34,44],[36,62,34,45,"getState"],[36,70,34,53],[36,71,34,54],[36,72,34,55],[37,8,35,6],[37,12,35,10,"serverConfig"],[37,24,35,22],[37,27,35,25,"settingsState"],[37,40,35,38],[37,41,35,39,"serverConfig"],[37,53,35,51],[39,8,37,6],[40,8,38,6],[40,12,38,10,"settingsState"],[40,25,38,23],[40,26,38,24,"isLoadingServerConfig"],[40,47,38,45],[40,49,38,47],[41,10,39,8],[42,10,40,8],[42,16,40,14,"maxWaitTime"],[42,27,40,25],[42,30,40,28],[42,34,40,32],[43,10,41,8],[43,16,41,14,"checkInterval"],[43,29,41,27],[43,32,41,30],[43,35,41,33],[44,10,42,8],[44,14,42,12,"waitTime"],[44,22,42,20],[44,25,42,23],[44,26,42,24],[45,10,44,8],[45,17,44,15,"waitTime"],[45,25,44,23],[45,28,44,26,"maxWaitTime"],[45,39,44,37],[45,41,44,39],[46,12,45,10],[46,18,45,16],[46,22,45,20,"Promise"],[46,29,45,27],[46,30,45,28,"resolve"],[46,37,45,35],[46,41,45,39,"setTimeout"],[46,51,45,49],[46,52,45,50,"resolve"],[46,59,45,57],[46,61,45,59,"checkInterval"],[46,74,45,72],[46,75,45,73],[46,76,45,74],[47,12,46,10,"waitTime"],[47,20,46,18],[47,24,46,22,"checkInterval"],[47,37,46,35],[48,12,47,10],[48,18,47,16,"currentState"],[48,30,47,28],[48,33,47,31,"useSettingsStore"],[48,64,47,47],[48,65,47,48,"getState"],[48,73,47,56],[48,74,47,57],[48,75,47,58],[49,12,48,10],[49,16,48,14],[49,17,48,15,"currentState"],[49,29,48,27],[49,30,48,28,"isLoadingServerConfig"],[49,51,48,49],[49,53,48,51],[50,14,49,12,"serverConfig"],[50,26,49,24],[50,29,49,27,"currentState"],[50,41,49,39],[50,42,49,40,"serverConfig"],[50,54,49,52],[51,14,50,12],[52,12,51,10],[53,10,52,8],[54,8,53,6],[55,8,55,6],[55,12,55,10],[55,13,55,11,"serverConfig"],[55,25,55,23],[55,27,55,25,"StorageType"],[55,38,55,36],[55,40,55,38],[56,10,56,8],[57,10,57,8],[57,14,57,12],[57,15,57,13,"settingsState"],[57,28,57,26],[57,29,57,27,"isLoadingServerConfig"],[57,50,57,48],[57,52,57,50],[58,12,58,10,"Toast"],[58,44,58,15],[58,45,58,16,"show"],[58,49,58,20],[58,50,58,21],[59,14,58,23,"type"],[59,18,58,27],[59,20,58,29],[59,27,58,36],[60,14,58,38,"text1"],[60,19,58,43],[60,21,58,45],[61,12,58,64],[61,13,58,65],[61,14,58,66],[62,10,59,8],[63,10,60,8],[64,8,61,6],[65,8,63,6],[65,14,63,12,"authToken"],[65,23,63,21],[65,26,63,24],[65,32,63,30,"AsyncStorage"],[65,53,63,42],[65,54,63,43,"getItem"],[65,61,63,50],[65,62,63,51],[65,75,63,64],[65,76,63,65],[66,8,64,6],[66,12,64,10],[66,13,64,11,"authToken"],[66,22,64,20],[66,24,64,22],[67,10,65,8],[67,14,65,12,"serverConfig"],[67,26,65,24],[67,30,65,28,"serverConfig"],[67,42,65,40],[67,43,65,41,"StorageType"],[67,54,65,52],[67,59,65,57],[67,73,65,71],[67,75,65,73],[68,12,66,10],[68,18,66,16,"loginResult"],[68,29,66,27],[68,32,66,30],[68,38,66,36,"api"],[68,46,66,39],[68,47,66,40,"login"],[68,52,66,45],[68,53,66,46],[68,54,66,47],[68,55,66,48,"catch"],[68,60,66,53],[68,61,66,54],[68,67,66,60],[69,14,67,12,"set"],[69,17,67,15],[69,18,67,16],[70,16,67,18,"isLoggedIn"],[70,26,67,28],[70,28,67,30],[70,33,67,35],[71,16,67,37,"isLoginModalVisible"],[71,35,67,56],[71,37,67,58],[72,14,67,63],[72,15,67,64],[72,16,67,65],[73,14,68,12,"membershipStore"],[73,46,68,27],[73,47,68,28,"getState"],[73,55,68,36],[73,56,68,37],[73,57,68,38],[73,58,68,39,"clearMembershipInfo"],[73,77,68,58],[73,78,68,59],[73,79,68,60],[74,12,69,10],[74,13,69,11],[74,14,69,12],[75,12,70,10],[75,16,70,14,"loginResult"],[75,27,70,25],[75,31,70,29,"loginResult"],[75,42,70,40],[75,43,70,41,"ok"],[75,45,70,43],[75,47,70,45],[76,14,71,12,"set"],[76,17,71,15],[76,18,71,16],[77,16,71,18,"isLoggedIn"],[77,26,71,28],[77,28,71,30],[78,14,71,35],[78,15,71,36],[78,16,71,37],[79,14,72,12],[79,20,72,18,"membershipStore"],[79,52,72,33],[79,53,72,34,"getState"],[79,61,72,42],[79,62,72,43],[79,63,72,44],[79,64,72,45,"fetchMembershipInfo"],[79,83,72,64],[79,84,72,65],[79,85,72,66],[80,12,73,10],[81,10,74,8],[81,11,74,9],[81,17,74,15],[82,12,75,10,"set"],[82,15,75,13],[82,16,75,14],[83,14,75,16,"isLoggedIn"],[83,24,75,26],[83,26,75,28],[83,31,75,33],[84,14,75,35,"isLoginModalVisible"],[84,33,75,54],[84,35,75,56],[85,12,75,61],[85,13,75,62],[85,14,75,63],[86,12,76,10,"membershipStore"],[86,44,76,25],[86,45,76,26,"getState"],[86,53,76,34],[86,54,76,35],[86,55,76,36],[86,56,76,37,"clearMembershipInfo"],[86,75,76,56],[86,76,76,57],[86,77,76,58],[87,10,77,8],[88,8,78,6],[88,9,78,7],[88,15,78,13],[89,10,79,8,"set"],[89,13,79,11],[89,14,79,12],[90,12,79,14,"isLoggedIn"],[90,22,79,24],[90,24,79,26],[90,28,79,30],[91,12,79,32,"isLoginModalVisible"],[91,31,79,51],[91,33,79,53],[92,10,79,59],[92,11,79,60],[92,12,79,61],[93,10,80,8],[93,16,80,14,"membershipStore"],[93,48,80,29],[93,49,80,30,"getState"],[93,57,80,38],[93,58,80,39],[93,59,80,40],[93,60,80,41,"fetchMembershipInfo"],[93,79,80,60],[93,80,80,61],[93,81,80,62],[94,8,81,6],[95,6,82,4],[95,7,82,5],[95,8,82,6],[95,15,82,13,"error"],[95,20,82,18],[95,22,82,20],[96,8,83,6,"logger"],[96,14,83,12],[96,15,83,13,"error"],[96,20,83,18],[96,21,83,19],[96,52,83,50],[96,54,83,52,"error"],[96,59,83,57],[96,60,83,58],[97,8,84,6,"membershipStore"],[97,40,84,21],[97,41,84,22,"getState"],[97,49,84,30],[97,50,84,31],[97,51,84,32],[97,52,84,33,"clearMembershipInfo"],[97,71,84,52],[97,72,84,53],[97,73,84,54],[98,8,85,6],[98,12,85,10,"error"],[98,17,85,15],[98,29,85,27,"Error"],[98,34,85,32],[98,38,85,36,"error"],[98,43,85,41],[98,44,85,42,"message"],[98,51,85,49],[98,56,85,54],[98,70,85,68],[98,72,85,70],[99,10,86,8,"set"],[99,13,86,11],[99,14,86,12],[100,12,86,14,"isLoggedIn"],[100,22,86,24],[100,24,86,26],[100,29,86,31],[101,12,86,33,"isLoginModalVisible"],[101,31,86,52],[101,33,86,54],[102,10,86,59],[102,11,86,60],[102,12,86,61],[103,8,87,6],[103,9,87,7],[103,15,87,13],[104,10,88,8,"set"],[104,13,88,11],[104,14,88,12],[105,12,88,14,"isLoggedIn"],[105,22,88,24],[105,24,88,26],[106,10,88,32],[106,11,88,33],[106,12,88,34],[107,8,89,6],[108,6,90,4],[109,4,91,2],[109,5,91,3],[110,4,92,2,"logout"],[110,10,92,8],[110,12,92,10],[110,18,92,10,"logout"],[110,19,92,10],[110,24,92,22],[111,6,93,4],[111,10,93,8],[112,8,94,6],[112,14,94,12,"api"],[112,22,94,15],[112,23,94,16,"logout"],[112,29,94,22],[112,30,94,23],[112,31,94,24],[113,8,95,6,"set"],[113,11,95,9],[113,12,95,10],[114,10,95,12,"isLoggedIn"],[114,20,95,22],[114,22,95,24],[114,27,95,29],[115,10,95,31,"isLoginModalVisible"],[115,29,95,50],[115,31,95,52],[116,8,95,57],[116,9,95,58],[116,10,95,59],[117,8,96,6,"membershipStore"],[117,40,96,21],[117,41,96,22,"getState"],[117,49,96,30],[117,50,96,31],[117,51,96,32],[117,52,96,33,"clearMembershipInfo"],[117,71,96,52],[117,72,96,53],[117,73,96,54],[118,6,97,4],[118,7,97,5],[118,8,97,6],[118,15,97,13,"error"],[118,20,97,18],[118,22,97,20],[119,8,98,6,"logger"],[119,14,98,12],[119,15,98,13,"error"],[119,20,98,18],[119,21,98,19],[119,40,98,38],[119,42,98,40,"error"],[119,47,98,45],[119,48,98,46],[120,6,99,4],[121,4,100,2],[122,2,101,0],[122,3,101,1],[122,4,101,2],[122,5,101,3],[123,2,101,4],[123,6,101,4,"_default"],[123,14,101,4],[123,17,101,4,"exports"],[123,24,101,4],[123,25,101,4,"default"],[123,32,101,4],[123,35,103,15,"useAuthStore"],[123,47,103,27],[123,49,104,0],[124,2,105,0],[124,8,105,6,"authStore"],[124,17,105,15],[124,20,105,15,"exports"],[124,27,105,15],[124,28,105,15,"authStore"],[124,37,105,15],[124,40,105,18,"useAuthStore"],[124,52,105,30],[125,0,105,31]],"functionMap":{"names":["<global>","create$argument_0","showLoginModal","hideLoginModal","checkLoginStatus","Promise$argument_0","api.login._catch$argument_0","logout"],"mappings":"AAA;8CCoB;kBCG,wCD;kBEC,yCF;oBGC;4BCmB,6CD;sDEqB;WFG;GHsB;UMC;GNQ;EDC"}},"type":"js/module"}]}