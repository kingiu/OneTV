{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":154,"column":0,"index":5430}}],"key":"7kvm5yrOpz4NYiDi6sn4qxa8DVQ="}},{"name":"./tcpHttpServer","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":44,"index":44}}],"key":"ghesVyvsyW6gvmbDeKu+G4MWix0="}},{"name":"@/utils/Logger","data":{"asyncType":null,"locs":[{"start":{"line":2,"column":0,"index":45},"end":{"line":2,"column":36,"index":81}}],"key":"dpbJvsqVW0VVfFOl8dlhEC6KfVk="}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _interopRequireDefault = require(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.remoteControlService = void 0;\n  var _tcpHttpServer = _interopRequireDefault(require(_dependencyMap[1], \"./tcpHttpServer\"));\n  var _Logger = _interopRequireDefault(require(_dependencyMap[2], \"@/utils/Logger\"));\n  const logger = _Logger.default.withTag('RemoteControl');\n  const getRemotePageHTML = () => {\n    return `\n  <!DOCTYPE html>\n  <html>\n  <head>\n    <title>OrionTV Remote</title>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, user-scalable=no\">\n    <style>\n      body { font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; background-color: #121212; color: white; }\n      h3 { color: #eee; }\n      #container { display: flex; flex-direction: column; align-items: center; width: 90%; max-width: 400px; }\n      #text { width: 100%; padding: 15px; font-size: 16px; border-radius: 8px; border: 1px solid #333; background-color: #2a2a2a; color: white; margin-bottom: 20px; box-sizing: border-box; }\n      button { width: 100%; padding: 15px; font-size: 18px; font-weight: bold; border: none; border-radius: 8px; background-color: #007AFF; color: white; cursor: pointer; }\n      button:active { background-color: #0056b3; }\n    </style>\n  </head>\n  <body>\n    <div id=\"container\">\n      <h3>向电视发送文本</h3>\n      <input id=\"text\" placeholder=\"请输入...\" />\n      <button onclick=\"send()\">发送</button>\n    </div>\n    <script>\n      window.addEventListener('DOMContentLoaded', () => {\n        fetch('/handshake', { method: 'POST' }).catch(err => logger.info('Handshake failed:', err));\n      });\n      function send() {\n        const input = document.getElementById(\"text\");\n        const value = input.value;\n        if (value) {\n          fetch(\"/message\", {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ message: value })\n          })\n          .catch(err => logger.info('Message send failed:', err));\n          input.value = '';\n        }\n      }\n    </script>\n  </body>\n  </html>\n  `;\n  };\n  class RemoteControlService {\n    onMessage = () => {};\n    onHandshake = () => {};\n    constructor() {\n      this.httpServer = new _tcpHttpServer.default();\n      this.setupRequestHandler();\n    }\n    setupRequestHandler() {\n      this.httpServer.setRequestHandler(request => {\n        logger.debug(\"[RemoteControl] Received request:\", request.method, request.url);\n        try {\n          if (request.method === \"GET\" && request.url === \"/\") {\n            return {\n              statusCode: 200,\n              headers: {\n                \"Content-Type\": \"text/html; charset=utf-8\"\n              },\n              body: getRemotePageHTML()\n            };\n          } else if (request.method === \"POST\" && request.url === \"/message\") {\n            try {\n              const parsedBody = JSON.parse(request.body || \"{}\");\n              const message = parsedBody.message;\n              if (message) {\n                this.onMessage(message);\n              }\n              return {\n                statusCode: 200,\n                headers: {\n                  \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify({\n                  status: \"ok\"\n                })\n              };\n            } catch (parseError) {\n              logger.info(\"[RemoteControl] Failed to parse message body:\", parseError);\n              return {\n                statusCode: 400,\n                headers: {\n                  \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify({\n                  error: \"Invalid JSON\"\n                })\n              };\n            }\n          } else if (request.method === \"POST\" && request.url === \"/handshake\") {\n            this.onHandshake();\n            return {\n              statusCode: 200,\n              headers: {\n                \"Content-Type\": \"application/json\"\n              },\n              body: JSON.stringify({\n                status: \"ok\"\n              })\n            };\n          } else {\n            return {\n              statusCode: 404,\n              headers: {\n                \"Content-Type\": \"text/plain\"\n              },\n              body: \"Not Found\"\n            };\n          }\n        } catch (error) {\n          logger.info(\"[RemoteControl] Request handler error:\", error);\n          return {\n            statusCode: 500,\n            headers: {\n              \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify({\n              error: \"Internal Server Error\"\n            })\n          };\n        }\n      });\n    }\n    init(actions) {\n      this.onMessage = actions.onMessage;\n      this.onHandshake = actions.onHandshake;\n    }\n    async startServer() {\n      logger.debug(\"[RemoteControl] Attempting to start server...\");\n      try {\n        // 先尝试停止可能存在的旧实例\n        if (this.httpServer && this.httpServer.getIsRunning()) {\n          logger.debug(\"[RemoteControl] Stopping existing server before restart...\");\n          this.httpServer.stop();\n        }\n        const url = await this.httpServer.start();\n        logger.debug(`[RemoteControl] Server started successfully at: ${url}`);\n        return url;\n      } catch (error) {\n        const errorMessage = error instanceof Error ? error.message : \"启动失败\";\n        logger.info(\"[RemoteControl] Failed to start server:\", errorMessage);\n        throw new Error(errorMessage);\n      }\n    }\n    stopServer() {\n      logger.debug(\"[RemoteControl] Stopping server...\");\n      this.httpServer.stop();\n    }\n    isRunning() {\n      return this.httpServer.getIsRunning();\n    }\n  }\n  const remoteControlService = exports.remoteControlService = new RemoteControlService();\n});","lineCount":166,"map":[[7,2,1,0],[7,6,1,0,"_tcpHttpServer"],[7,20,1,0],[7,23,1,0,"_interopRequireDefault"],[7,45,1,0],[7,46,1,0,"require"],[7,53,1,0],[7,54,1,0,"_dependencyMap"],[7,68,1,0],[8,2,2,0],[8,6,2,0,"_Logger"],[8,13,2,0],[8,16,2,0,"_interopRequireDefault"],[8,38,2,0],[8,39,2,0,"require"],[8,46,2,0],[8,47,2,0,"_dependencyMap"],[8,61,2,0],[9,2,4,0],[9,8,4,6,"logger"],[9,14,4,12],[9,17,4,15,"Logger"],[9,32,4,21],[9,33,4,22,"withTag"],[9,40,4,29],[9,41,4,30],[9,56,4,45],[9,57,4,46],[10,2,6,0],[10,8,6,6,"getRemotePageHTML"],[10,25,6,23],[10,28,6,26,"getRemotePageHTML"],[10,29,6,26],[10,34,6,32],[11,4,7,2],[11,11,7,9],[12,0,8,0],[13,0,9,0],[14,0,10,0],[15,0,11,0],[16,0,12,0],[17,0,13,0],[18,0,14,0],[19,0,15,0],[20,0,16,0],[21,0,17,0],[22,0,18,0],[23,0,19,0],[24,0,20,0],[25,0,21,0],[26,0,22,0],[27,0,23,0],[28,0,24,0],[29,0,25,0],[30,0,26,0],[31,0,27,0],[32,0,28,0],[33,0,29,0],[34,0,30,0],[35,0,31,0],[36,0,32,0],[37,0,33,0],[38,0,34,0],[39,0,35,0],[40,0,36,0],[41,0,37,0],[42,0,38,0],[43,0,39,0],[44,0,40,0],[45,0,41,0],[46,0,42,0],[47,0,43,0],[48,0,44,0],[49,0,45,0],[50,0,46,0],[51,0,47,0],[52,0,48,0],[53,0,49,0],[53,3,49,3],[54,2,50,0],[54,3,50,1],[55,2,52,0],[55,8,52,6,"RemoteControlService"],[55,28,52,26],[55,29,52,27],[56,4,54,10,"onMessage"],[56,13,54,19],[56,16,54,49,"onMessage"],[56,17,54,49],[56,22,54,55],[56,23,54,56],[56,24,54,57],[57,4,55,10,"onHandshake"],[57,15,55,21],[57,18,55,36,"onHandshake"],[57,19,55,36],[57,24,55,42],[57,25,55,43],[57,26,55,44],[58,4,57,2,"constructor"],[58,15,57,13,"constructor"],[58,16,57,13],[58,18,57,16],[59,6,58,4],[59,10,58,8],[59,11,58,9,"httpServer"],[59,21,58,19],[59,24,58,22],[59,28,58,26,"TCPHttpServer"],[59,50,58,39],[59,51,58,40],[59,52,58,41],[60,6,59,4],[60,10,59,8],[60,11,59,9,"setupRequestHandler"],[60,30,59,28],[60,31,59,29],[60,32,59,30],[61,4,60,2],[62,4,62,10,"setupRequestHandler"],[62,23,62,29,"setupRequestHandler"],[62,24,62,29],[62,26,62,32],[63,6,63,4],[63,10,63,8],[63,11,63,9,"httpServer"],[63,21,63,19],[63,22,63,20,"setRequestHandler"],[63,39,63,37],[63,40,63,39,"request"],[63,47,63,46],[63,51,63,51],[64,8,64,6,"logger"],[64,14,64,12],[64,15,64,13,"debug"],[64,20,64,18],[64,21,64,19],[64,56,64,54],[64,58,64,56,"request"],[64,65,64,63],[64,66,64,64,"method"],[64,72,64,70],[64,74,64,72,"request"],[64,81,64,79],[64,82,64,80,"url"],[64,85,64,83],[64,86,64,84],[65,8,66,6],[65,12,66,10],[66,10,67,8],[66,14,67,12,"request"],[66,21,67,19],[66,22,67,20,"method"],[66,28,67,26],[66,33,67,31],[66,38,67,36],[66,42,67,40,"request"],[66,49,67,47],[66,50,67,48,"url"],[66,53,67,51],[66,58,67,56],[66,61,67,59],[66,63,67,61],[67,12,68,10],[67,19,68,17],[68,14,69,12,"statusCode"],[68,24,69,22],[68,26,69,24],[68,29,69,27],[69,14,70,12,"headers"],[69,21,70,19],[69,23,70,21],[70,16,70,23],[70,30,70,37],[70,32,70,39],[71,14,70,66],[71,15,70,67],[72,14,71,12,"body"],[72,18,71,16],[72,20,71,18,"getRemotePageHTML"],[72,37,71,35],[72,38,71,36],[73,12,72,10],[73,13,72,11],[74,10,73,8],[74,11,73,9],[74,17,73,15],[74,21,73,19,"request"],[74,28,73,26],[74,29,73,27,"method"],[74,35,73,33],[74,40,73,38],[74,46,73,44],[74,50,73,48,"request"],[74,57,73,55],[74,58,73,56,"url"],[74,61,73,59],[74,66,73,64],[74,76,73,74],[74,78,73,76],[75,12,74,10],[75,16,74,14],[76,14,75,12],[76,20,75,18,"parsedBody"],[76,30,75,28],[76,33,75,31,"JSON"],[76,37,75,35],[76,38,75,36,"parse"],[76,43,75,41],[76,44,75,42,"request"],[76,51,75,49],[76,52,75,50,"body"],[76,56,75,54],[76,60,75,58],[76,64,75,62],[76,65,75,63],[77,14,76,12],[77,20,76,18,"message"],[77,27,76,25],[77,30,76,28,"parsedBody"],[77,40,76,38],[77,41,76,39,"message"],[77,48,76,46],[78,14,77,12],[78,18,77,16,"message"],[78,25,77,23],[78,27,77,25],[79,16,78,14],[79,20,78,18],[79,21,78,19,"onMessage"],[79,30,78,28],[79,31,78,29,"message"],[79,38,78,36],[79,39,78,37],[80,14,79,12],[81,14,80,12],[81,21,80,19],[82,16,81,14,"statusCode"],[82,26,81,24],[82,28,81,26],[82,31,81,29],[83,16,82,14,"headers"],[83,23,82,21],[83,25,82,23],[84,18,82,25],[84,32,82,39],[84,34,82,41],[85,16,82,60],[85,17,82,61],[86,16,83,14,"body"],[86,20,83,18],[86,22,83,20,"JSON"],[86,26,83,24],[86,27,83,25,"stringify"],[86,36,83,34],[86,37,83,35],[87,18,83,37,"status"],[87,24,83,43],[87,26,83,45],[88,16,83,50],[88,17,83,51],[89,14,84,12],[89,15,84,13],[90,12,85,10],[90,13,85,11],[90,14,85,12],[90,21,85,19,"parseError"],[90,31,85,29],[90,33,85,31],[91,14,86,12,"logger"],[91,20,86,18],[91,21,86,19,"info"],[91,25,86,23],[91,26,86,24],[91,73,86,71],[91,75,86,73,"parseError"],[91,85,86,83],[91,86,86,84],[92,14,87,12],[92,21,87,19],[93,16,88,14,"statusCode"],[93,26,88,24],[93,28,88,26],[93,31,88,29],[94,16,89,14,"headers"],[94,23,89,21],[94,25,89,23],[95,18,89,25],[95,32,89,39],[95,34,89,41],[96,16,89,60],[96,17,89,61],[97,16,90,14,"body"],[97,20,90,18],[97,22,90,20,"JSON"],[97,26,90,24],[97,27,90,25,"stringify"],[97,36,90,34],[97,37,90,35],[98,18,90,37,"error"],[98,23,90,42],[98,25,90,44],[99,16,90,59],[99,17,90,60],[100,14,91,12],[100,15,91,13],[101,12,92,10],[102,10,93,8],[102,11,93,9],[102,17,93,15],[102,21,93,19,"request"],[102,28,93,26],[102,29,93,27,"method"],[102,35,93,33],[102,40,93,38],[102,46,93,44],[102,50,93,48,"request"],[102,57,93,55],[102,58,93,56,"url"],[102,61,93,59],[102,66,93,64],[102,78,93,76],[102,80,93,78],[103,12,94,10],[103,16,94,14],[103,17,94,15,"onHandshake"],[103,28,94,26],[103,29,94,27],[103,30,94,28],[104,12,95,10],[104,19,95,17],[105,14,96,12,"statusCode"],[105,24,96,22],[105,26,96,24],[105,29,96,27],[106,14,97,12,"headers"],[106,21,97,19],[106,23,97,21],[107,16,97,23],[107,30,97,37],[107,32,97,39],[108,14,97,58],[108,15,97,59],[109,14,98,12,"body"],[109,18,98,16],[109,20,98,18,"JSON"],[109,24,98,22],[109,25,98,23,"stringify"],[109,34,98,32],[109,35,98,33],[110,16,98,35,"status"],[110,22,98,41],[110,24,98,43],[111,14,98,48],[111,15,98,49],[112,12,99,10],[112,13,99,11],[113,10,100,8],[113,11,100,9],[113,17,100,15],[114,12,101,10],[114,19,101,17],[115,14,102,12,"statusCode"],[115,24,102,22],[115,26,102,24],[115,29,102,27],[116,14,103,12,"headers"],[116,21,103,19],[116,23,103,21],[117,16,103,23],[117,30,103,37],[117,32,103,39],[118,14,103,52],[118,15,103,53],[119,14,104,12,"body"],[119,18,104,16],[119,20,104,18],[120,12,105,10],[120,13,105,11],[121,10,106,8],[122,8,107,6],[122,9,107,7],[122,10,107,8],[122,17,107,15,"error"],[122,22,107,20],[122,24,107,22],[123,10,108,8,"logger"],[123,16,108,14],[123,17,108,15,"info"],[123,21,108,19],[123,22,108,20],[123,62,108,60],[123,64,108,62,"error"],[123,69,108,67],[123,70,108,68],[124,10,109,8],[124,17,109,15],[125,12,110,10,"statusCode"],[125,22,110,20],[125,24,110,22],[125,27,110,25],[126,12,111,10,"headers"],[126,19,111,17],[126,21,111,19],[127,14,111,21],[127,28,111,35],[127,30,111,37],[128,12,111,56],[128,13,111,57],[129,12,112,10,"body"],[129,16,112,14],[129,18,112,16,"JSON"],[129,22,112,20],[129,23,112,21,"stringify"],[129,32,112,30],[129,33,112,31],[130,14,112,33,"error"],[130,19,112,38],[130,21,112,40],[131,12,112,64],[131,13,112,65],[132,10,113,8],[132,11,113,9],[133,8,114,6],[134,6,115,4],[134,7,115,5],[134,8,115,6],[135,4,116,2],[136,4,118,9,"init"],[136,8,118,13,"init"],[136,9,118,14,"actions"],[136,16,118,88],[136,18,118,90],[137,6,119,4],[137,10,119,8],[137,11,119,9,"onMessage"],[137,20,119,18],[137,23,119,21,"actions"],[137,30,119,28],[137,31,119,29,"onMessage"],[137,40,119,38],[138,6,120,4],[138,10,120,8],[138,11,120,9,"onHandshake"],[138,22,120,20],[138,25,120,23,"actions"],[138,32,120,30],[138,33,120,31,"onHandshake"],[138,44,120,42],[139,4,121,2],[140,4,123,2],[140,10,123,15,"startServer"],[140,21,123,26,"startServer"],[140,22,123,26],[140,24,123,46],[141,6,124,4,"logger"],[141,12,124,10],[141,13,124,11,"debug"],[141,18,124,16],[141,19,124,17],[141,66,124,64],[141,67,124,65],[142,6,126,4],[142,10,126,8],[143,8,127,6],[144,8,128,6],[144,12,128,10],[144,16,128,14],[144,17,128,15,"httpServer"],[144,27,128,25],[144,31,128,29],[144,35,128,33],[144,36,128,34,"httpServer"],[144,46,128,44],[144,47,128,45,"getIsRunning"],[144,59,128,57],[144,60,128,58],[144,61,128,59],[144,63,128,61],[145,10,129,8,"logger"],[145,16,129,14],[145,17,129,15,"debug"],[145,22,129,20],[145,23,129,21],[145,83,129,81],[145,84,129,82],[146,10,130,8],[146,14,130,12],[146,15,130,13,"httpServer"],[146,25,130,23],[146,26,130,24,"stop"],[146,30,130,28],[146,31,130,29],[146,32,130,30],[147,8,131,6],[148,8,133,6],[148,14,133,12,"url"],[148,17,133,15],[148,20,133,18],[148,26,133,24],[148,30,133,28],[148,31,133,29,"httpServer"],[148,41,133,39],[148,42,133,40,"start"],[148,47,133,45],[148,48,133,46],[148,49,133,47],[149,8,134,6,"logger"],[149,14,134,12],[149,15,134,13,"debug"],[149,20,134,18],[149,21,134,19],[149,72,134,70,"url"],[149,75,134,73],[149,77,134,75],[149,78,134,76],[150,8,135,6],[150,15,135,13,"url"],[150,18,135,16],[151,6,136,4],[151,7,136,5],[151,8,136,6],[151,15,136,13,"error"],[151,20,136,18],[151,22,136,20],[152,8,137,6],[152,14,137,12,"errorMessage"],[152,26,137,24],[152,29,137,27,"error"],[152,34,137,32],[152,46,137,44,"Error"],[152,51,137,49],[152,54,137,52,"error"],[152,59,137,57],[152,60,137,58,"message"],[152,67,137,65],[152,70,137,68],[152,76,137,74],[153,8,138,6,"logger"],[153,14,138,12],[153,15,138,13,"info"],[153,19,138,17],[153,20,138,18],[153,61,138,59],[153,63,138,61,"errorMessage"],[153,75,138,73],[153,76,138,74],[154,8,139,6],[154,14,139,12],[154,18,139,16,"Error"],[154,23,139,21],[154,24,139,22,"errorMessage"],[154,36,139,34],[154,37,139,35],[155,6,140,4],[156,4,141,2],[157,4,143,9,"stopServer"],[157,14,143,19,"stopServer"],[157,15,143,19],[157,17,143,22],[158,6,144,4,"logger"],[158,12,144,10],[158,13,144,11,"debug"],[158,18,144,16],[158,19,144,17],[158,55,144,53],[158,56,144,54],[159,6,145,4],[159,10,145,8],[159,11,145,9,"httpServer"],[159,21,145,19],[159,22,145,20,"stop"],[159,26,145,24],[159,27,145,25],[159,28,145,26],[160,4,146,2],[161,4,148,9,"isRunning"],[161,13,148,18,"isRunning"],[161,14,148,18],[161,16,148,30],[162,6,149,4],[162,13,149,11],[162,17,149,15],[162,18,149,16,"httpServer"],[162,28,149,26],[162,29,149,27,"getIsRunning"],[162,41,149,39],[162,42,149,40],[162,43,149,41],[163,4,150,2],[164,2,151,0],[165,2,153,7],[165,8,153,13,"remoteControlService"],[165,28,153,33],[165,31,153,33,"exports"],[165,38,153,33],[165,39,153,33,"remoteControlService"],[165,59,153,33],[165,62,153,36],[165,66,153,40,"RemoteControlService"],[165,86,153,60],[165,87,153,61],[165,88,153,62],[166,0,153,63]],"functionMap":{"names":["<global>","getRemotePageHTML","RemoteControlService","RemoteControlService#onMessage","RemoteControlService#onHandshake","RemoteControlService#constructor","RemoteControlService#setupRequestHandler","httpServer.setRequestHandler$argument_0","RemoteControlService#init","RemoteControlService#startServer","RemoteControlService#stopServer","RemoteControlService#isRunning"],"mappings":"AAA;0BCK;CD4C;AEE;iDCE,QD;oCEC,QF;EGE;GHG;EIE;sCCC;KDoD;GJC;EME;GNG;EOE;GPkB;EQE;GRG;ESE;GTE;CFC"}},"type":"js/module"}]}